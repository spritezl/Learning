
--**************************************************************************************
--**************************************************************************************
--*******************************POS AGGREGATION TRACKING TYPE*************************
--**************************************************************************************
--**************************************************************************************
CREATE OR REPLACE TYPE NNT_IDS IS TABLE OF NUMBER(9);
/

CREATE OR REPLACE TYPE NNT_STRS IS TABLE OF VARCHAR2(4000);
/
--**************************************************************************************
--**************************************************************************************
--*******************************Conform Dims*******************************************
--**************************************************************************************
--**************************************************************************************

--**************************************************************************************
--******************************DIM_COMMON**********************************************
--**************************************************************************************
--DROP TABLE DIM_COMMON PURGE;
CREATE TABLE DIM_COMMON(
COMMON_ID           NUMBER(7)     NOT NULL
  CONSTRAINT PKDIM_COMMON PRIMARY KEY,
COMMON_CODE         VARCHAR2(30)  NOT NULL,
COMMON_VALUE        VARCHAR2(30)  NOT NULL,
COMMON_DESC         VARCHAR2(60)  NOT NULL
);

ALTER TABLE DIM_COMMON ADD CONSTRAINT UN1DIM_COMMON UNIQUE(COMMON_CODE,COMMON_VALUE);



--**************************************************************************************
--******************************Time****************************************************
--**************************************************************************************
--time dimension with the following hierarchies:
--Calendar YEAR--> MONTH -->DAY
--ISO YEAR--> ISO Week -->DAY
--Calendar YEAR--> Calendar Week -->DAY
--7th: SYEAR-->SMONTH--SWEEK-->DAY

--calendar year
CREATE TABLE DIM_DATE_CYEAR(
CYEAR_ID                       NUMBER(4)    NOT NULL
  CONSTRAINT PKDIM_DATE_CYEAR PRIMARY KEY,
CYEAR_DESC                     VARCHAR2(10) NOT NULL,
START_DATE                     DATE         NOT NULL,
END_DATE                       DATE         NOT NULL,
TIME_SPAN                      NUMBER(3)    NOT NULL,
CYEAR_NUM                      NUMBER(4)    NOT NULL
);

CREATE TABLE DIM_DATE_MONTH(
MONTH_ID                       NUMBER(6)    NOT NULL
  CONSTRAINT PKDIM_DATE_MONTH PRIMARY KEY,
MONTH_DESC                     VARCHAR2(10) NOT NULL,
CYEAR_ID                       NUMBER(4)    NOT NULL,
MONTH_OF_CYEAR                 NUMBER(2)    NOT NULL,
MONTH_NAME                     VARCHAR2(10) NOT NULL,
START_DATE                     DATE         NOT NULL,
END_DATE                       DATE         NOT NULL,
TIME_SPAN                      NUMBER(2)    NOT NULL,
MONTH_NUM                      NUMBER(6)    NOT NULL
);

ALTER TABLE DIM_DATE_MONTH ADD CONSTRAINT FKDIM_DATE_MONTH_CY FOREIGN KEY(CYEAR_ID) REFERENCES DIM_DATE_CYEAR(CYEAR_ID);
CREATE INDEX XIE1DIM_DATE_MONTH ON DIM_DATE_MONTH(CYEAR_ID);



--7th year
CREATE TABLE DIM_DATE_SYEAR(
SYEAR_ID                       NUMBER(4)    NOT NULL
  CONSTRAINT PKDIM_DATE_SYEAR PRIMARY KEY,
SYEAR_DESC                     VARCHAR2(10) NOT NULL,
START_DATE                     DATE         NOT NULL,
END_DATE                       DATE         NOT NULL,
TIME_SPAN                      NUMBER(3)    NOT NULL,
SYEAR_NUM                      NUMBER(4)    NOT NULL
);

--7th week
CREATE TABLE DIM_DATE_SMONTH(
SMONTH_ID                       NUMBER(6)    NOT NULL
  CONSTRAINT PKDIM_DATE_SMONTH PRIMARY KEY,
SMONTH_DESC                     VARCHAR2(10) NOT NULL,
SYEAR_ID                        NUMBER(4)    NOT NULL,
SMONTH_OF_SYEAR                 NUMBER(2)    NOT NULL,
SMONTH_NAME                     VARCHAR2(10) NOT NULL,
START_DATE                      DATE         NOT NULL,
END_DATE                        DATE         NOT NULL,
TIME_SPAN                       NUMBER(2)    NOT NULL,
SMONTH_NUM                      NUMBER(6)    NOT NULL
);

ALTER TABLE DIM_DATE_SMONTH ADD CONSTRAINT FKDIM_DATE_SMONTH_SY FOREIGN KEY(SYEAR_ID) REFERENCES DIM_DATE_SYEAR(SYEAR_ID);
CREATE INDEX XIE1DIM_DATE_SMONTH ON DIM_DATE_SMONTH(SYEAR_ID);



--ADD A CUSTOMISE 7TH WEEK LEVEL
--HIERARCH:YEAR-->MONTH-->SWEEK-->DAY
CREATE TABLE DIM_DATE_SWEEK(
SWEEK_ID                        NUMBER(6)    NOT NULL
  CONSTRAINT PKDIM_DATE_SWEEK PRIMARY KEY,
SWEEK_DESC                      VARCHAR2(10) NOT NULL,
SMONTH_ID                       NUMBER(6)    NOT NULL,
SWEEK_OF_SMONTH                 NUMBER(2)    NOT NULL,
SWEEK_OF_SYEAR                  NUMBER(2)    NOT NULL,
START_DATE                      DATE         NOT NULL,
END_DATE                        DATE         NOT NULL,
TIME_SPAN                       NUMBER(1)    NOT NULL,
SWEEK_NUM                       NUMBER(6)    NOT NULL
);

ALTER TABLE DIM_DATE_SWEEK ADD CONSTRAINT FKDIM_DATE_SWEEK_SM FOREIGN KEY(SMONTH_ID) REFERENCES DIM_DATE_SMONTH(SMONTH_ID);
CREATE INDEX XIE1DIM_DATE_SWEEK ON DIM_DATE_SWEEK(SMONTH_ID);



--iso year
CREATE TABLE DIM_DATE_IYEAR(
IYEAR_ID                       NUMBER(4)    NOT NULL
  CONSTRAINT PKDIM_DATE_IYEAR PRIMARY KEY,
IYEAR_DESC                     VARCHAR2(10) NOT NULL,
START_DATE                     DATE         NOT NULL,
END_DATE                       DATE         NOT NULL,
TIME_SPAN                      NUMBER(4)    NOT NULL,
IYEAR_NUM                      NUMBER(4)    NOT NULL
);

CREATE TABLE DIM_DATE_IWEEK(
IWEEK_ID                     NUMBER(6)      NOT NULL
  CONSTRAINT PKDIM_DATE_IWEEK PRIMARY KEY,
IWEEK_DESC                   VARCHAR2(10)   NOT NULL,
IWEEK_OF_IYEAR               NUMBER(2)      NOT NULL,
IYEAR_ID                     NUMBER(4)      NOT NULL,
START_DATE                   DATE           NOT NULL,
END_DATE                     DATE           NOT NULL,
TIME_SPAN                    NUMBER(1)      NOT NULL,
IWEEK_NUM                    NUMBER(6)      NOT NULL
);

ALTER TABLE DIM_DATE_IWEEK ADD CONSTRAINT FKDIM_DATE_IWEEK_IY FOREIGN KEY(IYEAR_ID) REFERENCES DIM_DATE_IYEAR(IYEAR_ID);
CREATE INDEX XIE1DIM_DATE_IWEEK_IY ON DIM_DATE_IWEEK(IYEAR_ID); 

CREATE TABLE DIM_DATE_CWEEK(
CWEEK_ID                        NUMBER(6)    NOT NULL
  CONSTRAINT PKDIM_DATE_CWEEK PRIMARY KEY,
CWEEK_DESC                      VARCHAR2(10) NOT NULL,
CYEAR_ID                        NUMBER(4)    NOT NULL,
CWEEK_OF_CYEAR                  NUMBER(2)    NOT NULL,
START_DATE                      DATE         NOT NULL,
END_DATE                        DATE         NOT NULL,
TIME_SPAN                       NUMBER(1)    NOT NULL,
CWEEK_NUM                       NUMBER(6)    NOT NULL
);

ALTER TABLE DIM_DATE_CWEEK ADD CONSTRAINT FKDIM_DATE_CWEEK_CY FOREIGN KEY(CYEAR_ID) REFERENCES DIM_DATE_CYEAR(CYEAR_ID);
CREATE INDEX XIE1DIM_DATE_CWEEK_CY ON DIM_DATE_CWEEK(CYEAR_ID);

CREATE TABLE DIM_DATE_DAY(
DATE_ID                      NUMBER(8)    NOT NULL
  CONSTRAINT PKDIM_DATE_DAY PRIMARY KEY,
DAY_DATE                     DATE         NOT NULL,
DAY_DESC                     VARCHAR2(11) NOT NULL,
CWEEK_ID                     NUMBER(6)    NOT NULL,
IWEEK_ID                     NUMBER(6)    NOT NULL,
SWEEK_ID                     NUMBER(6)    NOT NULL,
MONTH_ID                     NUMBER(6)    NOT NULL,
DAY_OF_CWEEK                 NUMBER(1)    NOT NULL,
DAY_OF_IWEEK                 NUMBER(1)    NOT NULL,
DAY_OF_MONTH                 NUMBER(2)    NOT NULL,
DAY_OF_CYEAR                 NUMBER(3)    NOT NULL,
DAY_OF_IYEAR                 NUMBER(3)    NOT NULL,
DAY_OF_SWEEK                 NUMBER(3)    NOT NULL,
DAY_OF_SMONTH                NUMBER(3)    NOT NULL,
DAY_OF_SYEAR                 NUMBER(3)    NOT NULL,
START_DATE                   DATE         NOT NULL,
END_DATE                     DATE         NOT NULL,
TIME_SPAN                    NUMBER(1)    NOT NULL,
DAY_NUM                      NUMBER(8)    NOT NULL
);

ALTER TABLE DIM_DATE_DAY ADD CONSTRAINT UN1DIM_DATE_DAY UNIQUE(DAY_DATE);
ALTER TABLE DIM_DATE_DAY ADD CONSTRAINT FKDIM_DATE_DAY_IWEEK FOREIGN KEY(IWEEK_ID) REFERENCES DIM_DATE_IWEEK(IWEEK_ID);
ALTER TABLE DIM_DATE_DAY ADD CONSTRAINT FKDIM_DATE_DAY_CWEEK FOREIGN KEY(CWEEK_ID) REFERENCES DIM_DATE_CWEEK(CWEEK_ID);
ALTER TABLE DIM_DATE_DAY ADD CONSTRAINT FKDIM_DATE_DAY_MONTH FOREIGN KEY(MONTH_ID) REFERENCES DIM_DATE_MONTH(MONTH_ID);
ALTER TABLE DIM_DATE_DAY ADD CONSTRAINT FKDIM_DATE_DAY_SWEEK FOREIGN KEY(SWEEK_ID) REFERENCES DIM_DATE_SWEEK(SWEEK_ID);

CREATE INDEX XIE1DIM_DATE_DAY ON DIM_DATE_DAY(IWEEK_ID);
CREATE INDEX XIE2DIM_DATE_DAY ON DIM_DATE_DAY(CWEEK_ID);
CREATE INDEX XIE3DIM_DATE_DAY  ON DIM_DATE_DAY(MONTH_ID);
CREATE INDEX XIE4DIM_DATE_DAY  ON DIM_DATE_DAY(SWEEK_ID);

--*******************************************************************************************
--**********************************style dimensions****************************************
--*******************************************************************************************
--This is a SCD1 dimension with only one hierarchy:
--buyer_dept-->style-->style color-->style color size

--1,dim_dept
CREATE TABLE DIM_DEPT(
  DEPT_ID               NUMBER(7)     NOT NULL
  CONSTRAINT PKDIM_DEPT PRIMARY KEY,
  SOURCE_BUSKEY         VARCHAR2(30)  NOT NULL,  --BUYER_DEPT_NUM
  TARGET_BUSKEY         VARCHAR2(30)  NOT NULL,  --TO_CHAR(ORI_DEPT_ID)
  DEPT_NUM              VARCHAR2(30)  NOT NULL,
  DEPT                  VARCHAR2(30)  NOT NULL,
  DIVISION              VARCHAR2(30)  NOT NULL,  --DEMAND CENTRE
  CORPORATE_DIVISION    VARCHAR2(30)  NOT NULL,
  ORI_DEPT_ID           NUMBER(7)     NOT NULL
  );
  
ALTER TABLE DIM_DEPT ADD CONSTRAINT UN1DIM_DEPT UNIQUE(SOURCE_BUSKEY);
ALTER TABLE DIM_DEPT ADD CONSTRAINT UN2DIM_DEPT UNIQUE(TARGET_BUSKEY);

--DIM_VENDOR
CREATE TABLE DIM_VENDOR(
VENDOR_ID               NUMBER(7)     NOT NULL
CONSTRAINT PKDIM_VENDOR PRIMARY KEY,
SOURCE_BUSKEY           VARCHAR2(30)  NOT NULL,--VENDOR_REF_NUMBER
NAME                    VARCHAR2(80)  NOT NULL,--VENDOR_COMPANY_NAME
VENDOR_DIVISION         VARCHAR2(60)  NOT NULL,
VENDOR_DEPT             VARCHAR2(60)  NOT NULL,
VENDOR_PRODUCT_CATEGORY VARCHAR2(30)  NOT NULL,
ORI_MIC_ID              NUMBER(7)     NOT NULL,
MIC_CODE                VARCHAR2(20)  NOT NULL,--VENDOR_REF_NUMBER
MIC_DESC                VARCHAR2(200) NOT NULL,
PO_DIRECTION            NUMBER(1)     NOT NULL,
VENDOR_REF_NUMBER       VARCHAR2(20)  NOT NULL,
ORI_VENDOR_COMPANY_ID   NUMBER(7)     NOT NULL,
TARGET_BUSKEY           VARCHAR2(30)  NOT NULL
);


ALTER TABLE DIM_VENDOR ADD CONSTRAINT UN1DIM_VENDOR UNIQUE(SOURCE_BUSKEY);
ALTER TABLE DIM_VENDOR ADD CONSTRAINT UN2DIM_VENDOR UNIQUE(TARGET_BUSKEY);

--2,dim_size_range
CREATE TABLE DIM_SIZE_RANGE(
SIZE_RANGE_ID               NUMBER(7)   NOT NULL
  CONSTRAINT PKDIM_SIZE_RANGE PRIMARY KEY,
SOURCE_BUSKEY               VARCHAR2(30)NOT NULL,  --size_range_name
DEPT_ID                     NUMBER(7)   NOT NULL,
NAME                        VARCHAR2(30)NOT NULL
);

ALTER TABLE DIM_SIZE_RANGE ADD CONSTRAINT UN1DIM_SIZE_RANGE UNIQUE(SOURCE_BUSKEY);

ALTER TABLE DIM_SIZE_RANGE ADD CONSTRAINT FKDIM_SIZE_RANGE_D 
FOREIGN KEY(DEPT_ID) REFERENCES DIM_DEPT(DEPT_ID);

CREATE INDEX XIE1DIM_SIZE_RANGE ON DIM_SIZE_RANGE(DEPT_ID);

--3,dim_size_item
CREATE TABLE DIM_SIZE_ITEM(
SIZE_ITEM_ID                NUMBER(7)     NOT NULL
  CONSTRAINT PKDIM_SIZE_ITEM PRIMARY KEY,
SOURCE_BUSKEY               VARCHAR2(20)  NOT NULL,--SIZE_RANGE+SIZE_CODE
SIZE_RANGE_ID               NUMBER(7)     NOT NULL,
SIZE_CODE                   VARCHAR2(20)  NOT NULL,
SIZE_NAME1                  VARCHAR2(40)  NOT NULL,
SIZE_NAME2                  VARCHAR2(40)  NOT NULL,
SIZE_SEQ1                   NUMBER(7)     NOT NULL,
SIZE_SEQ2                   NUMBER(7)     NOT NULL,
CORE_SIZE_INDICATOR         NUMBER(1)     NOT NULL
);
ALTER TABLE DIM_SIZE_ITEM ADD CONSTRAINT UN1DIM_SIZE_ITEM UNIQUE(SOURCE_BUSKEY);
ALTER TABLE DIM_SIZE_ITEM ADD CONSTRAINT UN2DIM_SIZE_ITEM UNIQUE(SIZE_RANGE_ID,SIZE_CODE);
ALTER TABLE DIM_SIZE_ITEM ADD CONSTRAINT FKDIM_SIZE_ITEM_R FOREIGN KEY(SIZE_RANGE_ID) REFERENCES DIM_SIZE_RANGE(SIZE_RANGE_ID);

CREATE INDEX XIE1DIM_SIZE_ITEM ON DIM_SIZE_ITEM(SIZE_RANGE_ID);


--4,dim_style
CREATE TABLE DIM_STYLE(
  STYLE_ID                      NUMBER(7)     NOT NULL
  CONSTRAINT PKDIM_STYLE PRIMARY KEY,
  SOURCE_BUSKEY                 VARCHAR2(60)  NOT NULL,
  TARGET_BUSKEY                 VARCHAR2(60)  NOT NULL,
  STYLE_NUMBER                  VARCHAR2(40)  NOT NULL,
  DESCRIPTION                   VARCHAR2(300) NOT NULL,
  DEPT_ID                       NUMBER(7)     NOT NULL,
  VENDOR_ID                     NUMBER(7)     NOT NULL,
  VENDOR_NAME                   VARCHAR2(30)  NOT NULL,
  SIZE_RANGE                    VARCHAR2(30)  NOT NULL,
  DEPT_TYPE                     VARCHAR2(30)  NOT NULL,
  DIVISION_TYPE                 VARCHAR2(30)  NOT NULL,
  CLASS_CODE                    VARCHAR2(30)  NOT NULL,
  CLASS                         VARCHAR2(100) NOT NULL,
  PRODUCT_CATEGORY              VARCHAR2(60)  NOT NULL,
  CATEGORY                      VARCHAR2(60)  NOT NULL,
  PRODUCTION_TYPE               VARCHAR2(30)  NOT NULL,
  FIBER_CONTENT                 VARCHAR2(100) NOT NULL,
  FABRICATION                   VARCHAR2(100) NOT NULL,
  PRODUCT_GROUP                 VARCHAR2(60)  NOT NULL,
  RANGE_CODE                    VARCHAR2(40)  NOT NULL,
  COLLAR                        VARCHAR2(30)  NOT NULL,
  SLEEVE                        VARCHAR2(30)  NOT NULL,
  LABEL_CODE                    VARCHAR2(30)  NOT NULL,
  TERM                          VARCHAR2(64)  NOT NULL,
  PRODUCT_CATEGORY_CODE         VARCHAR2(30)  NOT NULL,
  SEASON_CODE                   VARCHAR2(30)  NOT NULL,
  PRODUCT_GROUP_CODE            VARCHAR2(60)  NOT NULL,
  STYLE_REF_NUMBER              VARCHAR2(40)  NOT NULL,    --VENDOR_REF_NUMBER
  STYLE_NAME                    VARCHAR2(50)  NOT NULL,
  SUB_CLASS                     VARCHAR2(30)  NOT NULL,
  MINOR_CLASS                   VARCHAR2(30)  NOT NULL,
  HANG_FOLD                     VARCHAR2(40)  NOT NULL,
  YIELD                         NUMBER(4,2)   NOT NULL,
  DISCONTINUE_DATE              DATE          NOT NULL,
  CHANGE_DATE                   DATE          NOT NULL,
  REPLENISHMENT_IND             NUMBER(1)     NOT NULL,
  LOW_COST                      NUMBER(9,2)   NOT NULL,
  LOW_RETAIL                    NUMBER(9,2)   NOT NULL,
  STANDARD_COST                 NUMBER(9,2)   NOT NULL,
  VENDOR_REF_NUMBER             VARCHAR2(40)  NOT NULL, 
  STATUS                        NUMBER(1)     NOT NULL,
  ORI_STYLE_ID                  NUMBER(7)     NOT NULL,
  ORI_COMPANY_ID                NUMBER(7)     NOT NULL,
  ORI_BUYER_CLASS_ID            NUMBER(7)     NOT NULL,
  ORI_BUYER_SUBCLASS_ID         NUMBER(7)     NOT NULL,
  ORI_MINOR_CLASS_ID            NUMBER(7)     NOT NULL,
  ORI_PRODUCTION_TYPE_ID        NUMBER(7)     NOT NULL,
  ORI_BUYER_COMPANY_ID          NUMBER(7)     NOT NULL
  );
  

ALTER TABLE DIM_STYLE ADD CONSTRAINT UN1DIM_STYLE UNIQUE(SOURCE_BUSKEY);
ALTER TABLE DIM_STYLE ADD CONSTRAINT UN2DIM_STYLE UNIQUE(TARGET_BUSKEY);

ALTER TABLE DIM_STYLE ADD CONSTRAINT FKDIM_STYLE_DEPT 
FOREIGN KEY(DEPT_ID) REFERENCES DIM_DEPT(DEPT_ID);

ALTER TABLE DIM_STYLE ADD CONSTRAINT FKDIM_STYLE_V 
FOREIGN KEY(VENDOR_ID) REFERENCES DIM_VENDOR(VENDOR_ID);

CREATE INDEX XIE1DIM_STYLE ON DIM_STYLE(DEPT_ID);
CREATE INDEX XIE2DIM_STYLE ON DIM_STYLE(VENDOR_ID);

--5,DIM_STYLE_COLOR
CREATE TABLE DIM_STYLE_COLOR
(
  STYLE_COLOR_ID                NUMBER(7)     NOT NULL
  CONSTRAINT PKDIM_STYLE_COLOR  PRIMARY KEY,
  SOURCE_BUSKEY                 VARCHAR2(60)  NOT NULL,
  TARGET_BUSKEY                 VARCHAR2(60)  NOT NULL,
  STYLE_ID                      NUMBER(7)     NOT NULL,
  COLOR_NAME                    VARCHAR2(100) NOT NULL,
  COLOR_CODE                    VARCHAR2(20)  NOT NULL,
  VENDOR_COLOR_CODE             VARCHAR2(20)  NOT NULL,
  COLOR_FAMILY                  VARCHAR2(30)  NOT NULL,
  SHORT_COLOR_NAME              VARCHAR2(10)  NOT NULL,
  COLOR_GROUP                   VARCHAR2(40)  NOT NULL,
  PATTERN                       VARCHAR2(30)  NOT NULL,
  ACCOUNT_EXCLUSIVE             VARCHAR2(30)  NOT NULL,
  START_SHIP_DATE               DATE          NOT NULL,
  PRODUCT_TEAM                  VARCHAR2(30)  NOT NULL,  
  KEY_ITEM_INDICATOR            VARCHAR2(30)  NOT NULL,
  PRODUCT_STOP_DATE             DATE          NOT NULL,
  OUTLET_STYLE_INDICATOR        VARCHAR2(10)  NOT NULL,
  MULTI_CHANNEL_IND             VARCHAR2(20)  NOT NULL,
  ORI_STYLE_COLOR_ID            NUMBER(7)     NOT NULL
);


ALTER TABLE DIM_STYLE_COLOR ADD CONSTRAINT UN1DIM_STYLE_COLOR UNIQUE(SOURCE_BUSKEY) ;
ALTER TABLE DIM_STYLE_COLOR ADD CONSTRAINT UN2DIM_STYLE_COLOR UNIQUE(TARGET_BUSKEY) ;
ALTER TABLE DIM_STYLE_COLOR ADD CONSTRAINT FKDIM_STYLE_COLOR_S FOREIGN KEY(STYLE_ID) REFERENCES DIM_STYLE(STYLE_ID);

CREATE INDEX XIE1DIM_STYLE_COLOR ON DIM_STYLE_COLOR(STYLE_ID);

--6,DIM_STYLE_COLOR_SIZE
CREATE TABLE DIM_STYLE_COLOR_SIZE(
  STYLE_COLOR_SIZE_ID           NUMBER(7)     NOT NULL
  CONSTRAINT PKDIM_STYLE_COLOR_SIZE PRIMARY KEY,
  SOURCE_BUSKEY                 VARCHAR2(60)  NOT NULL,
  TARGET_BUSKEY                 VARCHAR2(60)  NOT NULL,
  STYLE_COLOR_ID                NUMBER(7)     NOT NULL, 
  SIZE_CODE                     VARCHAR2(20)  NOT NULL,
/*  
  SIZE_NAME1                    VARCHAR2(40)  NOT NULL,
  SIZE_NAME2                    VARCHAR2(40)  NOT NULL,
*/
  SIZE_ITEM_ID                  NUMBER(7)     NOT NULL,
  UPC                           VARCHAR2(20)  NOT NULL,
  ARTICLE_NUMBER                VARCHAR2(60)  NOT NULL,
  ORI_STYLE_SIZE_ID             NUMBER(7)     NOT NULL
);

ALTER TABLE DIM_STYLE_COLOR_SIZE ADD CONSTRAINT UN1DIM_STYLE_COLOR_SIZE UNIQUE(SOURCE_BUSKEY);
ALTER TABLE DIM_STYLE_COLOR_SIZE ADD CONSTRAINT UN2DIM_STYLE_COLOR_SIZE UNIQUE(STYLE_COLOR_ID, SIZE_CODE);
ALTER TABLE DIM_STYLE_COLOR_SIZE ADD CONSTRAINT UN3DIM_STYLE_COLOR_SIZE UNIQUE(TARGET_BUSKEY);
ALTER TABLE DIM_STYLE_COLOR_SIZE ADD CONSTRAINT FKDIM_STYLE_COLOR_SIZE_SC FOREIGN KEY(STYLE_COLOR_ID) REFERENCES DIM_STYLE_COLOR(STYLE_COLOR_ID);
ALTER TABLE DIM_STYLE_COLOR_SIZE ADD CONSTRAINT FKDIM_STYLE_COLOR_SIZE_ITEM FOREIGN KEY(SIZE_ITEM_ID) REFERENCES DIM_SIZE_ITEM(SIZE_ITEM_ID);

CREATE INDEX XIE1DIM_STYLE_COLOR_SIZE ON DIM_STYLE_COLOR_SIZE(STYLE_COLOR_ID);
CREATE INDEX XIE2DIM_STYLE_COLOR_SIZE ON DIM_STYLE_COLOR_SIZE(SIZE_ITEM_ID);

--7,DIM_YEAR_SEASON
CREATE TABLE DIM_YEAR_SEASON(
  YEAR_SEASON_ID                   NUMBER(7)    NOT NULL
    CONSTRAINT PKDIM_YEAR_SEASON PRIMARY KEY,
  SOURCE_BUSKEY                    VARCHAR2(30) NOT NULL,
  STYLE_YEAR                       NUMBER(4)    NOT NULL,
  SEASON_NAME                      VARCHAR2(30) NOT NULL,
  ORI_SEASON_ID                    NUMBER(7)    NOT NULL
);

ALTER TABLE DIM_YEAR_SEASON ADD CONSTRAINT UN1DIM_YEAR_SEASON UNIQUE(SOURCE_BUSKEY);


CREATE TABLE DIM_STYLE_YEAR_SEASON(
  STYLE_YEAR_SEASON_ID           NUMBER(7)    NOT NULL
  CONSTRAINT PKDIM_STYLE_YEAR_SEASON PRIMARY KEY,
  SOURCE_BUSKEY                  VARCHAR2(60) NOT NULL,--STYLE NUMBER+COLOR_CODE+YEAR_MONTH
  STYLE_COLOR_ID                 NUMBER(7)    NOT NULL,
  SMONTH_ID                      NUMBER(6)    NOT NULL,
  YEAR_SEASON_ID                 NUMBER(5)    NOT NULL,
  REAL_YEAR_SEASON_ID            NUMBER(5)    NOT NULL
  );
ALTER TABLE DIM_STYLE_YEAR_SEASON ADD CONSTRAINT UN1DIM_STYLE_YEAR_SEASON UNIQUE(SOURCE_BUSKEY);
ALTER TABLE DIM_STYLE_YEAR_SEASON ADD CONSTRAINT UN2DIM_STYLE_YEAR_SEASON UNIQUE(STYLE_COLOR_ID,SMONTH_ID);

ALTER TABLE DIM_STYLE_YEAR_SEASON ADD CONSTRAINT FKDIM_STYLE_YEAR_SEASON_S FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);
ALTER TABLE DIM_STYLE_YEAR_SEASON ADD CONSTRAINT FKDIM_STYLE_YEAR_SEASON_SC FOREIGN KEY(STYLE_COLOR_ID) REFERENCES DIM_STYLE_COLOR(STYLE_COLOR_ID);
ALTER TABLE DIM_STYLE_YEAR_SEASON ADD CONSTRAINT FKDIM_STYLE_YEAR_SEASON_M FOREIGN KEY(SMONTH_ID) REFERENCES DIM_DATE_SMONTH(SMONTH_ID);
ALTER TABLE DIM_STYLE_YEAR_SEASON ADD CONSTRAINT FKDIM_STYLE_YEAR_SEASON_Y FOREIGN KEY(REAL_YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);


CREATE INDEX XIE1DIM_STYLE_YEAR_SEASON ON DIM_STYLE_YEAR_SEASON(YEAR_SEASON_ID);
CREATE INDEX XIE2DIM_STYLE_YEAR_SEASON ON DIM_STYLE_YEAR_SEASON(REAL_YEAR_SEASON_ID);
CREATE INDEX XIE3DIM_STYLE_YEAR_SEASON ON DIM_STYLE_YEAR_SEASON(STYLE_COLOR_ID);
CREATE INDEX XIE4DIM_STYLE_YEAR_SEASON ON DIM_STYLE_YEAR_SEASON(SMONTH_ID);




--9,DIM_GP_GP
CREATE TABLE DIM_GP_GP(
  GP_GP_ID                       NUMBER(7) NOT NULL
  CONSTRAINT PKDIM_GP_GP PRIMARY KEY,
  SOURCE_BUSKEY                  VARCHAR2(30) NOT NULL,
  NAME                           VARCHAR2(30) NOT NULL
);

ALTER TABLE DIM_GP_GP ADD CONSTRAINT UN1DIM_GP_GP UNIQUE(SOURCE_BUSKEY);

--10,DIM_GP_SIZE
CREATE TABLE DIM_GP_SIZE(
  GP_SIZE_ID                     NUMBER(7)    NOT NULL
  CONSTRAINT PKDIM_GP_SIZE PRIMARY KEY,
  SOURCE_BUSKEY                  VARCHAR2(30) NOT NULL,
  GP_GP_ID                       NUMBER(7)    NOT NULL,
  SIZE_CODE                      VARCHAR2(30) NOT NULL,
  RATIO                          NUMBER(7)    NOT NULL
);

ALTER TABLE DIM_GP_SIZE ADD CONSTRAINT UN1DIM_GP_SIZE UNIQUE(SOURCE_BUSKEY);
ALTER TABLE DIM_GP_SIZE ADD CONSTRAINT FKDIM_GP_SIZE_GP FOREIGN KEY(GP_GP_ID) REFERENCES DIM_GP_GP(GP_GP_ID);

CREATE INDEX XIE1DIM_GP_SIZE ON DIM_GP_SIZE(GP_GP_ID);

--11,DIM_STYLE_COLOR_SIZE_GP
CREATE TABLE DIM_STYLE_COLOR_SIZE_GP(
  STYLE_COLOR_SIZE_GP_ID               NUMBER(7)    NOT NULL
  CONSTRAINT PKDIM_STYLE_COLOR_SIZE_GP PRIMARY KEY,
  SOURCE_BUSKEY                        VARCHAR2(60) NOT NULL,   --PREPACK_CODE+PREPACK_TYPE
  TARGET_BUSKEY                        VARCHAR2(60) NOT NULL,
  GP_SIZE_ID                           NUMBER(7)    NOT NULL,
  STYLE_COLOR_SIZE_ID                  NUMBER(7)    NOT NULL,
  PREPACK_CODE                         VARCHAR2(30) NOT NULL,
  PREPACK_TYPE                         VARCHAR2(10) NOT NULL
);

ALTER TABLE DIM_STYLE_COLOR_SIZE_GP ADD CONSTRAINT UN1_DIM_STYLE_COLOR_SIZE_GP UNIQUE(SOURCE_BUSKEY);
ALTER TABLE DIM_STYLE_COLOR_SIZE_GP ADD CONSTRAINT UN2_DIM_STYLE_COLOR_SIZE_GP UNIQUE(STYLE_COLOR_SIZE_ID,GP_SIZE_ID,PREPACK_CODE,PREPACK_TYPE);
ALTER TABLE DIM_STYLE_COLOR_SIZE_GP ADD CONSTRAINT UN3_DIM_STYLE_COLOR_SIZE_GP_G UNIQUE(STYLE_COLOR_SIZE_ID,PREPACK_CODE, PREPACK_TYPE);
ALTER TABLE DIM_STYLE_COLOR_SIZE_GP ADD CONSTRAINT UN4_DIM_STYLE_COLOR_SIZE_GP UNIQUE(TARGET_BUSKEY);
ALTER TABLE DIM_STYLE_COLOR_SIZE_GP ADD CONSTRAINT FKDIM_STYLE_COLOR_SIZE_GP_G FOREIGN KEY(GP_SIZE_ID) REFERENCES DIM_GP_SIZE(GP_SIZE_ID);
ALTER TABLE DIM_STYLE_COLOR_SIZE_GP ADD CONSTRAINT FKDIM_STYLE_COLOR_SIZE_GP_S FOREIGN KEY(STYLE_COLOR_SIZE_ID) REFERENCES DIM_STYLE_COLOR_SIZE(STYLE_COLOR_SIZE_ID);

CREATE INDEX XIE1DIM_STYLE_COLOR_SIZE_GP ON DIM_STYLE_COLOR_SIZE_GP(GP_SIZE_ID);
CREATE INDEX XIE2DIM_STYLE_COLOR_SIZE_GP ON DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_ID);




--DIM_PROD_ATTR
--DROP TABLE DIM_PROD_ATTR;
CREATE TABLE DIM_PROD_ATTR(
PROD_ATTR_ID                  NUMBER(7) NOT NULL
  CONSTRAINT PK_DIM_PROD_ATTR PRIMARY KEY, 
PROD_ATTR_NAME1               VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME2               VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME3               VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME4               VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME5               VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME6               VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME7               VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME8               VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME9               VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME10              VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME11 	            VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME12              VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME13              VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME14              VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME15              VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME16              VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME17              VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME18              VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME19              VARCHAR2(30) NOT NULL,
PROD_ATTR_NAME20              VARCHAR2(30) NOT NULL,
SOURCE_BUSKEY_HASH_STR        VARCHAR2(30) NOT NULL,
TARGET_BUSKEY_HASH_STR        VARCHAR2(30) NOT NULL
);

--DIM_PROD_ATTR_VALUE
--DROP TABLE DIM_PROD_ATTR_VALUE;
CREATE TABLE DIM_PROD_ATTR_VALUE(
PROD_ATTR_VALUE_ID            NUMBER(7) NOT NULL
  CONSTRAINT PK_DIM_PROD_ATTR_VALUE PRIMARY KEY,
PROD_ATTR_ID                  NUMBER(6) NOT NULL,
PROD_ATTR_VALUE1              VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE2              VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE3              VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE4              VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE5              VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE6              VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE7              VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE8              VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE9              VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE10             VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE11             VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE12             VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE13             VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE14             VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE15             VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE16             VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE17             VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE18             VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE19             VARCHAR2(60) NOT NULL,
PROD_ATTR_VALUE20             VARCHAR2(60) NOT NULL,
SOURCE_BUSKEY                 VARCHAR2(40) NOT NULL,
TARGET_BUSKEY                 VARCHAR2(40) NOT NULL
);

ALTER TABLE DIM_PROD_ATTR_VALUE ADD CONSTRAINT FK_DIM_PROD_ATTR_VALUE_ATTR FOREIGN KEY(PROD_ATTR_ID) REFERENCES DIM_PROD_ATTR(PROD_ATTR_ID);

CREATE INDEX XIE1DIM_PROD_ATTR_VALUE ON DIM_PROD_ATTR_VALUE(PROD_ATTR_ID);


CREATE TABLE DIM_PROD_ATTR_VAL_REL(
PROD_ATTR_VALUE_ID              NUMBER(7) NOT NULL,
STYLE_COLOR_SIZE_ID             NUMBER(7) NOT NULL,
CONSTRAINT PK_DIM_PROD_ATTR_VAL_REL PRIMARY KEY(PROD_ATTR_VALUE_ID,STYLE_COLOR_SIZE_ID)
) ORGANIZATION INDEX;

ALTER TABLE DIM_PROD_ATTR_VAL_REL ADD CONSTRAINT FK_DIM_PROD_ATTR_VAL_REL_V FOREIGN KEY(PROD_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);
ALTER TABLE DIM_PROD_ATTR_VAL_REL ADD CONSTRAINT FK_DIM_PROD_ATTR_VAL_REL_S FOREIGN KEY(STYLE_COLOR_SIZE_ID) REFERENCES DIM_STYLE_COLOR_SIZE(STYLE_COLOR_SIZE_ID);

CREATE INDEX XIE1DIM_PROD_ATTR_VAL_REL ON DIM_PROD_ATTR_VAL_REL(STYLE_COLOR_SIZE_ID);
CREATE INDEX XIE2DIM_PROD_ATTR_VAL_REL ON DIM_PROD_ATTR_VAL_REL(PROD_ATTR_VALUE_ID);





--DIM_YEARSEASON_ATTR
--DROP TABLE DIM_YEARSEASON_ATTR;
CREATE TABLE DIM_YEARSEASON_ATTR(
YEARSEASON_ATTR_ID                  NUMBER(7) NOT NULL
  CONSTRAINT PK_DIM_YEARSEASON_ATTR PRIMARY KEY, 
YEARSEASON_ATTR_NAME1               VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME2               VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME3               VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME4               VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME5               VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME6               VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME7               VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME8               VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME9               VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME10              VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME11 	            VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME12              VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME13              VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME14              VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME15              VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME16              VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME17              VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME18              VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME19              VARCHAR2(30) NOT NULL,
YEARSEASON_ATTR_NAME20              VARCHAR2(30) NOT NULL,
SOURCE_BUSKEY_HASH_STR              VARCHAR2(30) NOT NULL,
TARGET_BUSKEY_HASH_STR              VARCHAR2(30) NOT NULL
);

--DIM_YEARSEASON_ATTR_VALUE
--DROP TABLE DIM_YEARSEASON_ATTR_VALUE;
CREATE TABLE DIM_YEARSEASON_ATTR_VALUE(
YEARSEASON_ATTR_VALUE_ID            NUMBER(7) NOT NULL
  CONSTRAINT PK_DIM_YEARSEASON_ATTR_VALUE PRIMARY KEY,
YEARSEASON_ATTR_ID                  NUMBER(6) NOT NULL,
YEARSEASON_ATTR_VALUE1              VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE2              VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE3              VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE4              VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE5              VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE6              VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE7              VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE8              VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE9              VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE10             VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE11             VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE12             VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE13             VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE14             VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE15             VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE16             VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE17             VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE18             VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE19             VARCHAR2(60) NOT NULL,
YEARSEASON_ATTR_VALUE20             VARCHAR2(60) NOT NULL,
SOURCE_BUSKEY                       VARCHAR2(40) NOT NULL,
TARGET_BUSKEY                       VARCHAR2(40) NOT NULL
);

ALTER TABLE DIM_YEARSEASON_ATTR_VALUE ADD CONSTRAINT FK_DIM_YEARSEASON_ATTR_VALUE_A FOREIGN KEY(YEARSEASON_ATTR_ID) REFERENCES DIM_YEARSEASON_ATTR(YEARSEASON_ATTR_ID);

CREATE INDEX XIE1DIM_YEARSEASON_ATTR_VALUE ON DIM_YEARSEASON_ATTR_VALUE(YEARSEASON_ATTR_ID);


CREATE TABLE DIM_YEARSEASON_ATTR_VAL_REL(
YEARSEASON_ATTR_VALUE_ID              NUMBER(7) NOT NULL,
STYLE_YEAR_SEASON_ID                  NUMBER(7) NOT NULL,
CONSTRAINT PK_DIM_YEARSEASON_ATTR_VAL_REL PRIMARY KEY(YEARSEASON_ATTR_VALUE_ID,STYLE_YEAR_SEASON_ID)
) ORGANIZATION INDEX;

ALTER TABLE DIM_YEARSEASON_ATTR_VAL_REL ADD CONSTRAINT FK_DIM_YEARSEASON_ATTRV_REL_V FOREIGN KEY(YEARSEASON_ATTR_VALUE_ID) REFERENCES DIM_YEARSEASON_ATTR_VALUE(YEARSEASON_ATTR_VALUE_ID);
ALTER TABLE DIM_YEARSEASON_ATTR_VAL_REL ADD CONSTRAINT FK_DIM_YEARSEASON_ATTRV_REL_S FOREIGN KEY(STYLE_YEAR_SEASON_ID) REFERENCES DIM_STYLE_YEAR_SEASON(STYLE_YEAR_SEASON_ID);

CREATE INDEX XIE1DIM_YEARSEASON_ATTRV_REL ON DIM_YEARSEASON_ATTR_VAL_REL(STYLE_YEAR_SEASON_ID);
CREATE INDEX XIE2DIM_YEARSEASON_ATTRV_REL ON DIM_YEARSEASON_ATTR_VAL_REL(YEARSEASON_ATTR_VALUE_ID);



--*******************************************************************************************
--**********************************COMPANY DOOR dimensions**********************************
--*******************************************************************************************
--This is a SCD1 dimension with a dynamic hierarch determined by clint from interface:
--LOCATION DIMENSION RE-DESIGN
CREATE TABLE DIM_STORE_LOC(
  STORE_LOC_ID                  NUMBER(7)    NOT NULL
    CONSTRAINT PKDIM_LOCATION PRIMARY KEY,
  SOURCE_BUSKEY                 VARCHAR2(30) NOT NULL,
  TARGET_BUSKEY                 VARCHAR2(30) NOT NULL,  
  LOC_DESC                      VARCHAR2(30) NOT NULL,
  LOC_TYPE                      VARCHAR2(20) NOT NULL,                 --COUNTRY/DC/STOCK_CATEGORY/STORE
  LOC_ATTR1                     VARCHAR2(30) NOT NULL,
  LOC_ATTR2                     VARCHAR2(30) NOT NULL,
  LOC_ATTR3                     VARCHAR2(30) NOT NULL,
  LOC_ATTR4                     VARCHAR2(30) NOT NULL,
  LOC_ATTR5                     VARCHAR2(30) NOT NULL,
  LOC_ATTR6                     VARCHAR2(30) NOT NULL,
  LOC_ATTR7                     VARCHAR2(30) NOT NULL,
  LOC_ATTR8                     VARCHAR2(30) NOT NULL,
  LOC_ATTR9                     VARCHAR2(30) NOT NULL,
  LOC_ATTR10                    VARCHAR2(30) NOT NULL                  
);

ALTER TABLE DIM_STORE_LOC ADD CONSTRAINT UN1DIM_STORE_LOC UNIQUE(SOURCE_BUSKEY);
ALTER TABLE DIM_STORE_LOC ADD CONSTRAINT UN2DIM_STORE_LOC UNIQUE(TARGET_BUSKEY);

--DROP TABLE DIM_STORE_LOC_REL;
CREATE TABLE DIM_STORE_LOC_REL(
  PARENT_STORE_LOC_ID                  NUMBER(7)    NOT NULL,
  SUBSIDIARY_STORE_LOC_ID              NUMBER(7)    NOT NULL,
  LEVEL_FROM_PARENT                    NUMBER(2)    NOT NULL,
  PARENT_LEVEL_NAME                    VARCHAR2(20) NOT NULL,
  SUBSIDIARY_LEVEL_NAME                VARCHAR2(20) NOT NULL,
  BOTTOM_FLAG                          CHAR         NOT NULL,         --Y/N
  TOP_FLAG                             CHAR         NOT NULL          --Y/N
);        

ALTER TABLE DIM_STORE_LOC_REL ADD CONSTRAINT PKDIM_STORE_LOC_REL PRIMARY KEY(PARENT_STORE_LOC_ID,SUBSIDIARY_STORE_LOC_ID);
ALTER TABLE DIM_STORE_LOC_REL ADD CONSTRAINT FKDIM_STORE_LOC_REL_P FOREIGN KEY(PARENT_STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);
ALTER TABLE DIM_STORE_LOC_REL ADD CONSTRAINT FKDIM_STORE_LOC_REL_S FOREIGN KEY(SUBSIDIARY_STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

CREATE INDEX XIE1DIM_STORE_LOC_REL ON DIM_STORE_LOC_REL(PARENT_STORE_LOC_ID);
CREATE INDEX XIE2DIM_STORE_LOC_REL ON DIM_STORE_LOC_REL(SUBSIDIARY_STORE_LOC_ID);

--DIM_STORE_STORE
CREATE TABLE DIM_STORE_STORE
(
  STORE_ID                     NUMBER(7)    NOT NULL
  CONSTRAINT PKDIM_STORE_STORE PRIMARY KEY,
  SOURCE_BUSKEY                VARCHAR2(30) NOT NULL,
  TARGET_BUSKEY                VARCHAR2(30) NOT NULL,
  STORE_LOC_ID                 NUMBER(7)    NOT NULL,
  DOOR_NUM                     VARCHAR2(13) NOT NULL,
  DOOR_NAME                    VARCHAR2(30) NOT NULL,
  REGION                       VARCHAR2(30) NOT NULL,
  DEMOGRAPHIC                  VARCHAR2(30) NOT NULL,
  DOOR_TYPE                    NUMBER(2)    NOT NULL,
  ETHNICITY                    VARCHAR2(30) NOT NULL,
  COUNTRY                      VARCHAR2(30) NOT NULL,
  DC                           VARCHAR2(30) NOT NULL,
  ORI_STORE_TYPE_ID            NUMBER(7)    NOT NULL,
  STORE_TYPE                   VARCHAR2(30) NOT NULL,
  STOCK_CATEGORY               VARCHAR2(30) NOT NULL,
  GEOGRAPHY                    VARCHAR2(30) NOT NULL,
  CLIMATE                      VARCHAR2(30) NOT NULL,
  STORE_GROUP                  VARCHAR2(40) NOT NULL,
  PRICING_ZONE                 VARCHAR2(20) NOT NULL,
  LOC_ATTR1                    VARCHAR2(30) NOT NULL,
  LOC_ATTR2                    VARCHAR2(30) NOT NULL,
  LOC_ATTR3                    VARCHAR2(30) NOT NULL,
  LOC_ATTR4                    VARCHAR2(30) NOT NULL,
  LOC_ATTR5                    VARCHAR2(30) NOT NULL,
  LOC_ATTR6                    VARCHAR2(30) NOT NULL,
  DISTANCE                     NUMBER(9,2)  NOT NULL,
  LOC_ATTR7                    VARCHAR2(30) NOT NULL,
  ORI_COMPANY_DOOR_ID          NUMBER(7)    NOT NULL,
  STORE_CATEGORY               VARCHAR2(60) NOT NULL,
  SEQUENCE                     NUMBER(5)    NOT NULL,
  ORI_SISTER_DOOR_ID           NUMBER(7)    NOT NULL,
  SISTER_SOTRE_ID              NUMBER(7)    NOT NULL,
  TOTAL_SQ_FT                  NUMBER(9,2)  NOT NULL,
  COMP_INDICATOR               NUMBER(1)    NOT NULL,
  AVAILABLE                    NUMBER(1)    NOT NULL,
  TURN_DATE                    DATE         NOT NULL,
  SOFT_DATE                    DATE         NOT NULL,
  GO_DATE                      DATE         NOT NULL,
  CLOSE_DATE                   DATE         NOT NULL,
  TRANSFER_DOOR_ID             NUMBER(7)    NOT NULL,
  DISPLAY_CAPACITY             NUMBER(7)    NOT NULL,
  INVENTORY_CAPACITY           NUMBER(7)    NOT NULL,
  REMODEL_TURN_DATE            DATE         NOT NULL,
  REMODEL_START_DATE           DATE         NOT NULL,
  REMODEL_END_DATE             DATE         NOT NULL,
  COMMENTS                     VARCHAR2(300)NOT NULL
);

ALTER TABLE DIM_STORE_STORE ADD CONSTRAINT UN1DIM_STORE_STORE UNIQUE(SOURCE_BUSKEY);
ALTER TABLE DIM_STORE_STORE ADD CONSTRAINT UN2DIM_STORE_STORE UNIQUE(STORE_LOC_ID);
ALTER TABLE DIM_STORE_STORE ADD CONSTRAINT UN3DIM_STORE_STORE UNIQUE(TARGET_BUSKEY);
ALTER TABLE DIM_STORE_STORE ADD CONSTRAINT FKDIM_STORE_STORE_LOC FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);
ALTER TABLE DIM_STORE_STORE ADD CONSTRAINT FKDIM_STORE_STORE_SISTER FOREIGN KEY(SISTER_SOTRE_ID) REFERENCES DIM_STORE_STORE(STORE_ID);
CREATE INDEX XIE1DIM_STORE_STORE ON DIM_STORE_STORE(ORI_COMPANY_DOOR_ID);
CREATE INDEX XIE2DIM_STORE_STORE ON DIM_STORE_STORE(SISTER_SOTRE_ID);




--DIM_LOC_ATTR
--DROP TABLE DIM_LOC_ATTR;
CREATE TABLE DIM_LOC_ATTR(
LOC_ATTR_ID                  NUMBER(7) NOT NULL
  CONSTRAINT PK_DIM_LOC_ATTR PRIMARY KEY, 
LOC_ATTR_NAME1               VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME2               VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME3               VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME4               VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME5               VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME6               VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME7               VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME8               VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME9               VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME10              VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME11 	           VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME12              VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME13              VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME14              VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME15              VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME16              VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME17              VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME18              VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME19              VARCHAR2(30) NOT NULL,
LOC_ATTR_NAME20              VARCHAR2(30) NOT NULL,
SOURCE_BUSKEY_HASH_STR       VARCHAR2(30) NOT NULL,
TARGET_BUSKEY_HASH_STR       VARCHAR2(30) NOT NULL
);

--DIM_LOC_ATTR_VALUE
--DROP TABLE DIM_LOC_ATTR_VALUE;
CREATE TABLE DIM_LOC_ATTR_VALUE(
LOC_ATTR_VALUE_ID            NUMBER(7) NOT NULL
  CONSTRAINT PK_DIM_LOC_ATTR_VALUE PRIMARY KEY,
LOC_ATTR_ID                  NUMBER(6) NOT NULL,
LOC_ATTR_VALUE1              VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE2              VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE3              VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE4              VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE5              VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE6              VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE7              VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE8              VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE9              VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE10             VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE11             VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE12             VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE13             VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE14             VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE15             VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE16             VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE17             VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE18             VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE19             VARCHAR2(60) NOT NULL,
LOC_ATTR_VALUE20             VARCHAR2(60) NOT NULL,
SOURCE_BUSKEY                VARCHAR2(40) NOT NULL,
TARGET_BUSKEY                VARCHAR2(40) NOT NULL
);

ALTER TABLE DIM_LOC_ATTR_VALUE ADD CONSTRAINT FK_DIM_LOC_ATTR_VALUE_ATTR FOREIGN KEY(LOC_ATTR_ID) REFERENCES DIM_LOC_ATTR(LOC_ATTR_ID);

CREATE INDEX XIE1DIM_LOC_ATTR_VALUE ON DIM_LOC_ATTR_VALUE(LOC_ATTR_ID);

--DROP TABLE DIM_LOC_ATTR_VAL_REL;
CREATE TABLE DIM_LOC_ATTR_VAL_REL(
LOC_ATTR_VALUE_ID              NUMBER(7) NOT NULL,
STORE_ID                       NUMBER(7) NOT NULL,
CONSTRAINT PK_DIM_LOC_ATTR_VAL_REL PRIMARY KEY(LOC_ATTR_VALUE_ID,STORE_ID)
) ORGANIZATION INDEX;

ALTER TABLE DIM_LOC_ATTR_VAL_REL ADD CONSTRAINT FK_DIM_LOC_ATTR_VAL_REL_V FOREIGN KEY(LOC_ATTR_VALUE_ID) REFERENCES DIM_LOC_ATTR_VALUE(LOC_ATTR_VALUE_ID);
ALTER TABLE DIM_LOC_ATTR_VAL_REL ADD CONSTRAINT FK_DIM_LOC_ATTR_VAL_REL_S FOREIGN KEY(STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID);

CREATE INDEX XIE1DIM_LOC_ATTR_VAL_REL ON DIM_LOC_ATTR_VAL_REL(STORE_ID);
CREATE INDEX XIE2DIM_LOC_ATTR_VAL_REL ON DIM_LOC_ATTR_VAL_REL(LOC_ATTR_VALUE_ID);




--*******************************************************************************************
--**********************************SALES STYLE dimensions**********************************
--*******************************************************************************************
CREATE TABLE DIM_SALES_STYLE
(
  SALES_STYLE_ID               NUMBER(5) NOT NULL
  CONSTRAINT PKDIM_SALES_STYLE PRIMARY KEY,
  SOURCE_BUSKEY                VARCHAR2(30) NOT NULL,
  SALES_STYLE_CODE             VARCHAR2(20) NOT NULL,
  SALES_STYLE_NAME             VARCHAR2(60) NOT NULL,
  ORI_SALES_STYLE_ID           NUMBER(5) NOT NULL
);

ALTER TABLE DIM_SALES_STYLE ADD CONSTRAINT UN1_DIM_SALES_STYLE UNIQUE(SOURCE_BUSKEY);



--*******************************************************************************************
--**********************************CRITERIA  imensions*************************************
--*******************************************************************************************
--1,dim_CRITERIA_group
CREATE TABLE DIM_CRITERIA_GROUP(
CRITERIA_GROUP_ID             NUMBER(7)    NOT NULL
  CONSTRAINT PKDIM_CRITERIA_GROUP PRIMARY KEY,
SOURCE_BUSKEY                  VARCHAR2(20) NOT NULL,
DIMENSION                      VARCHAR2(20) NOT NULL,
HIERARCHY                      VARCHAR2(30) NOT NULL,
DW_START_DATE                  DATE        NOT NULL,
DW_END_DATE                    DATE        NOT NULL,
DW_VERSION                     NUMBER(3)   NOT NULL,
DW_CURRFLAG                    CHAR        NOT NULL
);

ALTER TABLE DIM_CRITERIA_GROUP ADD CONSTRAINT UN1DIM_CRITERIA_GROUP UNIQUE(SOURCE_BUSKEY,DW_START_DATE);

CREATE INDEX XIE1DIM_CRITERIA_GROUP ON DIM_CRITERIA_GROUP(SOURCE_BUSKEY,DW_CURRFLAG);

--2,dim_CRITERIA_item
CREATE TABLE DIM_CRITERIA_ITEM(
CRITERIA_ITEM_ID               NUMBER(7)    NOT NULL
  CONSTRAINT PKDIM_CRITERIA_ITEM PRIMARY KEY,
SOURCE_BUSKEY                  VARCHAR2(30) NOT NULL,
CRITERIA_GROUP_ID             NUMBER(7)    NOT NULL,
NAME                           VARCHAR2(30) NOT NULL,
VALUE                          VARCHAR2(30) NOT NULL,
SEQ                            NUMBER(7)    NOT NULL
);

ALTER TABLE DIM_CRITERIA_ITEM ADD CONSTRAINT UN1DIM_CRITERIA_ITEM UNIQUE(SOURCE_BUSKEY,CRITERIA_GROUP_ID);

ALTER TABLE DIM_CRITERIA_ITEM ADD CONSTRAINT FKDIM_CRITERIA_ITEM_G FOREIGN KEY(CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

CREATE INDEX XIE1DIM_CRITERIA_ITEM ON DIM_CRITERIA_ITEM(CRITERIA_GROUP_ID);

--3,DIM_CRITERIA_GROUP_PROD_REL
--DROP TABLE DIM_CRITERIA_GROUP_PROD_REL PURGE;
CREATE GLOBAL TEMPORARY TABLE DIM_CRITERIA_GROUP_PROD_REL(
STYLE_COLOR_SIZE_ID            NUMBER(7)    NOT NULL,
CRITERIA_GROUP_ID              NUMBER(7)    NOT NULL,
CONSTRAINT PKDIM_CRITERIA_GROUP_PROD_REL PRIMARY KEY(CRITERIA_GROUP_ID,STYLE_COLOR_SIZE_ID)
)ON COMMIT PRESERVE ROWS;


CREATE INDEX XIE1DIM_CRITERIA_GROUP_P_R ON DIM_CRITERIA_GROUP_PROD_REL(STYLE_COLOR_SIZE_ID);
CREATE INDEX XIE2DIM_CRITERIA_GROUP_P_R ON DIM_CRITERIA_GROUP_PROD_REL(CRITERIA_GROUP_ID);

--4,DIM_CRITERIA_GROUP_LOC_REL
--DROP TABLE DIM_CRITERIA_GROUP_LOC_REL PURGE;
CREATE GLOBAL TEMPORARY TABLE  DIM_CRITERIA_GROUP_LOC_REL(
STORE_ID                       NUMBER(7)    NOT NULL,
CRITERIA_GROUP_ID              NUMBER(7)    NOT NULL,
CONSTRAINT PKDIM_CRITERIA_GROUP_LOC_REL PRIMARY KEY(CRITERIA_GROUP_ID,STORE_ID)
)ON COMMIT PRESERVE ROWS;


CREATE INDEX XIE1DIM_CRITERIA_GROUP_L_R ON DIM_CRITERIA_GROUP_LOC_REL(STORE_ID);
CREATE INDEX XIE2DIM_CRITERIA_GROUP_L_R ON DIM_CRITERIA_GROUP_LOC_REL(CRITERIA_GROUP_ID);


--5,DIM_CRITERIA_GROUP_YS_REL
--DROP TABLE DIM_CRITERIA_GROUP_YS_REL PURGE;
CREATE GLOBAL TEMPORARY TABLE  DIM_CRITERIA_GROUP_YS_REL(
STYLE_YEAR_SEASON_ID         NUMBER(7)    NOT NULL,
CRITERIA_GROUP_ID            NUMBER(7)    NOT NULL,
CONSTRAINT PKDIM_CRITERIA_GROUP_YS_REL PRIMARY KEY(CRITERIA_GROUP_ID,STYLE_YEAR_SEASON_ID)
)ON COMMIT PRESERVE ROWS;


CREATE INDEX XIE1DIM_CRITERIA_GROUP_YS_R_S ON DIM_CRITERIA_GROUP_YS_REL(STYLE_YEAR_SEASON_ID);
CREATE INDEX XIE2DIM_CRITERIA_GROUP_YS_R_C ON DIM_CRITERIA_GROUP_YS_REL(CRITERIA_GROUP_ID);



--*******************************************************************************************
--**********************************PO dimensions**********************************
--*******************************************************************************************

--SCD1, Each row represent the CRITERIAs and date while doing PO allocation
CREATE TABLE DIM_PO_BD(
PO_BD_ID                       NUMBER(7)    NOT NULL,
SOURCE_BUSKEY                  VARCHAR2(30) NOT NULL,
PO_NUMBER                      VARCHAR2(30) NOT NULL,
PO_BD_DATE                     DATE         NOT NULL,
PO_BD_NAME                     VARCHAR2(30) NOT NULL,
PROD_CRITERIA_GROUP_ID         NUMBER(7)    NOT NULL,
LOC_CRITERIA_GROUP_ID          NUMBER(7)    NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID   NUMBER(7)    NOT NULL,
CONSTRAINT PKDIM_PO_BD PRIMARY KEY(PO_BD_ID)
);


ALTER TABLE DIM_PO_BD ADD CONSTRAINT UN1DIM_PO_BD UNIQUE(SOURCE_BUSKEY);


ALTER TABLE DIM_PO_BD ADD CONSTRAINT FKDIM_PO_BD_P
      FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID); 
      
ALTER TABLE DIM_PO_BD ADD CONSTRAINT FKDIM_PO_BD_L
      FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       
           
ALTER TABLE DIM_PO_BD ADD CONSTRAINT FKDIM_PO_BD_YS
      FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       
           
      
CREATE INDEX XIE1DIM_PO_BD ON DIM_PO_BD(PO_NUMBER);
CREATE INDEX XIE2DIM_PO_BD ON DIM_PO_BD(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_PO_BD ON DIM_PO_BD(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE4DIM_PO_BD ON DIM_PO_BD(YEARSEASON_CRITERIA_GROUP_ID);


--SCD1, Each row represent the CRITERIAs and date while doing PO BREAKDOWN RELEASE
CREATE TABLE DIM_PO_BD_RELEASE(
PO_BD_RELEASE_ID                NUMBER(7)    NOT NULL,
SOURCE_BUSKEY                   VARCHAR2(30) NOT NULL,
PO_BD_ID                        NUMBER(7)    NOT NULL,
PO_BD_RELEASE_DATE              DATE         NOT NULL,
PO_BD_RELEASE_NAME              VARCHAR2(30) NOT NULL,
PROD_CRITERIA_GROUP_ID          NUMBER(7)    NOT NULL,
LOC_CRITERIA_GROUP_ID           NUMBER(7)    NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID    NUMBER(7)    NOT NULL,
CONSTRAINT PKDIM_PO_BD_RELEASE PRIMARY KEY(PO_BD_RELEASE_ID)
);


ALTER TABLE DIM_PO_BD_RELEASE ADD CONSTRAINT UN1DIM_PO_BD_RELEASE UNIQUE(SOURCE_BUSKEY);


ALTER TABLE DIM_PO_BD_RELEASE ADD CONSTRAINT FKDIM_PO_BD_RELEASE_P
      FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID); 
      
ALTER TABLE DIM_PO_BD_RELEASE ADD CONSTRAINT FKDIM_PO_BD_RELEASE_L
      FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       
           
ALTER TABLE DIM_PO_BD_RELEASE ADD CONSTRAINT FKDIM_PO_BD_RELEASE_YS
      FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       
           
ALTER TABLE DIM_PO_BD_RELEASE ADD CONSTRAINT FKDIM_PO_BD_RELEASE_BD
      FOREIGN KEY(PO_BD_ID) REFERENCES DIM_PO_BD(PO_BD_ID);       
           
            
CREATE INDEX XIE1DIM_PO_BD_RELEASE ON DIM_PO_BD_RELEASE(PO_BD_ID);
CREATE INDEX XIE2DIM_PO_BD_RELEASE ON DIM_PO_BD_RELEASE(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_PO_BD_RELEASE ON DIM_PO_BD_RELEASE(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE4DIM_PO_BD_RELEASE ON DIM_PO_BD_RELEASE(YEARSEASON_CRITERIA_GROUP_ID);


--SCD1, Each row represent the CRITERIAs and date while doing PO allocation
CREATE TABLE DIM_PO_ALLOCATE(
PO_ALLOCATE_ID                 NUMBER(7)    NOT NULL,
SOURCE_BUSKEY                  VARCHAR2(30) NOT NULL,
PO_BD_RELEASE_ID               NUMBER(7) NOT NULL,
PO_ALLOCATE_DATE               DATE         NOT NULL,
PO_ALLOCATE_NAME               VARCHAR2(30) NOT NULL,
PROD_CRITERIA_GROUP_ID         NUMBER(7)    NOT NULL,
LOC_CRITERIA_GROUP_ID          NUMBER(7)    NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID   NUMBER(7)    NOT NULL,
CONSTRAINT PKDIM_PO_ALLOCATE PRIMARY KEY(PO_ALLOCATE_ID)
);


ALTER TABLE DIM_PO_ALLOCATE ADD CONSTRAINT UN1DIM_PO_ALLOCATE UNIQUE(SOURCE_BUSKEY);


ALTER TABLE DIM_PO_ALLOCATE ADD CONSTRAINT FKDIM_PO_ALLOCATE_P
      FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID); 
      
ALTER TABLE DIM_PO_ALLOCATE ADD CONSTRAINT FKDIM_PO_ALLOCATE_L
      FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       
           
ALTER TABLE DIM_PO_ALLOCATE ADD CONSTRAINT FKDIM_PO_ALLOCATE_YS
      FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       

ALTER TABLE DIM_PO_ALLOCATE ADD CONSTRAINT FKDIM_PO_ALLOCATE_BD_R
FOREIGN KEY(PO_BD_RELEASE_ID) REFERENCES DIM_PO_BD_RELEASE(PO_BD_RELEASE_ID);

CREATE INDEX XIE1DIM_PO_ALLOCATE ON DIM_PO_ALLOCATE(PO_BD_RELEASE_ID);
CREATE INDEX XIE2DIM_PO_ALLOCATE ON DIM_PO_ALLOCATE(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_PO_ALLOCATE ON DIM_PO_ALLOCATE(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE4DIM_PO_ALLOCATE ON DIM_PO_ALLOCATE(YEARSEASON_CRITERIA_GROUP_ID);



CREATE TABLE DIM_PO_RELEASE(
PO_RELEASE_ID                    NUMBER(7)    NOT NULL,
SOURCE_BUSKEY                    VARCHAR2(30) NOT NULL,
PO_ALLOCATE_ID                   NUMBER(7)    NOT NULL,
PO_RELEASE_DATE                  DATE         NOT NULL,
PO_RELEASE_NAME                  VARCHAR2(30) NOT NULL,
PROD_CRITERIA_GROUP_ID           NUMBER(7)    NOT NULL,
LOC_CRITERIA_GROUP_ID            NUMBER(7)    NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID     NUMBER(7)    NOT NULL,
CONSTRAINT PKDIM_PO_RELEASE PRIMARY KEY(PO_RELEASE_ID)
);


ALTER TABLE DIM_PO_RELEASE ADD CONSTRAINT UN1DIM_PO_RELEASE UNIQUE(SOURCE_BUSKEY);

ALTER TABLE DIM_PO_RELEASE ADD CONSTRAINT FKDIM_PO_RELEASE_A 
      FOREIGN KEY(PO_ALLOCATE_ID) REFERENCES DIM_PO_ALLOCATE(PO_ALLOCATE_ID);
      
ALTER TABLE DIM_PO_RELEASE ADD CONSTRAINT FKDIM_PO_RELEASE_P
      FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);        

ALTER TABLE DIM_PO_RELEASE ADD CONSTRAINT FKDIM_PO_RELEASE_L
      FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);          

ALTER TABLE DIM_PO_RELEASE ADD CONSTRAINT FKDIM_PO_RELEASE_YS
      FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID); 
      
CREATE INDEX XIE1DIM_PO_RELEASE ON DIM_PO_RELEASE(PO_ALLOCATE_ID);
CREATE INDEX XIE2DIM_PO_RELEASE ON DIM_PO_RELEASE(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_PO_RELEASE ON DIM_PO_RELEASE(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE4DIM_PO_RELEASE ON DIM_PO_RELEASE(YEARSEASON_CRITERIA_GROUP_ID);

--*******************************************************************************************
--**********************************ASN dimensions**********************************
--*******************************************************************************************


--SCD1, Each row represent the CRITERIAs and date while doing ASN allocation
CREATE TABLE DIM_ASN_BD(
ASN_BD_ID                      NUMBER(7)    NOT NULL,
SOURCE_BUSKEY                  VARCHAR2(30) NOT NULL,
ASN_NUMBER                     VARCHAR2(30) NOT NULL,
ASN_BD_DATE                    DATE         NOT NULL,
ASN_BD_NAME                    VARCHAR2(30) NOT NULL,
PROD_CRITERIA_GROUP_ID         NUMBER(7)    NOT NULL,
LOC_CRITERIA_GROUP_ID          NUMBER(7)    NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID   NUMBER(7)    NOT NULL,
CONSTRAINT PKDIM_ASN_BD PRIMARY KEY(ASN_BD_ID)
);


ALTER TABLE DIM_ASN_BD ADD CONSTRAINT UN1DIM_ASN_BD UNIQUE(SOURCE_BUSKEY);

ALTER TABLE DIM_ASN_BD ADD CONSTRAINT FKDIM_ASN_BD_P
      FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID); 
      
ALTER TABLE DIM_ASN_BD ADD CONSTRAINT FKDIM_ASN_BD_L
      FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       
           
ALTER TABLE DIM_ASN_BD ADD CONSTRAINT FKDIM_ASN_BD_YS
      FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       
           
CREATE INDEX XIE1DIM_ASN_BD ON DIM_ASN_BD(ASN_NUMBER);
CREATE INDEX XIE2DIM_ASN_BD ON DIM_ASN_BD(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_ASN_BD ON DIM_ASN_BD(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE4DIM_ASN_BD ON DIM_ASN_BD(YEARSEASON_CRITERIA_GROUP_ID);


--SCD1, Each row represent the CRITERIAs and date while doing ASN BREAKDOWN RELEASE
CREATE TABLE DIM_ASN_BD_RELEASE(
ASN_BD_RELEASE_ID                      NUMBER(7)    NOT NULL,
SOURCE_BUSKEY                          VARCHAR2(30) NOT NULL,
ASN_BD_ID                              NUMBER(7)    NOT NULL,
ASN_BD_RELEASE_DATE                    DATE         NOT NULL,
ASN_BD_RELEASE_NAME                    VARCHAR2(30) NOT NULL,
PROD_CRITERIA_GROUP_ID                 NUMBER(7)    NOT NULL,
LOC_CRITERIA_GROUP_ID                  NUMBER(7)    NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID           NUMBER(7)    NOT NULL,
CONSTRAINT PKDIM_ASN_BD_RELEASE PRIMARY KEY(ASN_BD_RELEASE_ID)
);


ALTER TABLE DIM_ASN_BD_RELEASE ADD CONSTRAINT UN1DIM_ASN_BD_RELEASE UNIQUE(SOURCE_BUSKEY);


ALTER TABLE DIM_ASN_BD_RELEASE ADD CONSTRAINT FKDIM_ASN_BD_RELEASE_P
      FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID); 
      
ALTER TABLE DIM_ASN_BD_RELEASE ADD CONSTRAINT FKDIM_ASN_BD_RELEASE_L
      FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       
           
ALTER TABLE DIM_ASN_BD_RELEASE ADD CONSTRAINT FKDIM_ASN_BD_RELEASE_YS
      FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       
           
ALTER TABLE DIM_ASN_BD_RELEASE ADD CONSTRAINT FKDIM_ASN_BD_RELEASE_BD
      FOREIGN KEY(ASN_BD_ID) REFERENCES DIM_ASN_BD(ASN_BD_ID);       
           
            
CREATE INDEX XIE1DIM_ASN_BD_RELEASE ON DIM_ASN_BD_RELEASE(ASN_BD_ID);
CREATE INDEX XIE2DIM_ASN_BD_RELEASE ON DIM_ASN_BD_RELEASE(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_ASN_BD_RELEASE ON DIM_ASN_BD_RELEASE(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE4DIM_ASN_BD_RELEASE ON DIM_ASN_BD_RELEASE(YEARSEASON_CRITERIA_GROUP_ID);



--SCD1, Each row represent the CRITERIAs and date while doing ASN allocation
CREATE TABLE DIM_ASN_ALLOCATE(
ASN_ALLOCATE_ID                NUMBER(7)    NOT NULL,
SOURCE_BUSKEY                  VARCHAR2(30) NOT NULL,
ASN_BD_RELEASE_ID              NUMBER(7) NOT NULL,
ASN_ALLOCATE_DATE              DATE         NOT NULL,
ASN_ALLOCATE_NAME              VARCHAR2(30) NOT NULL,
PROD_CRITERIA_GROUP_ID         NUMBER(7)    NOT NULL,
LOC_CRITERIA_GROUP_ID          NUMBER(7)    NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID   NUMBER(7)    NOT NULL,
CONSTRAINT PKDIM_ASN_ALLOCATE PRIMARY KEY(ASN_ALLOCATE_ID)
);


ALTER TABLE DIM_ASN_ALLOCATE ADD CONSTRAINT UN1DIM_ASN_ALLOCATE UNIQUE(SOURCE_BUSKEY);

ALTER TABLE DIM_ASN_ALLOCATE ADD CONSTRAINT FKDIM_ASN_ALLOCATE_P
      FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID); 
      
ALTER TABLE DIM_ASN_ALLOCATE ADD CONSTRAINT FKDIM_ASN_ALLOCATE_L
      FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       
           
ALTER TABLE DIM_ASN_ALLOCATE ADD CONSTRAINT FKDIM_ASN_ALLOCATE_YS
      FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       

ALTER TABLE DIM_ASN_ALLOCATE ADD CONSTRAINT FKDIM_ASN_ALLOCATE_BD_R
FOREIGN KEY(ASN_BD_RELEASE_ID) REFERENCES DIM_ASN_BD_RELEASE(ASN_BD_RELEASE_ID);


CREATE INDEX XIE1DIM_ASN_ALLOCATE ON DIM_ASN_ALLOCATE(ASN_BD_RELEASE_ID);
CREATE INDEX XIE2DIM_ASN_ALLOCATE ON DIM_ASN_ALLOCATE(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_ASN_ALLOCATE ON DIM_ASN_ALLOCATE(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE4DIM_ASN_ALLOCATE ON DIM_ASN_ALLOCATE(YEARSEASON_CRITERIA_GROUP_ID);



CREATE TABLE DIM_ASN_RELEASE(
ASN_RELEASE_ID                    NUMBER(7)    NOT NULL,
SOURCE_BUSKEY                     VARCHAR2(30) NOT NULL,
ASN_ALLOCATE_ID                   NUMBER(7)    NOT NULL,
ASN_RELEASE_DATE                  DATE         NOT NULL,
ASN_RELEASE_NAME                  VARCHAR2(30) NOT NULL,
PROD_CRITERIA_GROUP_ID            NUMBER(7)    NOT NULL,
LOC_CRITERIA_GROUP_ID             NUMBER(7)    NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID      NUMBER(7)    NOT NULL,
CONSTRAINT PKDIM_ASN_RELEASE PRIMARY KEY(ASN_RELEASE_ID)
);


ALTER TABLE DIM_ASN_RELEASE ADD CONSTRAINT UN1DIM_ASN_RELEASE UNIQUE(SOURCE_BUSKEY);

ALTER TABLE DIM_ASN_RELEASE ADD CONSTRAINT FKDIM_ASN_RELEASE_A 
      FOREIGN KEY(ASN_ALLOCATE_ID) REFERENCES DIM_ASN_ALLOCATE(ASN_ALLOCATE_ID);
      
ALTER TABLE DIM_ASN_RELEASE ADD CONSTRAINT FKDIM_ASN_RELEASE_P
      FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);        

ALTER TABLE DIM_ASN_RELEASE ADD CONSTRAINT FKDIM_ASN_RELEASE_L
      FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);          

ALTER TABLE DIM_ASN_RELEASE ADD CONSTRAINT FKDIM_ASN_RELEASE_YS
      FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID); 
      
CREATE INDEX XIE1DIM_ASN_RELEASE ON DIM_ASN_RELEASE(ASN_ALLOCATE_ID);
CREATE INDEX XIE2DIM_ASN_RELEASE ON DIM_ASN_RELEASE(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_ASN_RELEASE ON DIM_ASN_RELEASE(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE4DIM_ASN_RELEASE ON DIM_ASN_RELEASE(YEARSEASON_CRITERIA_GROUP_ID);

--*******************************************************************************************
--**********************************RECEIVER dimensions**********************************
--*******************************************************************************************


--SCD1, Each row represent the CRITERIAs and date while doing receiver allocation
CREATE TABLE DIM_RECEIVER_BD(
RECEIVER_BD_ID                 NUMBER(7)    NOT NULL,
SOURCE_BUSKEY                  VARCHAR2(30) NOT NULL,
RECEIVER_NUMBER                VARCHAR2(30) NOT NULL,
RECEIVER_BD_DATE               DATE         NOT NULL,
RECEIVER_BD_NAME               VARCHAR2(30) NOT NULL,
PROD_CRITERIA_GROUP_ID         NUMBER(7)    NOT NULL,
LOC_CRITERIA_GROUP_ID          NUMBER(7)    NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID   NUMBER(7)    NOT NULL,
CONSTRAINT PKDIM_RECEIVER_BD PRIMARY KEY(RECEIVER_BD_ID)
);


ALTER TABLE DIM_RECEIVER_BD ADD CONSTRAINT UN1DIM_RECEIVER_BD UNIQUE(SOURCE_BUSKEY);

ALTER TABLE DIM_RECEIVER_BD ADD CONSTRAINT FKDIM_RECEIVER_BD_P
      FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID); 
      
ALTER TABLE DIM_RECEIVER_BD ADD CONSTRAINT FKDIM_RECEIVER_BD_L
      FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       

ALTER TABLE DIM_RECEIVER_BD ADD CONSTRAINT FKDIM_RECEIVER_BD_YS
      FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       
                      

CREATE INDEX XIE1DIM_RECEIVER_BD ON DIM_RECEIVER_BD(RECEIVER_NUMBER);
CREATE INDEX XIE2DIM_RECEIVER_BD ON DIM_RECEIVER_BD(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_RECEIVER_BD ON DIM_RECEIVER_BD(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE4DIM_RECEIVER_BD ON DIM_RECEIVER_BD(YEARSEASON_CRITERIA_GROUP_ID);


--SCD1, Each row represent the CRITERIAs and date while doing RECEIVER BREAKDOWN RELEASE
CREATE TABLE DIM_RECEIVER_BD_RELEASE(
RECEIVER_BD_RELEASE_ID                NUMBER(7)    NOT NULL,
SOURCE_BUSKEY                         VARCHAR2(30) NOT NULL,
RECEIVER_BD_ID                        NUMBER(7)    NOT NULL,
RECEIVER_BD_RELEASE_DATE              DATE         NOT NULL,
RECEIVER_BD_RELEASE_NAME              VARCHAR2(30) NOT NULL,
PROD_CRITERIA_GROUP_ID                NUMBER(7)    NOT NULL,
LOC_CRITERIA_GROUP_ID                 NUMBER(7)    NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID          NUMBER(7)    NOT NULL,
CONSTRAINT PKDIM_RECEIVER_BD_RELEASE PRIMARY KEY(RECEIVER_BD_RELEASE_ID)
);


ALTER TABLE DIM_RECEIVER_BD_RELEASE ADD CONSTRAINT UN1DIM_RECEIVER_BD_RELEASE UNIQUE(SOURCE_BUSKEY);


ALTER TABLE DIM_RECEIVER_BD_RELEASE ADD CONSTRAINT FKDIM_RECEIVER_BD_RELEASE_P
      FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID); 
      
ALTER TABLE DIM_RECEIVER_BD_RELEASE ADD CONSTRAINT FKDIM_RECEIVER_BD_RELEASE_L
      FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       
           
ALTER TABLE DIM_RECEIVER_BD_RELEASE ADD CONSTRAINT FKDIM_RECEIVER_BD_RELEASE_YS
      FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       
           
ALTER TABLE DIM_RECEIVER_BD_RELEASE ADD CONSTRAINT FKDIM_RECEIVER_BD_RELEASE_BD
      FOREIGN KEY(RECEIVER_BD_ID) REFERENCES DIM_RECEIVER_BD(RECEIVER_BD_ID);       
           
            
CREATE INDEX XIE1DIM_RECEIVER_BD_RELEASE ON DIM_RECEIVER_BD_RELEASE(RECEIVER_BD_ID);
CREATE INDEX XIE2DIM_RECEIVER_BD_RELEASE ON DIM_RECEIVER_BD_RELEASE(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_RECEIVER_BD_RELEASE ON DIM_RECEIVER_BD_RELEASE(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE4DIM_RECEIVER_BD_RELEASE ON DIM_RECEIVER_BD_RELEASE(YEARSEASON_CRITERIA_GROUP_ID);



--SCD1, Each row represent the CRITERIAs and date while doing receiver allocation
CREATE TABLE DIM_RECEIVER_ALLOCATE(
RECEIVER_ALLOCATE_ID           NUMBER(7)    NOT NULL,
SOURCE_BUSKEY                  VARCHAR2(30) NOT NULL,
RECEIVER_BD_RELEASE_ID         NUMBER(7)    NOT NULL,
RECEIVER_ALLOCATE_DATE         DATE         NOT NULL,
RECEIVER_ALLOCATE_NAME         VARCHAR2(30) NOT NULL,
PROD_CRITERIA_GROUP_ID         NUMBER(7)    NOT NULL,
LOC_CRITERIA_GROUP_ID          NUMBER(7)    NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID   NUMBER(7)    NOT NULL,
CONSTRAINT PKDIM_RECEIVER_ALLOCATE PRIMARY KEY(RECEIVER_ALLOCATE_ID)
);


ALTER TABLE DIM_RECEIVER_ALLOCATE ADD CONSTRAINT UN1DIM_RECEIVER_ALLOCATE UNIQUE(SOURCE_BUSKEY);

ALTER TABLE DIM_RECEIVER_ALLOCATE ADD CONSTRAINT FKDIM_RECEIVER_ALLOCATE_P
      FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID); 
      
ALTER TABLE DIM_RECEIVER_ALLOCATE ADD CONSTRAINT FKDIM_RECEIVER_ALLOCATE_L
      FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       

ALTER TABLE DIM_RECEIVER_ALLOCATE ADD CONSTRAINT FKDIM_RECEIVER_ALLOCATE_YS
      FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);       
                      
ALTER TABLE DIM_RECEIVER_ALLOCATE ADD CONSTRAINT FKDIM_RECEIVER_ALLOCATE_BD_R
FOREIGN KEY(RECEIVER_BD_RELEASE_ID) REFERENCES DIM_RECEIVER_BD_RELEASE(RECEIVER_BD_RELEASE_ID);


CREATE INDEX XIE1DIM_RECEIVER_ALLOCATE ON DIM_RECEIVER_ALLOCATE(RECEIVER_BD_RELEASE_ID);
CREATE INDEX XIE2DIM_RECEIVER_ALLOCATE ON DIM_RECEIVER_ALLOCATE(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_RECEIVER_ALLOCATE ON DIM_RECEIVER_ALLOCATE(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE4DIM_RECEIVER_ALLOCATE ON DIM_RECEIVER_ALLOCATE(YEARSEASON_CRITERIA_GROUP_ID);



CREATE TABLE DIM_RECEIVER_RELEASE(
RECEIVER_RELEASE_ID                    NUMBER(7)    NOT NULL,
SOURCE_BUSKEY                          VARCHAR2(30) NOT NULL,
RECEIVER_ALLOCATE_ID                   NUMBER(7)    NOT NULL,
RECEIVER_RELEASE_DATE                  DATE         NOT NULL,
RECEIVER_RELEASE_NAME                  VARCHAR2(30) NOT NULL,
PROD_CRITERIA_GROUP_ID                 NUMBER(7)    NOT NULL,
LOC_CRITERIA_GROUP_ID                  NUMBER(7)    NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID           NUMBER(7)    NOT NULL,
CONSTRAINT PKDIM_RECEIVER_RELEASE PRIMARY KEY(RECEIVER_RELEASE_ID)
);


ALTER TABLE DIM_RECEIVER_RELEASE ADD CONSTRAINT UN1DIM_RECEIVER_RELEASE UNIQUE(SOURCE_BUSKEY);

ALTER TABLE DIM_RECEIVER_RELEASE ADD CONSTRAINT FKDIM_RECEIVER_RELEASE_A 
      FOREIGN KEY(RECEIVER_ALLOCATE_ID) REFERENCES DIM_RECEIVER_ALLOCATE(RECEIVER_ALLOCATE_ID);
      
ALTER TABLE DIM_RECEIVER_RELEASE ADD CONSTRAINT FKDIM_RECEIVER_RELEASE_P
      FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);        

ALTER TABLE DIM_RECEIVER_RELEASE ADD CONSTRAINT FKDIM_RECEIVER_RELEASE_L
      FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);          

ALTER TABLE DIM_RECEIVER_RELEASE ADD CONSTRAINT FKDIM_RECEIVER_RELEASE_YS
      FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID); 
      
CREATE INDEX XIE1DIM_RECEIVER_RELEASE ON DIM_RECEIVER_RELEASE(RECEIVER_ALLOCATE_ID);
CREATE INDEX XIE2DIM_RECEIVER_RELEASE ON DIM_RECEIVER_RELEASE(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_RECEIVER_RELEASE ON DIM_RECEIVER_RELEASE(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE4DIM_RECEIVER_RELEASE ON DIM_RECEIVER_RELEASE(YEARSEASON_CRITERIA_GROUP_ID);



CREATE SEQUENCE SEQ_PO_BD
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_ASN_BD
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_RECEIVER_BD
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_PO_BD_RELEASE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_ASN_BD_RELEASE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_RECEIVER_BD_RELEASE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;


--*******************************************************************************************
--**********************************Error log  imensions*************************************
--*******************************************************************************************
CREATE TABLE DIM_UPLOAD_TRACKING(
UPLOAD_ID         NUMBER(9)    NOT NULL
  CONSTRAINT PKDIM_UPLOAD_TRACKING PRIMARY KEY,
UPLOAD_TYPE       VARCHAR2(30) NOT NULL,
AFFECTED_IDS      NNT_IDS,
SUCCEED_NUM       NUMBER(9)    NOT NULL,
FAILURE_NUM       NUMBER(9)    NOT NULL)
NESTED TABLE AFFECTED_IDS STORE AS DIM_UPLOAD_AFFECTED_IDS;

--DROP TABLE DIM_ERROR PURGE;
CREATE TABLE DIM_ERROR(
ERROR_ID          NUMBER(5)          NOT NULL
  CONSTRAINT PKDIM_ERROR PRIMARY KEY,
ERROR_CODE        NUMBER(5)          NOT NULL,
ERROR_CATEGORY    VARCHAR2(30)       NOT NULL,
SEVERITY          NUMBER(3)          NOT NULL
); 

ALTER TABLE DIM_ERROR ADD CONSTRAINT UN1DIM_ERROR UNIQUE(ERROR_CODE);

--DROP TABLE DIM_ERROR_MSG PURGE;
CREATE TABLE DIM_ERROR_MSG(
ERROR_ID          NUMBER(5)          NOT NULL,
LANGUAGE          VARCHAR2(10)       NOT NULL,
ERROR_MSG         VARCHAR2(255)      NOT NULL
);

ALTER TABLE DIM_ERROR_MSG ADD CONSTRAINT PKDIM_ERROR_MSG PRIMARY KEY(ERROR_ID,LANGUAGE);
ALTER TABLE DIM_ERROR_MSG ADD CONSTRAINT FKDIM_ERROR_MSG_ERR FOREIGN KEY(ERROR_ID) REFERENCES DIM_ERROR(ERROR_ID);
CREATE INDEX XIE1DIM_ERROR_MSG ON DIM_ERROR_MSG(ERROR_ID);


--*******************************************************************************************
--**********************************Transfer  imensions*************************************
--*******************************************************************************************
--audit dimension for data tracking
CREATE SEQUENCE SEQ_AUDIT
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

--THIS IS DW AUDIT DIMENSION FOR DATA AUDIT AND JOB TRACKING
--Regardless data is insert or modified, please assign a new audit
CREATE TABLE DIM_AUDIT(
AUDIT_ID              NUMBER(12)  NOT NULL
CONSTRAINT PKDIM_AUDIT PRIMARY KEY,
DW_SOURCE             VARCHAR2(30)NOT NULL,--FACT_POS_SALES/FACT_POS_INVENTORY/FACT_TRANSFER/FACT_TRANSFER_RELEASE
DW_UPDATE_USER        VARCHAR2(10)NOT NULL,
DW_UPDATE_DATE        DATE        NOT NULL,
DW_NUM_REC_LOADED     NUMBER(12)  NOT NULL,
DW_NUM_REC_REJECTED   NUMBER(12)  NOT NULL
);



--This is forecast demand dimension with no hierarch
--scd1

CREATE SEQUENCE SEQ_TRANSFER_FORECAST
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE TABLE DIM_TRANSFER_FORECAST(
TRANSFER_FORECAST_ID                 NUMBER(7)    NOT NULL
  CONSTRAINT PKDIM_TRANSFER_FORECAST PRIMARY KEY,
SOURCE_BUSKEY                        VARCHAR2(30) NOT NULL,
FORECAST_DATE                        DATE         NOT NULL,
FORECAST_DT                          NUMBER(8)    NOT NULL,
FORECAST_NAME                        VARCHAR2(30) NOT NULL,
PROD_CRITERIA_GROUP_ID              NUMBER(7)    NOT NULL,
LOC_CRITERIA_GROUP_ID               NUMBER(7)    NOT NULL
);

ALTER TABLE DIM_TRANSFER_FORECAST ADD CONSTRAINT UN1DIM_TRANSFER_FORECAST UNIQUE(SOURCE_BUSKEY);

ALTER TABLE DIM_TRANSFER_FORECAST ADD CONSTRAINT FKDIM_TRANSFER_FORECAST_P 
      FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

ALTER TABLE DIM_TRANSFER_FORECAST ADD CONSTRAINT FKDIM_TRANSFER_FORECAST_L
      FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

CREATE INDEX XIE1DIM_TRANSFER_FORECAST ON DIM_TRANSFER_FORECAST(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE2DIM_TRANSFER_FORECAST ON DIM_TRANSFER_FORECAST(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_TRANSFER_FORECAST ON DIM_TRANSFER_FORECAST(FORECAST_DT);


--This is tranfer diemnsion with a hierarch:transfer-->release
--scd1

CREATE SEQUENCE SEQ_TRANSFER_TRANSFER
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_TRANSFER_RELEASE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE TABLE DIM_TRANSFER_TRANSFER(
TRANSFER_TRANSFER_ID             NUMBER(7)       NOT NULL
  CONSTRAINT PKDIM_TRANSFER_TRANSFER PRIMARY KEY,
SOURCE_BUSKEY                    VARCHAR2(30)    NOT NULL,--TRANSFER#
TRANSFER_DATE                    DATE            NOT NULL,
TRANSFER_DT                      NUMBER(8)       NOT NULL,
TRANSFER_NAME                    VARCHAR2(30)    NOT NULL,--TRANSFER CRTIERIAL NAME
PROD_CRITERIA_GROUP_ID          NUMBER(7)       NOT NULL,
LOC_CRITERIA_GROUP_ID           NUMBER(7)       NOT NULL
);

ALTER TABLE DIM_TRANSFER_TRANSFER ADD CONSTRAINT UN1DIM_TRANSFER_TRANSFER UNIQUE(SOURCE_BUSKEY);

ALTER TABLE DIM_TRANSFER_TRANSFER ADD CONSTRAINT FKDIM_TRANSFER_TRANSFER_P
  FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

ALTER TABLE DIM_TRANSFER_TRANSFER ADD CONSTRAINT FKDIM_TRANSFER_TRANSFER_L
  FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

CREATE INDEX XIE1DIM_TRANSFER_TRANSFER ON DIM_TRANSFER_TRANSFER(PROD_CRITERIA_GROUP_ID);

CREATE INDEX XIE2DIM_TRANSFER_TRANSFER ON DIM_TRANSFER_TRANSFER(LOC_CRITERIA_GROUP_ID);

CREATE INDEX XIE3DIM_TRANSFER_TRANSFER ON DIM_TRANSFER_TRANSFER(TRANSFER_DT);



CREATE TABLE DIM_TRANSFER_RELEASE(
TRANSFER_RELEASE_ID               NUMBER(7)      NOT NULL
  CONSTRAINT PKDIM_TRANSFER_RELEASE PRIMARY KEY,
SOURCE_BUSKEY                     VARCHAR2(30)   NOT NULL,--RELEASE#
TRANSFER_TRANSFER_ID              NUMBER(7)      NOT NULL,
RELEASE_DATE                      DATE           NOT NULL,
RELEASE_DT                        NUMBER(8)      NOT NULL,
RELEASE_NAME                      VARCHAR2(30)   NOT NULL,
PROD_CRITERIA_GROUP_ID           NUMBER(7)      NOT NULL,
LOC_CRITERIA_GROUP_ID            NUMBER(7)      NOT NULL
);

ALTER TABLE DIM_TRANSFER_RELEASE ADD CONSTRAINT UN1DIM_TRANSFER_RELEASE UNIQUE(SOURCE_BUSKEY);


ALTER TABLE DIM_TRANSFER_RELEASE ADD CONSTRAINT FKDIM_TRANSFER_RELEASE_P
  FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

ALTER TABLE DIM_TRANSFER_RELEASE ADD CONSTRAINT FKDIM_TRANSFER_RELEASE_T
  FOREIGN KEY(TRANSFER_TRANSFER_ID) REFERENCES DIM_TRANSFER_TRANSFER(TRANSFER_TRANSFER_ID);

ALTER TABLE DIM_TRANSFER_RELEASE ADD CONSTRAINT FKDIM_TRANSFER_RELEASE_L
  FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

CREATE INDEX XIE1DIM_TRANSFER_RELEASE ON DIM_TRANSFER_RELEASE(PROD_CRITERIA_GROUP_ID);

CREATE INDEX XIE2DIM_TRANSFER_RELEASE ON DIM_TRANSFER_RELEASE(LOC_CRITERIA_GROUP_ID);

CREATE INDEX XIE3DIM_TRANSFER_RELEASE ON DIM_TRANSFER_RELEASE(TRANSFER_TRANSFER_ID);

CREATE INDEX XIE4DIM_TRANSFER_RELEASE ON DIM_TRANSFER_RELEASE(RELEASE_DT);

--This is transfer rule dimensions with no hierarch
--scd2
--DIM_RULE
CREATE TABLE DIM_RULE(
RULE_ID                   NUMBER(7)   NOT NULL
CONSTRAINT PKDIM_RULE PRIMARY KEY,
SOURCE_BUSKEY                VARCHAR2(10)NOT NULL,
PARENT_SOURCE_BUSKEY         VARCHAR2(10)NOT NULL,--MAIN RULE ID IF THIS IS A SUBRULE
NAME                         VARCHAR2(30)NOT NULL,
RULE_TYPE                    VARCHAR2(10)NOT NULL,
START_DATE                   DATE        NOT NULL,
END_DATE                     DATE        NOT NULL,
WEEKS_NOT_ALLOWED_OUT        NUMBER(3)   NOT NULL,
WEEKS_TO_BE_MAINTAINED       NUMBER(2)   NOT NULL,
WEEKS_OF_PREV_SALES          NUMBER(3)   NOT NULL,
WEEKS_PRIOR_CURR_DATE        NUMBER(2)   NOT NULL,
SUPPLY_PERCENT               NUMBER(3)   NOT NULL,
WEEKS_NOT_SOLD               NUMBER(2)   NOT NULL,
IS_CHECK_RECEIPT_CUMULATIVE  NUMBER(1)   NOT NULL,
WEEKS_AFTER_FIRST_RECEIPT    NUMBER(2)   NOT NULL,
CUMULATIVE_PERCENT           NUMBER(3)   NOT NULL,
PROD_CRITERIA_GROUP_ID       NUMBER(7)   NOT NULL,
LOC_CRITERIA_GROUP_ID        NUMBER(7)   NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID NUMBER(7)   NOT NULL,
DW_START_DATE                DATE        NOT NULL,
DW_END_DATE                  DATE        NOT NULL,
DW_VERSION                   NUMBER(3)   NOT NULL,
DW_CURRFLAG                  CHAR        NOT NULL,
CONSTRAINT UN1DIM_RULE UNIQUE(SOURCE_BUSKEY,DW_START_DATE)
);


ALTER TABLE DIM_RULE ADD CONSTRAINT FKDIM_SUBRULE_PC
FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP (CRITERIA_GROUP_ID);

ALTER TABLE DIM_RULE ADD CONSTRAINT FKDIM_SUBRULE_LC
FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP (CRITERIA_GROUP_ID);

ALTER TABLE DIM_RULE ADD CONSTRAINT FKDIM_SUBRULE_YSC
FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP (CRITERIA_GROUP_ID);

CREATE INDEX XIE1DIM_SUBRULE ON DIM_RULE(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE2DIM_SUBRULE ON DIM_RULE(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_SUBRULE ON DIM_RULE(YEARSEASON_CRITERIA_GROUP_ID);


CREATE TABLE DIM_RULE_DISABLED(
RULE_ID                      NUMBER(7)   NOT NULL,
IN_OUT_TYPE                  NUMBER(1)   NOT NULL,
STORE_ID                     NUMBER(7)   NOT NULL,
CONSTRAINT PKDIM_RULE_DISABLED PRIMARY KEY(RULE_ID,IN_OUT_TYPE,STORE_ID)
) ORGANIZATION INDEX;

CREATE INDEX XIE1DIM_RULE_DISABLED ON DIM_RULE_DISABLED(RULE_ID);
CREATE INDEX XIE2DIM_RULE_DISABLED ON DIM_RULE_DISABLED(STORE_ID);

ALTER TABLE DIM_RULE_DISABLED ADD CONSTRAINT FKDIM_RULE_DISABLED_R
FOREIGN KEY(RULE_ID) REFERENCES DIM_RULE(RULE_ID);

ALTER TABLE DIM_RULE_DISABLED ADD CONSTRAINT FKDIM_RULE_DISABLED_S
FOREIGN KEY(STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID);


CREATE SEQUENCE SEQ_RULE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;


--DIM_TRANSFER_PRIORITY
--SCD2
CREATE SEQUENCE SEQ_TRANSFER_PRIORITY
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE TABLE DIM_TRANSFER_PRIORITY(
TRANSFER_PRIORITY_ID          NUMBER(7)   NOT NULL
CONSTRAINT PKDIM_TRANSFER_PRIORITY PRIMARY KEY,
SOURCE_BUSKEY                VARCHAR2(10)NOT NULL,--TRANSFER_PRIORITY_ID||'-'||DOOR_NUMBER, IF NO DOOR THEN '0'
NAME                         VARCHAR2(30)NOT NULL,
PRIORITY1                    VARCHAR2(30),
PRIORITY2                    VARCHAR2(30),
PRIORITY3                    VARCHAR2(30),
PRIORITY4                    VARCHAR2(30),
PRIORITY5                    VARCHAR2(30),
PROD_CRITERIA_GROUP_ID       NUMBER(7)   NOT NULL,
LOC_CRITERIA_GROUP_ID        NUMBER(7)   NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID NUMBER(7)   NOT NULL,
PRIORITY_TYPE                VARCHAR2(10)NOT NULL,--DEFAULT/MAIN/DOOR_EXCEPTION
DW_START_DATE                DATE        NOT NULL,
DW_END_DATE                  DATE        NOT NULL,
DW_VERSION                   NUMBER(3)   NOT NULL,
DW_CURRFLAG                  CHAR        NOT NULL,
CONSTRAINT UN1DIM_TRANSFER_PRIORITY UNIQUE(SOURCE_BUSKEY,DW_START_DATE)
);


ALTER TABLE DIM_TRANSFER_PRIORITY ADD CONSTRAINT FKDIM_TRANSFER_PRIORITY_P
FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

ALTER TABLE DIM_TRANSFER_PRIORITY ADD CONSTRAINT FKDIM_TRANSFER_PRIORITY_L
FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

ALTER TABLE DIM_TRANSFER_PRIORITY ADD CONSTRAINT FKDIM_TRANSFER_PRIORITY_YS
FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

CREATE INDEX XIE1DIM_TRANSFER_PRIORITY ON DIM_TRANSFER_PRIORITY(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE2DIM_TRANSFER_PRIORITY ON DIM_TRANSFER_PRIORITY(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_TRANSFER_PRIORITY ON DIM_TRANSFER_PRIORITY(YEARSEASON_CRITERIA_GROUP_ID);




--**************************************************************************************
--**************************************************************************************
--*******************************FACT***************************************************
--**************************************************************************************
--**************************************************************************************

--**************************************************************************************
--*****************************FACT_POS_SALES*******************************************
--**************************************************************************************
--This is a transactional fact, the grain is per day+per company door+per style color size+per promotion
--DROP TABLE FACT_POS_SALES PURGE;
CREATE TABLE FACT_POS_SALES
(
DATE_ID                    NUMBER(8)      NOT NULL,
STYLE_COLOR_SIZE_ID        NUMBER(7)      NOT NULL,
STYLE_YEAR_SEASON_ID       NUMBER(7)      NOT NULL,
STORE_ID                   NUMBER(7)      NOT NULL,
SALES_STYLE_ID             NUMBER(5)      NOT NULL,
SALES_UNIT                 NUMBER(11)     NOT NULL,
SALES_RETAIL               NUMBER(15,2)   NOT NULL,
SALES_COST                 NUMBER(15,2)   NOT NULL,
PROMO_RETAIL               NUMBER(15,2)   NOT NULL,
PROMO_PERCENT              NUMBER(11,4)   NOT NULL,
PROFIT_DOLLAR              NUMBER(15,2)   NOT NULL,
OWNED_COST                 NUMBER(9,2)    NOT NULL,
MSRP                       NUMBER(15,2)   NOT NULL,
OWNED_RETAIL               NUMBER(9,2)    NOT NULL,
DEMAND_SALES_UNIT          NUMBER(11)     NOT NULL,
DEMAND_SALES_COST          NUMBER(15,2)   NOT NULL,
DEMAND_SALES_RETAIL        NUMBER(15,2)   NOT NULL,
RETURN_UNIT                NUMBER(11)     NOT NULL,
RETURN_COST                NUMBER(15,2)   NOT NULL,
RETURN_RETAIL              NUMBER(15,2)   NOT NULL,
BACK_ORDER_UNIT            NUMBER(11)     NOT NULL,
BACK_ORDER_COST            NUMBER(15,2)   NOT NULL,
BACK_ORDER_RETAIL          NUMBER(15,2)   NOT NULL
) PARTITION BY RANGE(DATE_ID)
  INTERVAL(1)
  SUBPARTITION BY HASH(STYLE_COLOR_SIZE_ID) SUBPARTITIONS 4
  (PARTITION P0 VALUES LESS THAN (20130101)
      )
COMPRESS FOR OLTP
PARALLEL;

ALTER TABLE FACT_POS_SALES ADD CONSTRAINT FKFACT_POS_SALES_DATE FOREIGN KEY(DATE_ID) REFERENCES DIM_DATE_DAY(DATE_ID);
ALTER TABLE FACT_POS_SALES ADD CONSTRAINT FKFACT_POS_SALES_SCS FOREIGN KEY(STYLE_COLOR_SIZE_ID) REFERENCES DIM_STYLE_COLOR_SIZE(STYLE_COLOR_SIZE_ID) ;
ALTER TABLE FACT_POS_SALES ADD CONSTRAINT FKFACT_POS_SALES_YS FOREIGN KEY(STYLE_YEAR_SEASON_ID) REFERENCES DIM_STYLE_YEAR_SEASON(STYLE_YEAR_SEASON_ID) ;
ALTER TABLE FACT_POS_SALES ADD CONSTRAINT FKFACT_POS_SALES_STORE FOREIGN KEY(STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID) ;
ALTER TABLE FACT_POS_SALES ADD CONSTRAINT FKFACT_POS_SALES_SS FOREIGN KEY(SALES_STYLE_ID) REFERENCES DIM_SALES_STYLE(SALES_STYLE_ID) ;


CREATE BITMAP INDEX BX1FACT_POS_SALES ON FACT_POS_SALES(DATE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_POS_SALES ON FACT_POS_SALES(STYLE_COLOR_SIZE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_POS_SALES ON FACT_POS_SALES(STORE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX4FACT_POS_SALES ON FACT_POS_SALES(SALES_STYLE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX5FACT_POS_SALES ON FACT_POS_SALES(STYLE_YEAR_SEASON_ID) LOCAL PARALLEL;

--**************************************************************************************
--*****************************FACT_POS_INVENTORY*******************************************
--**************************************************************************************
--This is a transactional fact, the grain is per day+per company door+per style color size
--Sourced from POS_INVENTORY. Nearly 7 billion.

CREATE TABLE FACT_POS_INVENTORY
(
  DATE_ID                       NUMBER(8)    NOT NULL,
  STYLE_COLOR_SIZE_ID           NUMBER(7)    NOT NULL,
  STYLE_YEAR_SEASON_ID          NUMBER(7)    NOT NULL,
  STORE_ID                      NUMBER(7)    NOT NULL,
  BEGIN_INVENTORY_UNIT          NUMBER(11)   NOT NULL,
  BEGIN_INVENTORY_RETAIL        NUMBER(15,2) NOT NULL,
  BEGIN_INVENTORY_COST          NUMBER(15,2) NOT NULL,
  RECEIPT_UNIT                  NUMBER(11)   NOT NULL,
  RECEIPT_RETAIL                NUMBER(15,2) NOT NULL,
  RECEIPT_COST                  NUMBER(15,2) NOT NULL,
  END_INVENTORY_UNIT            NUMBER(11)   NOT NULL,
  END_INVENTORY_RETAIL          NUMBER(15,2) NOT NULL,
  END_INVENTORY_COST            NUMBER(15,2) NOT NULL,
  TRANSFER_IN_UNIT              NUMBER(11)   NOT NULL,
  TRANSFER_IN_RETAIL            NUMBER(15,2) NOT NULL,
  TRANSFER_IN_COST              NUMBER(15,2) NOT NULL,
  TRANSFER_OUT_UNIT             NUMBER(11)   NOT NULL,
  TRANSFER_OUT_RETAIL           NUMBER(15,2) NOT NULL,
  TRANSFER_OUT_COST             NUMBER(15,2) NOT NULL,
  ADJUSTMENT_UNIT               NUMBER(11)   NOT NULL,
  ADJUSTMENT_RETAIL             NUMBER(15,2) NOT NULL,
  ADJUSTMENT_COST               NUMBER(15,2) NOT NULL,
  OWNED_COST                    NUMBER(9,2) NOT NULL,
  MSRP                          NUMBER(15,2)NOT NULL,
  OWNED_RETAIL                  NUMBER(9,2) NOT NULL,
  MKD_RETAIL                    NUMBER(11)  NOT NULL,
  MKD_PERCENT                   NUMBER(11,4)NOT NULL  
)PARTITION BY RANGE(DATE_ID)
  INTERVAL(1)
  SUBPARTITION BY HASH(STYLE_COLOR_SIZE_ID) SUBPARTITIONS 8
  (PARTITION P0 VALUES LESS THAN (20130101)
      )
COMPRESS FOR OLTP
PARALLEL;



ALTER TABLE FACT_POS_INVENTORY ADD CONSTRAINT FKFACT_POS_INVENTORY_DATE FOREIGN KEY(DATE_ID) REFERENCES DIM_DATE_DAY(DATE_ID);
ALTER TABLE FACT_POS_INVENTORY ADD CONSTRAINT FKFACT_POS_INVENTORY_SCS FOREIGN KEY(STYLE_COLOR_SIZE_ID) REFERENCES DIM_STYLE_COLOR_SIZE(STYLE_COLOR_SIZE_ID);
ALTER TABLE FACT_POS_INVENTORY ADD CONSTRAINT FKFACT_POS_INVENTORY_YS FOREIGN KEY(STYLE_YEAR_SEASON_ID) REFERENCES DIM_STYLE_YEAR_SEASON(STYLE_YEAR_SEASON_ID);
ALTER TABLE FACT_POS_INVENTORY ADD CONSTRAINT FKFACT_POS_INVENTORY_STORE FOREIGN KEY(STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID);


CREATE BITMAP INDEX BX1FACT_POS_INVENTORY ON FACT_POS_INVENTORY(DATE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_POS_INVENTORY ON FACT_POS_INVENTORY(STYLE_COLOR_SIZE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_POS_INVENTORY ON FACT_POS_INVENTORY(STORE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX4FACT_POS_INVENTORY ON FACT_POS_INVENTORY(STYLE_YEAR_SEASON_ID) LOCAL PARALLEL;

--**************************************************************************************
--*****************************FACT_LOC_INV*************************************
--**************************************************************************************
--This is a transactional fact, the grain is per day+per style color size +per style year_season+per loc(dc/stockcagegory). 
--Sourced from CMM_DC_Inventory. 
CREATE TABLE FACT_LOC_INV(
DATE_ID                            NUMBER(8)   NOT NULL,
STYLE_COLOR_SIZE_ID                NUMBER(7)   NOT NULL,
STYLE_YEAR_SEASON_ID               NUMBER(7)   NOT NULL,
STORE_LOC_ID                       NUMBER(7)   NOT NULL,
COST                               NUMBER(9,2) NOT NULL,
RETAIL                             NUMBER(9,2) NOT NULL,
DC_RECEIPT_UNIT         	         NUMBER(11)  NOT NULL,
DC_RECEIPT_RETAIL                  NUMBER(15,2)NOT NULL,
DC_RECEIPT_COST                    NUMBER(15,2)NOT NULL,
DC_BOW_UNIT                        NUMBER(11)  NOT NULL,
DC_BOW_RETAIL                      NUMBER(15,2)NOT NULL,
DC_BOW_COST                        NUMBER(15,2)NOT NULL,
DC_EOW_UNIT                        NUMBER(11)  NOT NULL,
DC_EOW_RETAIL                      NUMBER(15,2)NOT NULL,
DC_EOW_COST                        NUMBER(15,2)NOT NULL,
DC_TRANSFER_IN_UNIT                NUMBER(11)  NOT NULL,
DC_TRANSFER_IN_RETAIL              NUMBER(15,2)NOT NULL,
DC_TRANSFER_IN_COST                NUMBER(15,2)NOT NULL,
DC_TRANSFER_OUT_UNIT               NUMBER(11)  NOT NULL,
DC_TRANSFER_OUT_RETAIL             NUMBER(15,2)NOT NULL,
DC_TRANSFER_OUT_COST               NUMBER(15,2)NOT NULL,
DC_ADJUSTMENT_UNIT                 NUMBER(11)  NOT NULL,
DC_ADJUSTMENT_RETAIL               NUMBER(15,2)NOT NULL,
DC_ADJUSTMENT_COST                 NUMBER(15,2)NOT NULL,
DC_MARKDOWN_PERM_RETAIL            NUMBER(15,2)NOT NULL,
DC_RESERVE_UNIT                    NUMBER(11)  NOT NULL,
DC_RESERVE_RETAIL                  NUMBER(15,2)NOT NULL,
DC_RESERVE_COST                    NUMBER(15,2)NOT NULL
) PARTITION BY RANGE(DATE_ID)
  INTERVAL(1)
  SUBPARTITION BY HASH(STYLE_COLOR_SIZE_ID) SUBPARTITIONS 4
  (PARTITION P0 VALUES LESS THAN (20130101)
      )
COMPRESS FOR OLTP
PARALLEL;


ALTER TABLE FACT_LOC_INV ADD CONSTRAINT FKFACT_LOC_INV_DATE FOREIGN KEY(DATE_ID) REFERENCES DIM_DATE_DAY(DATE_ID);
ALTER TABLE FACT_LOC_INV ADD CONSTRAINT FKFACT_LOC_INV_STYLE FOREIGN KEY(STYLE_COLOR_SIZE_ID) REFERENCES DIM_STYLE_COLOR_SIZE(STYLE_COLOR_SIZE_ID);
ALTER TABLE FACT_LOC_INV ADD CONSTRAINT FKFACT_LOC_INV_SEASON FOREIGN KEY(STYLE_YEAR_SEASON_ID) REFERENCES DIM_STYLE_YEAR_SEASON(STYLE_YEAR_SEASON_ID);
ALTER TABLE FACT_LOC_INV ADD CONSTRAINT FKFACT_LOC_INV_LOC FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

CREATE BITMAP INDEX BX1FACT_LOC_INV ON FACT_LOC_INV(DATE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_LOC_INV ON FACT_LOC_INV(STYLE_COLOR_SIZE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_LOC_INV ON FACT_LOC_INV(STORE_LOC_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX4FACT_LOC_INV ON FACT_LOC_INV(STYLE_YEAR_SEASON_ID) LOCAL PARALLEL;


CREATE SEQUENCE SEQ_TRANS_LOC_INV
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

--**************************************************************************************
--*****************************FACT_PO*****************************************
--**************************************************************************************
--This is a transactional fact, the grain is per PO + per STYLE_COLOR_SIZE_GoldPackage++per year_season +per LOC(COUNTRY/DC/STOCKCATEGORY). 
--Sourced from PO. 
--DROP TABLE FACT_PO PURGE;
--changed as below INCLUDING ALL NATIVE UPLOAD DATA AND ANY BREAKDOWN DATA
CREATE TABLE FACT_PO
(
  TRANS_BUSKEY           VARCHAR2(30) NOT NULL   --UNIQUE
  CONSTRAINT PKFACT_PO PRIMARY KEY,
  PO_NUMBER              VARCHAR2(30) NOT NULL,
  STYLE_COLOR_SIZE_GP_ID NUMBER(7)    NOT NULL,
  YEAR_SEASON_ID         NUMBER(7)    NOT NULL,
  STORE_LOC_ID           NUMBER(7)    NOT NULL,
  STATUS_ID              NUMBER(7)    NOT NULL,      --NATIVE UPLOAD/BREAKDOWN/INVALID
  SOURCE_TRANS_BUSKEY    VARCHAR2(30) NOT NULL,   --the Trans_buskey of any breakdowned record for tracking
  START_DT               NUMBER(8)    NOT NULL,
  CANCEL_DT              NUMBER(8)    NOT NULL,
  IN_DC_DT             NUMBER(8)    NOT NULL,
  COST                   NUMBER(9,2)  NOT NULL,
  RETAIL                 NUMBER(9,2)  NOT NULL,
  TOTAL_QTY              NUMBER(11)   NOT NULL,
  TOTAL_RETAIL           NUMBER(15,2) NOT NULL,
  TOTAL_COST             NUMBER(15,2) NOT NULL
);

ALTER TABLE FACT_PO ADD CONSTRAINT UN1FACT_PO UNIQUE(STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_LOC_ID,STATUS_ID,PO_NUMBER);

ALTER TABLE FACT_PO ADD CONSTRAINT FKFACT_PO_S 
FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);

ALTER TABLE FACT_PO ADD CONSTRAINT FKFACT_PO_Y 
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_PO ADD CONSTRAINT FKFACT_PO_L 
FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_PO ADD CONSTRAINT FKFACT_PO_ST
FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

CREATE INDEX XIE1FACT_PO ON FACT_PO(PO_NUMBER);
CREATE INDEX XIE2FACT_PO ON FACT_PO(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_PO ON FACT_PO(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_PO ON FACT_PO(STORE_LOC_ID);
CREATE INDEX XIE5FACT_PO ON FACT_PO(STATUS_ID);



--**************************************************************************************
--*****************************FACT_ASN*************************************************
--**************************************************************************************
--This is a transactional fact, the grain is per ASN + per Style_Color_Size_GoldPackage+per year_Season+per Country. 
--Sourced from ASN. 
--DROP TABLE FACT_ASN PURGE;
CREATE TABLE FACT_ASN
(
  TRANS_BUSKEY           VARCHAR2(30) NOT NULL   --UNIQUE
  CONSTRAINT PKFACT_ASN PRIMARY KEY,
  ASN_NUMBER             VARCHAR2(30) NOT NULL,
  STYLE_COLOR_SIZE_GP_ID NUMBER(7)    NOT NULL,
  YEAR_SEASON_ID         NUMBER(7)    NOT NULL,
  STORE_LOC_ID           NUMBER(7)    NOT NULL,
  STATUS_ID              NUMBER(7)    NOT NULL,      --NATIVE UPLOAD/BREAKDOWN/INVALID
  SOURCE_TRANS_BUSKEY    VARCHAR2(30) NOT NULL,   
  START_DT               NUMBER(8)    NOT NULL,
  CANCEL_DT              NUMBER(8)    NOT NULL,
  IN_DC_DT             NUMBER(8)    NOT NULL,
  COST                   NUMBER(9,2)  NOT NULL,
  RETAIL                 NUMBER(9,2)  NOT NULL,
  TOTAL_QTY              NUMBER(11)   NOT NULL,
  TOTAL_RETAIL           NUMBER(15,2) NOT NULL,
  TOTAL_COST             NUMBER(15,2) NOT NULL
);


ALTER TABLE FACT_ASN ADD CONSTRAINT UN1FACT_ASN UNIQUE(STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_LOC_ID,STATUS_ID,ASN_NUMBER);

ALTER TABLE FACT_ASN ADD CONSTRAINT FKFACT_ASN_S
FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);

ALTER TABLE FACT_ASN ADD CONSTRAINT FKFACT_ASN_Y
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_ASN ADD CONSTRAINT FKFACT_ASN_L
FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_ASN ADD CONSTRAINT FKFACT_ASN_ST
FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

CREATE INDEX XIE1FACT_ASN ON FACT_ASN(ASN_NUMBER);
CREATE INDEX XIE2FACT_ASN ON FACT_ASN(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_ASN ON FACT_ASN(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_ASN ON FACT_ASN(STORE_LOC_ID);
CREATE INDEX XIE5FACT_ASN ON FACT_ASN(STATUS_ID);

--**************************************************************************************
--*****************************FACT_RECEIVER*****************************************
--**************************************************************************************
--This is a transactional fact, the grain is per RECEIVER + per Style_Color_Size_GoldPackage+per LOC+per year_Season. 
--Sourced from  RECEIVER. 
--DROP TABLE FACT_RECEIVER PURGE;
--changed as below INCLUDING ALL NATIVE UPLOAD DATA AND ANY BREAKDOWN DATA
CREATE TABLE FACT_RECEIVER
(
  TRANS_BUSKEY           VARCHAR2(30) NOT NULL   --UNIQUE
  CONSTRAINT PKFACT_RECEIVER PRIMARY KEY,
  RECEIVER_NUMBER        VARCHAR2(30) NOT NULL,
  STYLE_COLOR_SIZE_GP_ID NUMBER(7)    NOT NULL,
  YEAR_SEASON_ID         NUMBER(7)    NOT NULL,
  STORE_LOC_ID           NUMBER(7)    NOT NULL,
  STATUS_ID              NUMBER(7)    NOT NULL,      --NATIVE UPLOAD/BREAKDOWN/INVALID
  SOURCE_TRANS_BUSKEY    VARCHAR2(30) NOT NULL,   
  START_DT               NUMBER(8)    NOT NULL,
  CANCEL_DT                 NUMBER(8)    NOT NULL,
  IN_DC_DT             NUMBER(8)    NOT NULL,
  COST                   NUMBER(9,2)  NOT NULL,
  RETAIL                 NUMBER(9,2)  NOT NULL,
  TOTAL_QTY              NUMBER(11)   NOT NULL,
  TOTAL_RETAIL           NUMBER(15,2) NOT NULL,
  TOTAL_COST             NUMBER(15,2) NOT NULL
);

ALTER TABLE FACT_RECEIVER ADD CONSTRAINT UN1FACT_RECEIVER UNIQUE(STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_LOC_ID,STATUS_ID,RECEIVER_NUMBER);


ALTER TABLE FACT_RECEIVER ADD CONSTRAINT FKFACT_RECEIVER_S
FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);

ALTER TABLE FACT_RECEIVER ADD CONSTRAINT FKFACT_RECEIVER_Y
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_RECEIVER ADD CONSTRAINT FKFACT_RECEIVER_L
FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_RECEIVER ADD CONSTRAINT FKFACT_RECEIVER_ST
FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);


CREATE INDEX XIE1FACT_RECEIVER ON FACT_RECEIVER(RECEIVER_NUMBER);
CREATE INDEX XIE2FACT_RECEIVER ON FACT_RECEIVER(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_RECEIVER ON FACT_RECEIVER(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_RECEIVER ON FACT_RECEIVER(STORE_LOC_ID);
CREATE INDEX XIE5FACT_RECEIVER ON FACT_RECEIVER(STATUS_ID);

--**************************************************************************************
--*****************************FACT_ONORDER*****************************************
--**************************************************************************************
--This is a transactional fact, the grain is per ON ORDER + per Style_Color_Size_GoldPackage+per LOC+per year_Season. 
--Sourced from CMM_ON_ORDER. 
--DROP TABLE FACT_ONORDER PURGE;
CREATE TABLE FACT_ONORDER(
PO_NUMBER                          VARCHAR2(30)  NOT NULL,
STYLE_COLOR_SIZE_ID                NUMBER(7)     NOT NULL,
YEAR_SEASON_ID                     NUMBER(7)     NOT NULL,
STORE_LOC_ID                       NUMBER(7)     NOT NULL,
DATE_ID                            NUMBER(8)     NOT NULL,
START_DT                           NUMBER(8)     NOT NULL,
CANCEL_DT                          NUMBER(8)     NOT NULL,
COST                               NUMBER(9,2)   NOT NULL,
RETAIL                             NUMBER(9,2)   NOT NULL,
TOTAL_QTY                          NUMBER(11)    NOT NULL,
TOTAL_RETAIL                       NUMBER(15,2)  NOT NULL,
TOTAL_COST                         NUMBER(15,2)  NOT NULL
)
PARTITION BY RANGE(DATE_ID)
  INTERVAL(1)
  SUBPARTITION BY HASH(STYLE_COLOR_SIZE_ID) SUBPARTITIONS 4
  (PARTITION P0 VALUES LESS THAN (20130101)
      )
COMPRESS FOR OLTP
PARALLEL;


ALTER TABLE FACT_ONORDER ADD CONSTRAINT FKFACT_ONORDER_STYLE FOREIGN KEY(STYLE_COLOR_SIZE_ID) REFERENCES DIM_STYLE_COLOR_SIZE(STYLE_COLOR_SIZE_ID) ;
ALTER TABLE FACT_ONORDER ADD CONSTRAINT FKFACT_ONORDER_YS FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID) ;
ALTER TABLE FACT_ONORDER ADD CONSTRAINT FKFACT_ONORDER_LOC FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID) ;
ALTER TABLE FACT_ONORDER ADD CONSTRAINT FKFACT_ONORDER_DATE FOREIGN KEY(DATE_ID) REFERENCES DIM_DATE_DAY(DATE_ID) ;
ALTER TABLE FACT_ONORDER ADD CONSTRAINT FKFACT_ONORDER_SDT FOREIGN KEY(START_DT) REFERENCES DIM_DATE_DAY(DATE_ID) ;
ALTER TABLE FACT_ONORDER ADD CONSTRAINT FKFACT_ONORDER_CDT FOREIGN KEY(CANCEL_DT) REFERENCES DIM_DATE_DAY(DATE_ID) ;


CREATE BITMAP INDEX BX1FACT_ONORDER ON FACT_ONORDER(PO_NUMBER) LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_ONORDER ON FACT_ONORDER(STYLE_COLOR_SIZE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_ONORDER ON FACT_ONORDER(STORE_LOC_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX4FACT_ONORDER ON FACT_ONORDER(DATE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX5FACT_ONORDER ON FACT_ONORDER(START_DT) LOCAL PARALLEL;
CREATE BITMAP INDEX BX6FACT_ONORDER ON FACT_ONORDER(CANCEL_DT) LOCAL PARALLEL;
CREATE BITMAP INDEX BX7FACT_ONORDER ON FACT_ONORDER(YEAR_SEASON_ID) LOCAL PARALLEL;



--changed as below INCLUDING ALL BREAKDOWNED PO AND ADJUSTED BREAKDOWNED PO
CREATE TABLE FACT_PO_BD
(
  TRANS_BUSKEY           VARCHAR2(30) NOT NULL   --UNIQUE
  CONSTRAINT PKFACT_PO_BD PRIMARY KEY,
  PO_BD_ID               NUMBER(7)    NOT NULL,
  STYLE_COLOR_SIZE_GP_ID NUMBER(7)    NOT NULL,
  YEAR_SEASON_ID         NUMBER(7)    NOT NULL,
  STORE_LOC_ID           NUMBER(7)    NOT NULL,
  STATUS_ID              NUMBER(7)    NOT NULL,      --SUGGESTED/ADJUST
  SOURCE_TRANS_BUSKEY    VARCHAR2(30) NOT NULL,   --the Trans_buskey of any breakdowned record for tracking
  TOTAL_QTY              NUMBER(11)   NOT NULL
);

ALTER TABLE FACT_PO_BD ADD CONSTRAINT UN1FACT_PO_BD UNIQUE(STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_LOC_ID,STATUS_ID,PO_BD_ID);

ALTER TABLE FACT_PO_BD ADD CONSTRAINT FKFACT_PO_BD_S 
FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);

ALTER TABLE FACT_PO_BD ADD CONSTRAINT FKFACT_PO_BD_Y 
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_PO_BD ADD CONSTRAINT FKFACT_PO_BD_L 
FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_PO_BD ADD CONSTRAINT FKFACT_PO_BD_ST
FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

CREATE INDEX XIE1FACT_PO_BD ON FACT_PO_BD(PO_BD_ID);
CREATE INDEX XIE2FACT_PO_BD ON FACT_PO_BD(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_PO_BD ON FACT_PO_BD(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_PO_BD ON FACT_PO_BD(STORE_LOC_ID);
CREATE INDEX XIE5FACT_PO_BD ON FACT_PO_BD(STATUS_ID);


--changed as below INCLUDING ALL BREAKDOWNED ASN AND ADJUSTED BREAKDOWNED ASN
CREATE TABLE FACT_ASN_BD
(
  TRANS_BUSKEY           VARCHAR2(30) NOT NULL   --UNIQUE
  CONSTRAINT PKFACT_ASN_BD PRIMARY KEY,
  ASN_BD_ID               NUMBER(7)    NOT NULL,
  STYLE_COLOR_SIZE_GP_ID NUMBER(7)    NOT NULL,
  YEAR_SEASON_ID         NUMBER(7)    NOT NULL,
  STORE_LOC_ID           NUMBER(7)    NOT NULL,
  STATUS_ID              NUMBER(7)    NOT NULL,      --SUGGESTED/ADJUST
  SOURCE_TRANS_BUSKEY    VARCHAR2(30) NOT NULL,   --the Trans_buskey of any breakdowned record for tracking
  TOTAL_QTY              NUMBER(11)   NOT NULL
);

ALTER TABLE FACT_ASN_BD ADD CONSTRAINT UN1FACT_ASN_BD UNIQUE(STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_LOC_ID,STATUS_ID,ASN_BD_ID);

ALTER TABLE FACT_ASN_BD ADD CONSTRAINT FKFACT_ASN_BD_S 
FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);

ALTER TABLE FACT_ASN_BD ADD CONSTRAINT FKFACT_ASN_BD_Y 
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_ASN_BD ADD CONSTRAINT FKFACT_ASN_BD_L 
FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_ASN_BD ADD CONSTRAINT FKFACT_ASN_BD_ST
FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

CREATE INDEX XIE1FACT_ASN_BD ON FACT_ASN_BD(ASN_BD_ID);
CREATE INDEX XIE2FACT_ASN_BD ON FACT_ASN_BD(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_ASN_BD ON FACT_ASN_BD(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_ASN_BD ON FACT_ASN_BD(STORE_LOC_ID);
CREATE INDEX XIE5FACT_ASN_BD ON FACT_ASN_BD(STATUS_ID);

--changed as below INCLUDING ALL BREAKDOWNED RECEIVER AND ADJUSTED BREAKDOWNED RECEIVER
CREATE TABLE FACT_RECEIVER_BD
(
  TRANS_BUSKEY           VARCHAR2(30) NOT NULL   --UNIQUE
  CONSTRAINT PKFACT_RECEIVER_BD PRIMARY KEY,
  RECEIVER_BD_ID               NUMBER(7)    NOT NULL,
  STYLE_COLOR_SIZE_GP_ID NUMBER(7)    NOT NULL,
  YEAR_SEASON_ID         NUMBER(7)    NOT NULL,
  STORE_LOC_ID           NUMBER(7)    NOT NULL,
  STATUS_ID              NUMBER(7)    NOT NULL,      --SUGGESTED/ADJUST
  SOURCE_TRANS_BUSKEY    VARCHAR2(30) NOT NULL,   --the Trans_buskey of any breakdowned record for tracking
  TOTAL_QTY              NUMBER(11)   NOT NULL
);

ALTER TABLE FACT_RECEIVER_BD ADD CONSTRAINT UN1FACT_RECEIVER_BD UNIQUE(STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_LOC_ID,STATUS_ID,RECEIVER_BD_ID);

ALTER TABLE FACT_RECEIVER_BD ADD CONSTRAINT FKFACT_RECEIVER_BD_S 
FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);

ALTER TABLE FACT_RECEIVER_BD ADD CONSTRAINT FKFACT_RECEIVER_BD_Y 
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_RECEIVER_BD ADD CONSTRAINT FKFACT_RECEIVER_BD_L 
FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_RECEIVER_BD ADD CONSTRAINT FKFACT_RECEIVER_BD_ST
FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

CREATE INDEX XIE1FACT_RECEIVER_BD ON FACT_RECEIVER_BD(RECEIVER_BD_ID);
CREATE INDEX XIE2FACT_RECEIVER_BD ON FACT_RECEIVER_BD(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_RECEIVER_BD ON FACT_RECEIVER_BD(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_RECEIVER_BD ON FACT_RECEIVER_BD(STORE_LOC_ID);
CREATE INDEX XIE5FACT_RECEIVER_BD ON FACT_RECEIVER_BD(STATUS_ID);




--changed as below INCLUDING ALL RELEASED BREAKDOWNED PO
CREATE TABLE FACT_PO_BD_RELEASE
(
  TRANS_BUSKEY           VARCHAR2(30) NOT NULL   --UNIQUE
  CONSTRAINT PKFACT_PO_BD_RELEASE PRIMARY KEY,
  PO_BD_RELEASE_ID       NUMBER(7)    NOT NULL,
  STYLE_COLOR_SIZE_GP_ID NUMBER(7)    NOT NULL,
  YEAR_SEASON_ID         NUMBER(7)    NOT NULL,
  STORE_LOC_ID           NUMBER(7)    NOT NULL,
  STATUS_ID              NUMBER(7)    NOT NULL,      --SUGGESTED/ADJUST
  SOURCE_TRANS_BUSKEY    VARCHAR2(30) NOT NULL,   --the Trans_buskey of any breakdowned record for tracking
  TOTAL_QTY              NUMBER(11)   NOT NULL
);

ALTER TABLE FACT_PO_BD_RELEASE ADD CONSTRAINT UN1FACT_PO_BD_RELEASE UNIQUE(STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_LOC_ID,STATUS_ID,PO_BD_RELEASE_ID);

ALTER TABLE FACT_PO_BD_RELEASE ADD CONSTRAINT FKFACT_PO_BD_RELEASE_S 
FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);

ALTER TABLE FACT_PO_BD_RELEASE ADD CONSTRAINT FKFACT_PO_BD_RELEASE_Y 
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_PO_BD_RELEASE ADD CONSTRAINT FKFACT_PO_BD_RELEASE_L 
FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_PO_BD_RELEASE ADD CONSTRAINT FKFACT_PO_BD_RELEASE_ST
FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

CREATE INDEX XIE1FACT_PO_BD_RELEASE ON FACT_PO_BD_RELEASE(PO_BD_RELEASE_ID);
CREATE INDEX XIE2FACT_PO_BD_RELEASE ON FACT_PO_BD_RELEASE(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_PO_BD_RELEASE ON FACT_PO_BD_RELEASE(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_PO_BD_RELEASE ON FACT_PO_BD_RELEASE(STORE_LOC_ID);
CREATE INDEX XIE5FACT_PO_BD_RELEASE ON FACT_PO_BD_RELEASE(STATUS_ID);



--changed as below INCLUDING ALL BREAKDOWNED ASN AND ADJUSTED BREAKDOWNED ASN
CREATE TABLE FACT_ASN_BD_RELEASE
(
  TRANS_BUSKEY           VARCHAR2(30) NOT NULL   --UNIQUE
  CONSTRAINT PKFACT_ASN_BD_RELEASE PRIMARY KEY,
  ASN_BD_RELEASE_ID       NUMBER(7)    NOT NULL,
  STYLE_COLOR_SIZE_GP_ID NUMBER(7)    NOT NULL,
  YEAR_SEASON_ID         NUMBER(7)    NOT NULL,
  STORE_LOC_ID           NUMBER(7)    NOT NULL,
  STATUS_ID              NUMBER(7)    NOT NULL,      --SUGGESTED/ADJUST
  SOURCE_TRANS_BUSKEY    VARCHAR2(30) NOT NULL,   --the Trans_buskey of any breakdowned record for tracking
  TOTAL_QTY              NUMBER(11)   NOT NULL
);

ALTER TABLE FACT_ASN_BD_RELEASE ADD CONSTRAINT UN1FACT_ASN_BD_RELEASE UNIQUE(STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_LOC_ID,STATUS_ID,ASN_BD_RELEASE_ID);

ALTER TABLE FACT_ASN_BD_RELEASE ADD CONSTRAINT FKFACT_ASN_BD_RELEASE_S 
FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);

ALTER TABLE FACT_ASN_BD_RELEASE ADD CONSTRAINT FKFACT_ASN_BD_RELEASE_Y 
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_ASN_BD_RELEASE ADD CONSTRAINT FKFACT_ASN_BD_RELEASE_L 
FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_ASN_BD_RELEASE ADD CONSTRAINT FKFACT_ASN_BD_RELEASE_ST
FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

CREATE INDEX XIE1FACT_ASN_BD_RELEASE ON FACT_ASN_BD_RELEASE(ASN_BD_RELEASE_ID);
CREATE INDEX XIE2FACT_ASN_BD_RELEASE ON FACT_ASN_BD_RELEASE(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_ASN_BD_RELEASE ON FACT_ASN_BD_RELEASE(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_ASN_BD_RELEASE ON FACT_ASN_BD_RELEASE(STORE_LOC_ID);
CREATE INDEX XIE5FACT_ASN_BD_RELEASE ON FACT_ASN_BD_RELEASE(STATUS_ID);


--changed as below INCLUDING ALL BREAKDOWNED RECEIVER AND ADJUSTED BREAKDOWNED RECEIVER
CREATE TABLE FACT_RECEIVER_BD_RELEASE
(
  TRANS_BUSKEY           VARCHAR2(30) NOT NULL   --UNIQUE
  CONSTRAINT PKFACT_RECEIVER_BD_RELEASE PRIMARY KEY,
  RECEIVER_BD_RELEASE_ID       NUMBER(7)    NOT NULL,
  STYLE_COLOR_SIZE_GP_ID NUMBER(7)    NOT NULL,
  YEAR_SEASON_ID         NUMBER(7)    NOT NULL,
  STORE_LOC_ID           NUMBER(7)    NOT NULL,
  STATUS_ID              NUMBER(7)    NOT NULL,      --SUGGESTED/ADJUST
  SOURCE_TRANS_BUSKEY    VARCHAR2(30) NOT NULL,   --the Trans_buskey of any breakdowned record for tracking
  TOTAL_QTY              NUMBER(11)   NOT NULL
);

ALTER TABLE FACT_RECEIVER_BD_RELEASE ADD CONSTRAINT UN1FACT_RECEIVER_BD_RELEASE UNIQUE(STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_LOC_ID,STATUS_ID,RECEIVER_BD_RELEASE_ID);

ALTER TABLE FACT_RECEIVER_BD_RELEASE ADD CONSTRAINT FKFACT_RECEIVER_BD_RELEASE_S 
FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);

ALTER TABLE FACT_RECEIVER_BD_RELEASE ADD CONSTRAINT FKFACT_RECEIVER_BD_RELEASE_Y 
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_RECEIVER_BD_RELEASE ADD CONSTRAINT FKFACT_RECEIVER_BD_RELEASE_L 
FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_RECEIVER_BD_RELEASE ADD CONSTRAINT FKFACT_RECEIVER_BD_RELEASE_ST
FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

CREATE INDEX XIE1FACT_RECEIVER_BD_RELEASE ON FACT_RECEIVER_BD_RELEASE(RECEIVER_BD_RELEASE_ID);
CREATE INDEX XIE2FACT_RECEIVER_BD_RELEASE ON FACT_RECEIVER_BD_RELEASE(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_RECEIVER_BD_RELEASE ON FACT_RECEIVER_BD_RELEASE(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_RECEIVER_BD_RELEASE ON FACT_RECEIVER_BD_RELEASE(STORE_LOC_ID);
CREATE INDEX XIE5FACT_RECEIVER_BD_RELEASE ON FACT_RECEIVER_BD_RELEASE(STATUS_ID);



CREATE SEQUENCE SEQ_TRANS_PO_BD
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_TRANS_ASN_BD
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_TRANS_RECEIVER_BD
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_TRANS_PO_BD_RELEASE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_TRANS_ASN_BD_RELEASE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_TRANS_RECEIVER_BD_RELEASE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;
--**********************************************************************************
--***************************PO/ASN/RECEIVER RAW************************************
--**********************************************************************************
--PO
--DROP TABLE PO_RAW PURGE;
CREATE TABLE PO_RAW(       
CORPORATE_DIVISION       VARCHAR2(60),
VENDOR_REF_NUMBER        VARCHAR2(20),
ACTION_FLAG              VARCHAR2(1),
PO_NUMBER                VARCHAR2(30),
STYLE_YEAR               NUMBER(4),
STYLE_SEASON             VARCHAR2(30),
START_DATE               VARCHAR2(8),
CANCEL_DATE              VARCHAR2(8),
IN_DC_DATE             VARCHAR2(8),
STYLE_NUMBER             VARCHAR2(40),
COLOR_CODE               VARCHAR2(20),
SIZE_CODE                VARCHAR2(20),
SIZE_DESC1               VARCHAR2(40),
SIZE_DESC2               VARCHAR2(40),
GOLDEN_PACKAGE_CODE      VARCHAR2(60),
COST                     NUMBER(9,2),
RETAIL                   NUMBER(9,2),
LOC_ATTR1                VARCHAR2(40),
TOTAL_QTY                NUMBER(11),
TOTAL_RETAIL             NUMBER(15,2),
TOTAL_COST               NUMBER(15,2),
LOC_ATTR2                VARCHAR2(40),
LOC_ATTR3                VARCHAR2(40),
TOTAL_DIST_INDICATOR     VARCHAR2(10),
LOC_ATTR4                VARCHAR2(40),
LOC_ATTR5                VARCHAR2(40),
LOC_ATTR6                VARCHAR2(40),
LOC_ATTR7                VARCHAR2(40),
LOC_ATTR8                VARCHAR2(40),
LOC_ATTR9                VARCHAR2(40),
LOC_ATTR10               VARCHAR2(40),
FILE_ROW_NUM             NUMBER(9) DEFAULT 0 NOT NULL,
UPLOAD_ID                NUMBER(9) NOT NULL
)
PARTITION BY RANGE (UPLOAD_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (1))
NOLOGGING;


CREATE SEQUENCE SEQ_TRANS_PO
 MINVALUE 1
 START WITH 1
 INCREMENT BY 1
 CACHE 20;


--ASN
--DROP TABLE ASN_RAW PURGE;
CREATE TABLE ASN_RAW(       
CORPORATE_DIVISION       VARCHAR2(60),
VENDOR_REF_NUMBER        VARCHAR2(20),
ACTION_FLAG              VARCHAR2(1),
ASN_NUMBER               VARCHAR2(30),
STYLE_YEAR               NUMBER(4),
STYLE_SEASON             VARCHAR2(30),
START_DATE               VARCHAR2(8),
CANCEL_DATE                 VARCHAR2(8),
IN_DC_DATE             VARCHAR2(8),
STYLE_NUMBER             VARCHAR2(40),
COLOR_CODE               VARCHAR2(20),
SIZE_CODE                VARCHAR2(20),
SIZE_DESC1               VARCHAR2(40),
SIZE_DESC2               VARCHAR2(40),
GOLDEN_PACKAGE_CODE      VARCHAR2(60),
COST                     NUMBER(9,2),
RETAIL                   NUMBER(9,2),
LOC_ATTR1                VARCHAR2(40),
TOTAL_QTY                NUMBER(11),
TOTAL_RETAIL             NUMBER(15,2),
TOTAL_COST               NUMBER(15,2),
LOC_ATTR2                VARCHAR2(40),
LOC_ATTR3                VARCHAR2(40),
TOTAL_DIST_INDICATOR     VARCHAR2(10),
LOC_ATTR4                VARCHAR2(40),
LOC_ATTR5                VARCHAR2(40),
LOC_ATTR6                VARCHAR2(40),
LOC_ATTR7                VARCHAR2(40),
LOC_ATTR8                VARCHAR2(40),
LOC_ATTR9                VARCHAR2(40),
LOC_ATTR10               VARCHAR2(40), 
FILE_ROW_NUM             NUMBER(9) DEFAULT 0 NOT NULL,
UPLOAD_ID                NUMBER(9) NOT NULL
)
PARTITION BY RANGE (UPLOAD_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (1))
NOLOGGING;


CREATE SEQUENCE SEQ_TRANS_ASN
 MINVALUE 1
 START WITH 1
 INCREMENT BY 1
 CACHE 20;




--RECEIVER
--DROP TABLE RECEIVER_RAW PURGE;
CREATE TABLE RECEIVER_RAW(       
CORPORATE_DIVISION       VARCHAR2(60),
VENDOR_REF_NUMBER        VARCHAR2(20),
ACTION_FLAG		           VARCHAR2(1),
RECEIVER_NUMBER          VARCHAR2(30),
STYLE_YEAR               NUMBER(4),
STYLE_SEASON             VARCHAR2(30),
START_DATE               VARCHAR2(8),
CANCEL_DATE              VARCHAR2(8),
IN_DC_DATE               VARCHAR2(8),
STYLE_NUMBER             VARCHAR2(40),
COLOR_CODE               VARCHAR2(20),
SIZE_CODE                VARCHAR2(20),
SIZE_DESC1               VARCHAR2(40),
SIZE_DESC2               VARCHAR2(40),
GOLDEN_PACKAGE_CODE      VARCHAR2(60), 
COST                     NUMBER(9,2),
RETAIL                   NUMBER(9,2),
LOC_ATTR1                VARCHAR2(40),
TOTAL_QTY                NUMBER(11),
TOTAL_RETAIL             NUMBER(15,2),
TOTAL_COST               NUMBER(15,2),
LOC_ATTR2                VARCHAR2(40),
LOC_ATTR3                VARCHAR2(40),
TOTAL_DIST_INDICATOR     VARCHAR2(10),
LOC_ATTR4                VARCHAR2(40),
LOC_ATTR5                VARCHAR2(40),
LOC_ATTR6                VARCHAR2(40),
LOC_ATTR7                VARCHAR2(40),
LOC_ATTR8                VARCHAR2(40),
LOC_ATTR9                VARCHAR2(40),
LOC_ATTR10               VARCHAR2(40),
FILE_ROW_NUM             NUMBER(9) DEFAULT 0 NOT NULL,
UPLOAD_ID                NUMBER(9) NOT NULL
)
PARTITION BY RANGE (UPLOAD_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (1))
NOLOGGING;


CREATE SEQUENCE SEQ_TRANS_RECEIVER
 MINVALUE 1
 START WITH 1
 INCREMENT BY 1
 CACHE 20;



--**************************************************************************************
--*****************************FACT_PO_ALLOCATE*****************************************
--**************************************************************************************
--This is a transactional fact, the grain is per Style_Color_Size_GoldPackage+per DOOR+per year_Season. 
--Sourced from ALLOCATED_PO.
--transactional fact, the grain is per reciver allocation batch+per style color size gp+per year season+ per store+ per status
CREATE TABLE FACT_PO_ALLOCATE(
PO_ALLOCATE_ID            NUMBER(7)    NOT NULL,
TRANS_BUSKEY              VARCHAR2(30) NOT NULL,      --UNIQUE 
STYLE_COLOR_SIZE_GP_ID    NUMBER(7)    NOT NULL,
YEAR_SEASON_ID            NUMBER(7)    NOT NULL,
STORE_ID                  NUMBER(7)    NOT NULL,   
STATUS_ID                 NUMBER(7)    NOT NULL,      --System suggested/Adjusted
SOURCE_TRANS_BUSKEY       VARCHAR2(30) NOT NULL,      --FACT_PO.TRANS_BUSKEY
STORE_INDEX               NUMBER(8,2)  NOT NULL,
PULL_QTY                  NUMBER(15,2) NOT NULL,
PUSH_QTY                  NUMBER(15,2) NOT NULL,
CONSTRAINT PKFACT_PO_ALLOCATE PRIMARY KEY(TRANS_BUSKEY)
);

ALTER TABLE FACT_PO_ALLOCATE ADD CONSTRAINT UN1FACT_PO_ALLOCATE UNIQUE(PO_ALLOCATE_ID,STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_ID,STATUS_ID);

ALTER TABLE FACT_PO_ALLOCATE ADD CONSTRAINT FKFACT_PO_ALLOCATE_RA 
      FOREIGN KEY(PO_ALLOCATE_ID) REFERENCES DIM_PO_ALLOCATE(PO_ALLOCATE_ID);

ALTER TABLE FACT_PO_ALLOCATE ADD CONSTRAINT FKFACT_PO_ALLOCATE_S 
      FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);           

ALTER TABLE FACT_PO_ALLOCATE ADD CONSTRAINT FKFACT_PO_ALLOCATE_YS 
      FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);       

ALTER TABLE FACT_PO_ALLOCATE ADD CONSTRAINT FKFACT_PO_ALLOCATE_D 
      FOREIGN KEY(STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID);      

ALTER TABLE FACT_PO_ALLOCATE ADD CONSTRAINT FKFACT_PO_ALLOCATE_C
      FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);       

CREATE INDEX XIE1FACT_PO_ALLOCATE ON FACT_PO_ALLOCATE(PO_ALLOCATE_ID);
CREATE INDEX XIE2FACT_PO_ALLOCATE ON FACT_PO_ALLOCATE(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_PO_ALLOCATE ON FACT_PO_ALLOCATE(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_PO_ALLOCATE ON FACT_PO_ALLOCATE(STORE_ID);
CREATE INDEX XIE5FACT_PO_ALLOCATE ON FACT_PO_ALLOCATE(STATUS_ID);


--PO allocated reserve, the grain is per PO allocated batch+per style color size gp+ per loc(stockcategory)
CREATE TABLE FACT_PO_ALLOCATE_RESERVE(
PO_ALLOCATE_ID              NUMBER(7)    NOT NULL,
TRANS_BUSKEY                VARCHAR2(30) NOT NULL,      --UNIQUE 
STYLE_COLOR_SIZE_GP_ID      NUMBER(7)    NOT NULL,
YEAR_SEASON_ID              NUMBER(7)    NOT NULL,
STORE_LOC_ID                NUMBER(7)    NOT NULL,
STATUS_ID                   NUMBER(7)    NOT NULL,      --System suggested/Adjusted
SOURCE_TRANS_BUSKEY         VARCHAR2(30) NOT NULL,      --FACT_PO.TRANS_BUSKEY
PULL_QTY                    NUMBER(15,2) NOT NULL,
PUSH_QTY                    NUMBER(15,2) NOT NULL,
CONSTRAINT PKFACT_PO_ALLOCATE_RESERVE PRIMARY KEY(TRANS_BUSKEY)
);

ALTER TABLE FACT_PO_ALLOCATE_RESERVE ADD CONSTRAINT UN1FACT_PO_ALLOCATE_R UNIQUE(PO_ALLOCATE_ID,STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_LOC_ID,STATUS_ID);
ALTER TABLE FACT_PO_ALLOCATE_RESERVE ADD CONSTRAINT FKFACT_PO_ALLOCATE_R_RA 
      FOREIGN KEY(PO_ALLOCATE_ID) REFERENCES DIM_PO_ALLOCATE(PO_ALLOCATE_ID);

ALTER TABLE FACT_PO_ALLOCATE_RESERVE ADD CONSTRAINT FKFACT_PO_ALLOCATE_R_S 
      FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);   

ALTER TABLE FACT_PO_ALLOCATE_RESERVE ADD CONSTRAINT FKFACT_PO_ALLOCATE_R_YS
      FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID); 


ALTER TABLE FACT_PO_ALLOCATE_RESERVE ADD CONSTRAINT FKFACT_PO_ALLOCATE_R_D
      FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID); 

ALTER TABLE FACT_PO_ALLOCATE_RESERVE ADD CONSTRAINT FKFACT_PO_ALLOCATE_R_C
      FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID); 

CREATE INDEX XIE1FACT_PO_ALLOCATE_RES ON FACT_PO_ALLOCATE_RESERVE(PO_ALLOCATE_ID);
CREATE INDEX XIE2FACT_PO_ALLOCATE_RES ON FACT_PO_ALLOCATE_RESERVE(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_PO_ALLOCATE_RES ON FACT_PO_ALLOCATE_RESERVE(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_PO_ALLOCATE_RES ON FACT_PO_ALLOCATE_RESERVE(STORE_LOC_ID);
CREATE INDEX XIE5FACT_PO_ALLOCATE_RES ON FACT_PO_ALLOCATE_RESERVE(STATUS_ID);




--**************************************************************************************
--*****************************FACT_ALLOCATED_ASN*****************************************
--**************************************************************************************
--This is a transactional fact, the grain is per Style_Color_Size_GoldPackage+per DOOR+per year_Season. 
--Sourced from ALLOCATED_ASN.
--transactional fact, the grain is per reciver allocation batch+per style color size gp+per year season+ per store+ per status
CREATE TABLE FACT_ASN_ALLOCATE(
TRANS_BUSKEY             VARCHAR2(30) NOT NULL      --UNIQUE 
CONSTRAINT PKFACT_ASN_ALLOCATE PRIMARY KEY,
ASN_ALLOCATE_ID          NUMBER(7)    NOT NULL,
STYLE_COLOR_SIZE_GP_ID   NUMBER(7)    NOT NULL,
YEAR_SEASON_ID           NUMBER(7)    NOT NULL,
STORE_ID                 NUMBER(7)    NOT NULL,   
STATUS_ID                NUMBER(7)    NOT NULL,      --System suggested/Adjusted
SOURCE_TRANS_BUSKEY      VARCHAR2(30) NOT NULL,      --FACT_ASN.TRANS_BUSKEY
STORE_INDEX              NUMBER(8,2)  NOT NULL,
PULL_QTY                 NUMBER(15,2) NOT NULL,
PUSH_QTY                 NUMBER(15,2) NOT NULL
);

ALTER TABLE FACT_ASN_ALLOCATE ADD CONSTRAINT UN1FACT_ASN_ALLOCATE UNIQUE(ASN_ALLOCATE_ID,STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_ID,STATUS_ID);

ALTER TABLE FACT_ASN_ALLOCATE ADD CONSTRAINT FKFACT_ASN_ALLOCATE_RA 
      FOREIGN KEY(ASN_ALLOCATE_ID) REFERENCES DIM_ASN_ALLOCATE(ASN_ALLOCATE_ID);

ALTER TABLE FACT_ASN_ALLOCATE ADD CONSTRAINT FKFACT_ASN_ALLOCATE_S 
      FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);           

ALTER TABLE FACT_ASN_ALLOCATE ADD CONSTRAINT FKFACT_ASN_ALLOCATE_YS 
      FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);       

ALTER TABLE FACT_ASN_ALLOCATE ADD CONSTRAINT FKFACT_ASN_ALLOCATE_D 
      FOREIGN KEY(STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID);      

ALTER TABLE FACT_ASN_ALLOCATE ADD CONSTRAINT FKFACT_ASN_ALLOCATE_C
      FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);       

CREATE INDEX XIE1FACT_ASN_ALLOCATE ON FACT_ASN_ALLOCATE(ASN_ALLOCATE_ID);
CREATE INDEX XIE2FACT_ASN_ALLOCATE ON FACT_ASN_ALLOCATE(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_ASN_ALLOCATE ON FACT_ASN_ALLOCATE(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_ASN_ALLOCATE ON FACT_ASN_ALLOCATE(STORE_ID);
CREATE INDEX XIE5FACT_ASN_ALLOCATE ON FACT_ASN_ALLOCATE(STATUS_ID);


--ASN allocated reserve, the grain is per ASN allocated batch+per style color size gp+ per loc(stockcategory)
CREATE TABLE FACT_ASN_ALLOCATE_RESERVE(
ASN_ALLOCATE_ID          NUMBER(7)    NOT NULL,
TRANS_BUSKEY             VARCHAR2(30) NOT NULL,      --UNIQUE 
STYLE_COLOR_SIZE_GP_ID   NUMBER(7)    NOT NULL,
YEAR_SEASON_ID           NUMBER(7)    NOT NULL,
STORE_LOC_ID             NUMBER(7)    NOT NULL,
STATUS_ID                NUMBER(7)    NOT NULL,      --System suggested/Adjusted
SOURCE_TRANS_BUSKEY      VARCHAR2(30) NOT NULL,      --FACT_ASN.TRANS_BUSKEY
PULL_QTY                 NUMBER(15,2) NOT NULL,
PUSH_QTY                 NUMBER(15,2) NOT NULL,
CONSTRAINT PKFACT_ASN_ALLOCATE_RESERVE PRIMARY KEY(TRANS_BUSKEY)
);

ALTER TABLE FACT_ASN_ALLOCATE_RESERVE ADD CONSTRAINT UN1FACT_ASN_ALLOCATE_R UNIQUE(ASN_ALLOCATE_ID,STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_LOC_ID,STATUS_ID);
ALTER TABLE FACT_ASN_ALLOCATE_RESERVE ADD CONSTRAINT FKFACT_ASN_ALLOCATE_R_RA 
      FOREIGN KEY(ASN_ALLOCATE_ID) REFERENCES DIM_ASN_ALLOCATE(ASN_ALLOCATE_ID);

ALTER TABLE FACT_ASN_ALLOCATE_RESERVE ADD CONSTRAINT FKFACT_ASN_ALLOCATE_R_S 
      FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);   

ALTER TABLE FACT_ASN_ALLOCATE_RESERVE ADD CONSTRAINT FKFACT_ASN_ALLOCATE_R_YS
      FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID); 


ALTER TABLE FACT_ASN_ALLOCATE_RESERVE ADD CONSTRAINT FKFACT_ASN_ALLOCATE_R_D
      FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID); 

ALTER TABLE FACT_ASN_ALLOCATE_RESERVE ADD CONSTRAINT FKFACT_ASN_ALLOCATE_R_C
      FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID); 

CREATE INDEX XIE1FACT_ASN_ALLOCATE_RES ON FACT_ASN_ALLOCATE_RESERVE(ASN_ALLOCATE_ID);
CREATE INDEX XIE2FACT_ASN_ALLOCATE_RES ON FACT_ASN_ALLOCATE_RESERVE(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_ASN_ALLOCATE_RES ON FACT_ASN_ALLOCATE_RESERVE(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_ASN_ALLOCATE_RES ON FACT_ASN_ALLOCATE_RESERVE(STORE_LOC_ID);
CREATE INDEX XIE5FACT_ASN_ALLOCATE_RES ON FACT_ASN_ALLOCATE_RESERVE(STATUS_ID);






--**************************************************************************************
--*****************************FACT_ALLOCATED_RECEIVER*****************************************
--**************************************************************************************
--transactional fact, the grain is per reciver allocation batch+per style color size gp+per year season+ per store+ per status
CREATE TABLE FACT_RECEIVER_ALLOCATE(
RECEIVER_ALLOCATE_ID     NUMBER(7)    NOT NULL,
TRANS_BUSKEY             VARCHAR2(30) NOT NULL,      --UNIQUE 
STYLE_COLOR_SIZE_GP_ID   NUMBER(7)    NOT NULL,
YEAR_SEASON_ID           NUMBER(7)    NOT NULL,
STORE_ID                 NUMBER(7)    NOT NULL,   
STATUS_ID                NUMBER(7)    NOT NULL,      --System suggested/Adjusted
SOURCE_TRANS_BUSKEY      VARCHAR2(30) NOT NULL,      --FACT_RECEIVER.TRANS_BUSKEY
STORE_INDEX              NUMBER(8,2)  NOT NULL,
PULL_QTY                 NUMBER(15,2) NOT NULL,
PUSH_QTY                 NUMBER(15,2) NOT NULL,
CONSTRAINT PKFACT_RECEIVER_ALLOCATE PRIMARY KEY(TRANS_BUSKEY)
);

ALTER TABLE FACT_RECEIVER_ALLOCATE ADD CONSTRAINT UN1FACT_RECEIVER_ALLOCATE UNIQUE(RECEIVER_ALLOCATE_ID,STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_ID,STATUS_ID);

ALTER TABLE FACT_RECEIVER_ALLOCATE ADD CONSTRAINT FKFACT_RECEIVER_ALLOCATE_RA 
      FOREIGN KEY(RECEIVER_ALLOCATE_ID) REFERENCES DIM_RECEIVER_ALLOCATE(RECEIVER_ALLOCATE_ID);

ALTER TABLE FACT_RECEIVER_ALLOCATE ADD CONSTRAINT FKFACT_RECEIVER_ALLOCATE_S 
      FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);           

ALTER TABLE FACT_RECEIVER_ALLOCATE ADD CONSTRAINT FKFACT_RECEIVER_ALLOCATE_YS 
      FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);       

ALTER TABLE FACT_RECEIVER_ALLOCATE ADD CONSTRAINT FKFACT_RECEIVER_ALLOCATE_D 
      FOREIGN KEY(STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID);      

ALTER TABLE FACT_RECEIVER_ALLOCATE ADD CONSTRAINT FKFACT_RECEIVER_ALLOCATE_C
      FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);       

CREATE INDEX XIE1FACT_RECEIVER_ALLOCATE ON FACT_RECEIVER_ALLOCATE(RECEIVER_ALLOCATE_ID);
CREATE INDEX XIE2FACT_RECEIVER_ALLOCATE ON FACT_RECEIVER_ALLOCATE(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_RECEIVER_ALLOCATE ON FACT_RECEIVER_ALLOCATE(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_RECEIVER_ALLOCATE ON FACT_RECEIVER_ALLOCATE(STORE_ID);
CREATE INDEX XIE5FACT_RECEIVER_ALLOCATE ON FACT_RECEIVER_ALLOCATE(STATUS_ID);


--Receiver allocated reserve, the grain is per receiver allocated batch+per style color size gp+ per loc(stockcategory)
CREATE TABLE FACT_RECEIVER_ALLOCATE_RESERVE(
RECEIVER_ALLOCATE_ID     NUMBER(7)    NOT NULL,
TRANS_BUSKEY             VARCHAR2(30) NOT NULL,      --UNIQUE 
STYLE_COLOR_SIZE_GP_ID   NUMBER(7)    NOT NULL,
YEAR_SEASON_ID           NUMBER(7)    NOT NULL,
STORE_LOC_ID             NUMBER(7)    NOT NULL,
STATUS_ID                NUMBER(7)    NOT NULL,      --System suggested/Adjusted
SOURCE_TRANS_BUSKEY      VARCHAR2(30) NOT NULL,      --FACT_RECEIVER.TRANS_BUSKEY
PULL_QTY                 NUMBER(15,2) NOT NULL,
PUSH_QTY                 NUMBER(15,2) NOT NULL,
CONSTRAINT PKFACT_RECEIVER_ALLOCATE_RES PRIMARY KEY(TRANS_BUSKEY)
);

ALTER TABLE FACT_RECEIVER_ALLOCATE_RESERVE ADD CONSTRAINT UN1FACT_RECEIVER_ALLOCATE_R UNIQUE(RECEIVER_ALLOCATE_ID,STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_LOC_ID,STATUS_ID);
ALTER TABLE FACT_RECEIVER_ALLOCATE_RESERVE ADD CONSTRAINT FKFACT_RECEIVER_ALLOCATE_R_RA 
      FOREIGN KEY(RECEIVER_ALLOCATE_ID) REFERENCES DIM_RECEIVER_ALLOCATE(RECEIVER_ALLOCATE_ID);

ALTER TABLE FACT_RECEIVER_ALLOCATE_RESERVE ADD CONSTRAINT FKFACT_RECEIVER_ALLOCATE_R_S 
      FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);   

ALTER TABLE FACT_RECEIVER_ALLOCATE_RESERVE ADD CONSTRAINT FKFACT_RECEIVER_ALLOCATE_R_YS
      FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID); 


ALTER TABLE FACT_RECEIVER_ALLOCATE_RESERVE ADD CONSTRAINT FKFACT_RECEIVER_ALLOCATE_R_D
      FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID); 

ALTER TABLE FACT_RECEIVER_ALLOCATE_RESERVE ADD CONSTRAINT FKFACT_RECEIVER_ALLOCATE_R_C
      FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID); 

CREATE INDEX XIE1FACT_RECEIVER_ALLOCATE_RES ON FACT_RECEIVER_ALLOCATE_RESERVE(RECEIVER_ALLOCATE_ID);
CREATE INDEX XIE2FACT_RECEIVER_ALLOCATE_RES ON FACT_RECEIVER_ALLOCATE_RESERVE(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_RECEIVER_ALLOCATE_RES ON FACT_RECEIVER_ALLOCATE_RESERVE(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_RECEIVER_ALLOCATE_RES ON FACT_RECEIVER_ALLOCATE_RESERVE(STORE_LOC_ID);
CREATE INDEX XIE5FACT_RECEIVER_ALLOCATE_RES ON FACT_RECEIVER_ALLOCATE_RESERVE(STATUS_ID);







--**************************************************************************************
--*****************************FACT_PO_RELEASE*****************************************
--**************************************************************************************


--Transactional fact, the grain is per PO release batch+per style color size gp+ per year season+ per store +per status
CREATE TABLE FACT_PO_RELEASE(
PO_RELEASE_ID            NUMBER(7)    NOT NULL,
TRANS_BUSKEY             VARCHAR2(30) NOT NULL,      --UNIQUE 
STYLE_COLOR_SIZE_GP_ID   NUMBER(7)    NOT NULL,
YEAR_SEASON_ID           NUMBER(7)    NOT NULL,
STORE_ID                 NUMBER(7)    NOT NULL,   
STATUS_ID                NUMBER(7)    NOT NULL,      --System suggested/Adjusted
SOURCE_TRANS_BUSKEY      VARCHAR2(30) NOT NULL,      --FACT_PO_ALLOCATE.TRANS_BUSKEY
STORE_INDEX              NUMBER(8,2)  NOT NULL,
QTY                      NUMBER(15,2) NOT NULL,
CONSTRAINT PKFACT_PO_RELEASE PRIMARY KEY(TRANS_BUSKEY)
);    

ALTER TABLE FACT_PO_RELEASE ADD CONSTRAINT UN1FACT_PO_RELEASE UNIQUE(PO_RELEASE_ID,STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_ID,STATUS_ID);
ALTER TABLE FACT_PO_RELEASE ADD CONSTRAINT FKFACT_PO_RELEASE_RR
      FOREIGN KEY(PO_RELEASE_ID) REFERENCES DIM_PO_RELEASE(PO_RELEASE_ID);

ALTER TABLE FACT_PO_RELEASE ADD CONSTRAINT FKFACT_PO_RELEASE_S
      FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);      

ALTER TABLE FACT_PO_RELEASE ADD CONSTRAINT FKFACT_PO_RELEASE_Y
      FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID); 
      
ALTER TABLE FACT_PO_RELEASE ADD CONSTRAINT FKFACT_PO_RELEASE_D
      FOREIGN KEY(STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID); 

ALTER TABLE FACT_PO_RELEASE ADD CONSTRAINT FKFACT_PO_RELEASE_C
      FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

CREATE INDEX XIE1FACT_PO_RELEASE ON FACT_PO_RELEASE(PO_RELEASE_ID);
CREATE INDEX XIE2FACT_PO_RELEASE ON FACT_PO_RELEASE(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_PO_RELEASE ON FACT_PO_RELEASE(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_PO_RELEASE ON FACT_PO_RELEASE(STORE_ID);
CREATE INDEX XIE5FACT_PO_RELEASE ON FACT_PO_RELEASE(STATUS_ID);



-- transactional fact, the grain is per PO release batch+ per style color size gp+per year season+ per loc(stockcategory)+per status
CREATE TABLE FACT_PO_RELEASE_RESERVE(
PO_RELEASE_ID            NUMBER(7)    NOT NULL,
TRANS_BUSKEY             VARCHAR2(30) NOT NULL,      --UNIQUE 
STYLE_COLOR_SIZE_GP_ID   NUMBER(7)    NOT NULL,
YEAR_SEASON_ID           NUMBER(7)    NOT NULL,
STORE_LOC_ID             NUMBER(7)    NOT NULL,
STATUS_ID                NUMBER(7)    NOT NULL,      --System suggested/Adjusted
SOURCE_TRANS_BUSKEY      VARCHAR2(30) NOT NULL,      --FACT_PO_ALLOCATE.TRANS_BUSKEY
QTY                      NUMBER(15,2) NOT NULL,
CONSTRAINT PKFACT_PO_RELEASE_RESERVE PRIMARY KEY(TRANS_BUSKEY)
);

ALTER TABLE FACT_PO_RELEASE_RESERVE ADD CONSTRAINT UN1FACT_PO_RELEASE_R UNIQUE(PO_RELEASE_ID,STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_LOC_ID,STATUS_ID);
ALTER TABLE FACT_PO_RELEASE_RESERVE ADD CONSTRAINT FKFACT_PO_RELEASE_R_RA 
      FOREIGN KEY(PO_RELEASE_ID) REFERENCES DIM_PO_RELEASE(PO_RELEASE_ID);

ALTER TABLE FACT_PO_RELEASE_RESERVE ADD CONSTRAINT FKFACT_PO_RELEASE_R_S 
      FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);   

ALTER TABLE FACT_PO_RELEASE_RESERVE ADD CONSTRAINT FKFACT_PO_RELEASE_R_YS
      FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID); 


ALTER TABLE FACT_PO_RELEASE_RESERVE ADD CONSTRAINT FKFACT_PO_RELEASE_R_D
      FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID); 

ALTER TABLE FACT_PO_RELEASE_RESERVE ADD CONSTRAINT FKFACT_PO_RELEASE_R_C
      FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID); 

CREATE INDEX XIE1FACT_PO_RELEASE_RES ON FACT_PO_RELEASE_RESERVE(PO_RELEASE_ID);
CREATE INDEX XIE2FACT_PO_RELEASE_RES ON FACT_PO_RELEASE_RESERVE(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_PO_RELEASE_RES ON FACT_PO_RELEASE_RESERVE(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_PO_RELEASE_RES ON FACT_PO_RELEASE_RESERVE(STORE_LOC_ID);
CREATE INDEX XIE5FACT_PO_RELEASE_RES ON FACT_PO_RELEASE_RESERVE(STATUS_ID);



--**************************************************************************************
--*****************************FACT_ASN_RELEASE*****************************************
--**************************************************************************************


--Transactional fact, the grain is per ASN release batch+per style color size gp+ per year season+ per store +per status
CREATE TABLE FACT_ASN_RELEASE(
ASN_RELEASE_ID           NUMBER(7)    NOT NULL,
TRANS_BUSKEY             VARCHAR2(30) NOT NULL,      --UNIQUE 
STYLE_COLOR_SIZE_GP_ID   NUMBER(7)    NOT NULL,
YEAR_SEASON_ID           NUMBER(7)    NOT NULL,
STORE_ID                 NUMBER(7)    NOT NULL,   
STATUS_ID                NUMBER(7)    NOT NULL,      --System suggested/Adjusted
SOURCE_TRANS_BUSKEY      VARCHAR2(30) NOT NULL,      --FACT_ASN_ALLOCATE.TRANS_BUSKEY
STORE_INDEX              NUMBER(8,2)  NOT NULL,
QTY                      NUMBER(15,2) NOT NULL,
CONSTRAINT PKFACT_ASN_RELEASE PRIMARY KEY(TRANS_BUSKEY)
);    

ALTER TABLE FACT_ASN_RELEASE ADD CONSTRAINT UN1FACT_ASN_RELEASE UNIQUE(ASN_RELEASE_ID,STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_ID,STATUS_ID);
ALTER TABLE FACT_ASN_RELEASE ADD CONSTRAINT FKFACT_ASN_RELEASE_RR
      FOREIGN KEY(ASN_RELEASE_ID) REFERENCES DIM_ASN_RELEASE(ASN_RELEASE_ID);

ALTER TABLE FACT_ASN_RELEASE ADD CONSTRAINT FKFACT_ASN_RELEASE_S
      FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);      

ALTER TABLE FACT_ASN_RELEASE ADD CONSTRAINT FKFACT_ASN_RELEASE_Y
      FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID); 
      
ALTER TABLE FACT_ASN_RELEASE ADD CONSTRAINT FKFACT_ASN_RELEASE_D
      FOREIGN KEY(STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID); 

ALTER TABLE FACT_ASN_RELEASE ADD CONSTRAINT FKFACT_ASN_RELEASE_C
      FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

CREATE INDEX XIE1FACT_ASN_RELEASE ON FACT_ASN_RELEASE(ASN_RELEASE_ID);
CREATE INDEX XIE2FACT_ASN_RELEASE ON FACT_ASN_RELEASE(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_ASN_RELEASE ON FACT_ASN_RELEASE(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_ASN_RELEASE ON FACT_ASN_RELEASE(STORE_ID);
CREATE INDEX XIE5FACT_ASN_RELEASE ON FACT_ASN_RELEASE(STATUS_ID);



-- transactional fact, the grain is per ASN release batch+ per style color size gp+per year season+ per loc(stockcategory)+per status
CREATE TABLE FACT_ASN_RELEASE_RESERVE(
ASN_RELEASE_ID           NUMBER(7)    NOT NULL,
TRANS_BUSKEY             VARCHAR2(30) NOT NULL,      --UNIQUE 
STYLE_COLOR_SIZE_GP_ID   NUMBER(7)    NOT NULL,
YEAR_SEASON_ID           NUMBER(7)    NOT NULL,
STORE_LOC_ID             NUMBER(7)    NOT NULL,
STATUS_ID                NUMBER(7)    NOT NULL,      --System suggested/Adjusted
SOURCE_TRANS_BUSKEY      VARCHAR2(30) NOT NULL,      --FACT_ASN_ALLOCATE.TRANS_BUSKEY
QTY                      NUMBER(15,2) NOT NULL,
CONSTRAINT PKFACT_ASN_RELEASE_RESERVE PRIMARY KEY(TRANS_BUSKEY)
);

ALTER TABLE FACT_ASN_RELEASE_RESERVE ADD CONSTRAINT UN1FACT_ASN_RELEASE_R UNIQUE(ASN_RELEASE_ID,STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_LOC_ID,STATUS_ID);
ALTER TABLE FACT_ASN_RELEASE_RESERVE ADD CONSTRAINT FKFACT_ASN_RELEASE_R_RA 
      FOREIGN KEY(ASN_RELEASE_ID) REFERENCES DIM_ASN_RELEASE(ASN_RELEASE_ID);

ALTER TABLE FACT_ASN_RELEASE_RESERVE ADD CONSTRAINT FKFACT_ASN_RELEASE_R_S 
      FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);   

ALTER TABLE FACT_ASN_RELEASE_RESERVE ADD CONSTRAINT FKFACT_ASN_RELEASE_R_YS
      FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID); 


ALTER TABLE FACT_ASN_RELEASE_RESERVE ADD CONSTRAINT FKFACT_ASN_RELEASE_R_D
      FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID); 

ALTER TABLE FACT_ASN_RELEASE_RESERVE ADD CONSTRAINT FKFACT_ASN_RELEASE_R_C
      FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID); 

CREATE INDEX XIE1FACT_ASN_RELEASE_RES ON FACT_ASN_RELEASE_RESERVE(ASN_RELEASE_ID);
CREATE INDEX XIE2FACT_ASN_RELEASE_RES ON FACT_ASN_RELEASE_RESERVE(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_ASN_RELEASE_RES ON FACT_ASN_RELEASE_RESERVE(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_ASN_RELEASE_RES ON FACT_ASN_RELEASE_RESERVE(STORE_LOC_ID);
CREATE INDEX XIE5FACT_ASN_RELEASE_RES ON FACT_ASN_RELEASE_RESERVE(STATUS_ID);



--**************************************************************************************
--*****************************FACT_RECEIVER_RELEASE*****************************************
--**************************************************************************************


--Transactional fact, the grain is per receiver release batch+per style color size gp+ per year season+ per store +per status
CREATE TABLE FACT_RECEIVER_RELEASE(
RECEIVER_RELEASE_ID      NUMBER(7)    NOT NULL,
TRANS_BUSKEY             VARCHAR2(30) NOT NULL,      --UNIQUE 
STYLE_COLOR_SIZE_GP_ID   NUMBER(7)    NOT NULL,
YEAR_SEASON_ID           NUMBER(7)    NOT NULL,
STORE_ID                 NUMBER(7)    NOT NULL,   
STATUS_ID                NUMBER(7)    NOT NULL,      --System suggested/Adjusted
SOURCE_TRANS_BUSKEY      VARCHAR2(30) NOT NULL,      --FACT_RECEIVER_ALLOCATE.TRANS_BUSKEY
STORE_INDEX              NUMBER(8,2)  NOT NULL,
QTY                      NUMBER(15,2) NOT NULL,
CONSTRAINT PKFACT_RECEIVER_RELEASE PRIMARY KEY(TRANS_BUSKEY)
);

ALTER TABLE FACT_RECEIVER_RELEASE ADD CONSTRAINT UN1FACT_RECEIVER_RELEASE UNIQUE(RECEIVER_RELEASE_ID,STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_ID,STATUS_ID);
ALTER TABLE FACT_RECEIVER_RELEASE ADD CONSTRAINT FKFACT_RECEIVER_RELEASE_RR
      FOREIGN KEY(RECEIVER_RELEASE_ID) REFERENCES DIM_RECEIVER_RELEASE(RECEIVER_RELEASE_ID);

ALTER TABLE FACT_RECEIVER_RELEASE ADD CONSTRAINT FKFACT_RECEIVER_RELEASE_S
      FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);      

ALTER TABLE FACT_RECEIVER_RELEASE ADD CONSTRAINT FKFACT_RECEIVER_RELEASE_Y
      FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID); 
      
ALTER TABLE FACT_RECEIVER_RELEASE ADD CONSTRAINT FKFACT_RECEIVER_RELEASE_D
      FOREIGN KEY(STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID); 

ALTER TABLE FACT_RECEIVER_RELEASE ADD CONSTRAINT FKFACT_RECEIVER_RELEASE_C
      FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

CREATE INDEX XIE1FACT_RECEIVER_RELEASE ON FACT_RECEIVER_RELEASE(RECEIVER_RELEASE_ID);
CREATE INDEX XIE2FACT_RECEIVER_RELEASE ON FACT_RECEIVER_RELEASE(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_RECEIVER_RELEASE ON FACT_RECEIVER_RELEASE(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_RECEIVER_RELEASE ON FACT_RECEIVER_RELEASE(STORE_ID);
CREATE INDEX XIE5FACT_RECEIVER_RELEASE ON FACT_RECEIVER_RELEASE(STATUS_ID);



-- transactional fact, the grain is per receiver release batch+ per style color size gp+per year season+ per loc(stockcategory)+per status
CREATE TABLE FACT_RECEIVER_RELEASE_RESERVE(
RECEIVER_RELEASE_ID      NUMBER(7)    NOT NULL,
TRANS_BUSKEY             VARCHAR2(30) NOT NULL,      --UNIQUE 
STYLE_COLOR_SIZE_GP_ID   NUMBER(7)    NOT NULL,
YEAR_SEASON_ID           NUMBER(7)    NOT NULL,
STORE_LOC_ID             NUMBER(7)    NOT NULL,
STATUS_ID                NUMBER(7)    NOT NULL,      --System suggested/Adjusted
SOURCE_TRANS_BUSKEY      VARCHAR2(30) NOT NULL,      --FACT_RECEIVER_ALLOCATE.TRANS_BUSKEY
QTY                      NUMBER(15,2) NOT NULL,
CONSTRAINT PKFACT_RECEIVER_RELEASE_RES PRIMARY KEY(TRANS_BUSKEY)
);

ALTER TABLE FACT_RECEIVER_RELEASE_RESERVE ADD CONSTRAINT UN1FACT_RECEIVER_RELEASE_R UNIQUE(RECEIVER_RELEASE_ID,STYLE_COLOR_SIZE_GP_ID,YEAR_SEASON_ID,STORE_LOC_ID,STATUS_ID);
ALTER TABLE FACT_RECEIVER_RELEASE_RESERVE ADD CONSTRAINT FKFACT_RECEIVER_RELEASE_R_RA 
      FOREIGN KEY(RECEIVER_RELEASE_ID) REFERENCES DIM_RECEIVER_RELEASE(RECEIVER_RELEASE_ID);

ALTER TABLE FACT_RECEIVER_RELEASE_RESERVE ADD CONSTRAINT FKFACT_RECEIVER_RELEASE_R_S 
      FOREIGN KEY(STYLE_COLOR_SIZE_GP_ID) REFERENCES DIM_STYLE_COLOR_SIZE_GP(STYLE_COLOR_SIZE_GP_ID);   

ALTER TABLE FACT_RECEIVER_RELEASE_RESERVE ADD CONSTRAINT FKFACT_RECEIVER_RELEASE_R_YS
      FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID); 


ALTER TABLE FACT_RECEIVER_RELEASE_RESERVE ADD CONSTRAINT FKFACT_RECEIVER_RELEASE_R_D
      FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID); 

ALTER TABLE FACT_RECEIVER_RELEASE_RESERVE ADD CONSTRAINT FKFACT_RECEIVER_RELEASE_R_C
      FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID); 

CREATE INDEX XIE1FACT_RECEIVER_RELEASE_RES ON FACT_RECEIVER_RELEASE_RESERVE(RECEIVER_RELEASE_ID);
CREATE INDEX XIE2FACT_RECEIVER_RELEASE_RES ON FACT_RECEIVER_RELEASE_RESERVE(STYLE_COLOR_SIZE_GP_ID);
CREATE INDEX XIE3FACT_RECEIVER_RELEASE_RES ON FACT_RECEIVER_RELEASE_RESERVE(YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_RECEIVER_RELEASE_RES ON FACT_RECEIVER_RELEASE_RESERVE(STORE_LOC_ID);
CREATE INDEX XIE5FACT_RECEIVER_RELEASE_RES ON FACT_RECEIVER_RELEASE_RESERVE(STATUS_ID);




--**************************************************************************************
--*****************************FACT_FORECAST_ITEM***************************************
--**************************************************************************************
--This is a transactional fact, the grain is  per MONTH + per Prod Attr Value + per DOOR. 
--Sourced from FORECAST_ITEM.
CREATE TABLE FACT_FORECAST_ITEM(
SMONTH_ID                       NUMBER(6)     NOT NULL,
PROD_ATTR_VALUE_ID              NUMBER(7)     NOT NULL,
STORE_ID                        NUMBER(7)     NOT NULL,
BOM_UNIT                        NUMBER(11)    NOT NULL, 
BOM_DOLLAR                      NUMBER(15,2)  NOT NULL,
BOM_COST                        NUMBER(15,2)  NOT NULL, 
RECEIPT_UNIT                    NUMBER(11)    NOT NULL,
RECEIPT_DOLLAR                  NUMBER(15,2)  NOT NULL,
RECEIPT_COST                    NUMBER(15,2)  NOT NULL,
SALES_UNIT                      NUMBER(11)    NOT NULL,
SALES_DOLLAR                    NUMBER(15,2)  NOT NULL,
SALES_COST                      NUMBER(15,2)  NOT NULL,
MARKDOWN_DOLLAR                 NUMBER(15,2)  NOT NULL,
GM_DOLLAR                       NUMBER(15,2)  NOT NULL,
MARKDOWN_PROMO                  NUMBER(15,2)  NOT NULL,
MARKDOWN_PERM                   NUMBER(15,2)  NOT NULL
)
PARTITION BY RANGE(SMONTH_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (201301))
COMPRESS FOR OLTP
PARALLEL;

ALTER TABLE FACT_FORECAST_ITEM ADD CONSTRAINT FKFACT_FORECAST_ITEM_MONTH FOREIGN KEY(SMONTH_ID) REFERENCES DIM_DATE_SMONTH(SMONTH_ID);
ALTER TABLE FACT_FORECAST_ITEM ADD CONSTRAINT FKFACT_FORECAST_ITEM_PAV FOREIGN KEY(PROD_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);
ALTER TABLE FACT_FORECAST_ITEM ADD CONSTRAINT FKFACT_FORECAST_ITEM_STORE FOREIGN KEY(STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID);

CREATE BITMAP INDEX BX1FACT_FORECAST_ITEM ON FACT_FORECAST_ITEM(SMONTH_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_FORECAST_ITEM ON FACT_FORECAST_ITEM(PROD_ATTR_VALUE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_FORECAST_ITEM ON FACT_FORECAST_ITEM(STORE_ID) LOCAL PARALLEL;

--**************************************************************************************
--*****************************FACT_FORECAST_LOC_ITEM************************************
--**************************************************************************************
--This is a transactional fact, the grain is  per Prod Attr Value +per LOC +per Month. 
--Sourced from FORECAST_DC_ITEM.
CREATE TABLE FACT_FORECAST_LOC_ITEM(
SMONTH_ID                         NUMBER(7)      NOT NULL,
PROD_ATTR_VALUE_ID               NUMBER(7)      NOT NULL,
STORE_LOC_ID                     NUMBER(7)      NOT NULL,
BOM_RETAIL                       NUMBER(15,2)   NOT NULL,
BOM_UNIT                         NUMBER(11)     NOT NULL,
BOM_COST                         NUMBER(15,2)   NOT NULL,
RECEIPT_RETAIL                   NUMBER(15,2)   NOT NULL,
RECEIPT_UNIT                     NUMBER(11)     NOT NULL,
RECEIPT_COST                     NUMBER(15,2)   NOT NULL,
MARKDOWN_PERM_RETAIL             NUMBER(15,2)   NOT NULL
) PARTITION BY RANGE(SMONTH_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (201301))
COMPRESS FOR OLTP
PARALLEL;

ALTER TABLE FACT_FORECAST_LOC_ITEM ADD CONSTRAINT FKFACT_FORECAST_LOC_ITEM_M FOREIGN KEY(SMONTH_ID) REFERENCES DIM_DATE_SMONTH(SMONTH_ID);
ALTER TABLE FACT_FORECAST_LOC_ITEM ADD CONSTRAINT FKFACT_FORECAST_LOC_ITEM_PAV FOREIGN KEY(PROD_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);
ALTER TABLE FACT_FORECAST_LOC_ITEM ADD CONSTRAINT FKFACT_FORECAST_LOC_ITEM_L FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

CREATE BITMAP INDEX BX1FACT_FORECAST_LOC_ITEM ON FACT_FORECAST_LOC_ITEM(SMONTH_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_FORECAST_LOC_ITEM ON FACT_FORECAST_LOC_ITEM(PROD_ATTR_VALUE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_FORECAST_LOC_ITEM ON FACT_FORECAST_LOC_ITEM(STORE_LOC_ID) LOCAL PARALLEL;



--**************************************************************************************
--*****************************FACT_CATEGORYPLAN_ITEM**********************************
--**************************************************************************************
--This is a transactional fact, the grain is  per Prod Attr Value +per DOOR +per Month. 
--Sourced from CATEGORY_PLAN_ITEM.
CREATE TABLE FACT_CATEGORYPLAN_ITEM(
SMONTH_ID                       NUMBER(7)      NOT NULL,
STORE_ID                       NUMBER(7)      NOT NULL,
PROD_ATTR_VALUE_ID             NUMBER(7)      NOT NULL,
RECEIPT_DOLLAR                 NUMBER(15,2)   NOT NULL,
SALES_DOLLAR                   NUMBER(15,2)   NOT NULL
) PARTITION BY RANGE(SMONTH_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (201301))
COMPRESS FOR OLTP
PARALLEL;

ALTER TABLE FACT_CATEGORYPLAN_ITEM ADD CONSTRAINT FKFACT_CATEGORYPLAN_ITEM_M FOREIGN KEY(SMONTH_ID) REFERENCES DIM_DATE_SMONTH(SMONTH_ID);
ALTER TABLE FACT_CATEGORYPLAN_ITEM ADD CONSTRAINT FKFACT_CATEGORYPLAN_ITEM_D FOREIGN KEY(STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID);
ALTER TABLE FACT_CATEGORYPLAN_ITEM ADD CONSTRAINT FKFACT_CATEGORYPLAN_ITEM_V FOREIGN KEY(PROD_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);

CREATE BITMAP INDEX BX1FACT_CATEGORYPLAN_ITEM ON FACT_CATEGORYPLAN_ITEM(SMONTH_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_CATEGORYPLAN_ITEM ON FACT_CATEGORYPLAN_ITEM(STORE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_CATEGORYPLAN_ITEM ON FACT_CATEGORYPLAN_ITEM(PROD_ATTR_VALUE_ID) LOCAL PARALLEL;




--**************************************************************************************
--*****************************FACT_BUDGET_RECAP****************************************
--**************************************************************************************
--This is a transactional fact, the grain is  per Prod Attr Value +per DOOR +per Month. 
--Sourced from CMM_BUDGET_RECAP.
CREATE TABLE FACT_BUDGET_RECAP(
SMONTH_ID                       NUMBER(7)      NOT NULL,
STORE_ID                       NUMBER(7)      NOT NULL,
PROD_ATTR_VALUE_ID             NUMBER(7)      NOT NULL,
BUDGET_RETAIL                  NUMBER(15,2)   NOT NULL,
BUDGET_COST                    NUMBER(15,2)   NOT NULL,
BUDGET_UNIT                    NUMBER(11)     NOT NULL,
STOO_RETAIL                    NUMBER(15,2)   NOT NULL,
STOO_COST                      NUMBER(15,2)   NOT NULL,
STOO_UNIT                      NUMBER(11)     NOT NULL
) PARTITION BY RANGE(SMONTH_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (201301))
COMPRESS FOR OLTP
PARALLEL;

ALTER TABLE FACT_BUDGET_RECAP ADD CONSTRAINT FKFACT_BUDGET_RECAP_M FOREIGN KEY(SMONTH_ID) REFERENCES DIM_DATE_SMONTH(SMONTH_ID);
ALTER TABLE FACT_BUDGET_RECAP ADD CONSTRAINT FKFACT_BUDGET_RECAP_D FOREIGN KEY(STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID);
ALTER TABLE FACT_BUDGET_RECAP ADD CONSTRAINT FKFACT_BUDGET_RECAP_V FOREIGN KEY(PROD_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);

CREATE BITMAP INDEX BX1FACT_BUDGET_RECAP ON FACT_BUDGET_RECAP(SMONTH_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_BUDGET_RECAP ON FACT_BUDGET_RECAP(STORE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_BUDGET_RECAP ON FACT_BUDGET_RECAP(PROD_ATTR_VALUE_ID) LOCAL PARALLEL;


--**************************************************************************************
--**************************************************************************************
--*******************************SEQUENCE***********************************************
--**************************************************************************************
--**************************************************************************************
CREATE SEQUENCE SEQ_DEPT
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_VENDOR
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_STYLE
START WITH 1
INCREMENT BY 1
CACHE 20;


CREATE SEQUENCE SEQ_STYLE_COLOR
START WITH 1
INCREMENT BY 1
CACHE 20;



CREATE SEQUENCE SEQ_STYLE_COLOR_SIZE
START WITH 1
INCREMENT BY 1
CACHE 20;


CREATE SEQUENCE SEQ_YEAR_SEASON
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_PROD_ATTR
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_PROD_ATTR_VALUE
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_YEARSEASON_ATTR
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_YEARSEASON_ATTR_VALUE
START WITH 1
INCREMENT BY 1
CACHE 20;



CREATE SEQUENCE SEQ_STORE
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_LOC_ATTR
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_LOC_ATTR_VALUE
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_SALES_STYLE
START WITH 1
INCREMENT BY 1
CACHE 20;



CREATE SEQUENCE SEQ_GP_GP
START WITH 1
INCREMENT BY 1
CACHE 20;


CREATE SEQUENCE SEQ_GP_SIZE
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_STYLE_COLOR_SIZE_GP
START WITH 1
INCREMENT BY 1
CACHE 20;


CREATE SEQUENCE SEQ_STYLE_YEAR_SEASON
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_ASN
START WITH 1
INCREMENT BY 1
CACHE 20;



CREATE SEQUENCE SEQ_PO
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_PO_ALLOCATE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;


CREATE SEQUENCE SEQ_PO_RELEASE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_ASN_ALLOCATE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;


CREATE SEQUENCE SEQ_ASN_RELEASE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_RECEIVER_ALLOCATE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_RECEIVER_RELEASE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_RECEIVER
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_UPLOAD
START WITH 1
INCREMENT BY 1
NOCACHE;


CREATE SEQUENCE SEQ_ERROR
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_COMMON
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;


CREATE SEQUENCE SEQ_SIZE_RANGE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_SIZE_ITEM
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;



CREATE SEQUENCE SEQ_CRITERIA_GROUP
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;



CREATE SEQUENCE SEQ_CRITERIA_ITEM
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;



CREATE SEQUENCE SEQ_STORE_LOC
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

--**************************************************************************************
--**************************************************************************************
--*******************************Views**************************************************
--**************************************************************************************
--**************************************************************************************
CREATE OR REPLACE VIEW V_DIM_TIME_CALENDAR_YMD
AS
SELECT D.DATE_ID        DATE_ID,
       D.DAY_DATE       DAY_DATE,
       D.DAY_DESC       DAY_DESC,
       D.CWEEK_ID       CWEEK_ID,
       D.IWEEK_ID       IWEEK_ID,
       D.MONTH_ID       MONTH_ID,
       D.DAY_OF_CWEEK   DAY_OF_CWEEK,
       D.DAY_OF_IWEEK   DAY_OF_IWEEK,
       D.DAY_OF_MONTH   DAY_OF_MONTH,
       D.DAY_OF_CYEAR   DAY_OF_CYEAR,
       D.DAY_OF_IYEAR   DAY_OF_IYEAR,
       D.START_DATE     START_DATE,
       D.END_DATE       END_DATE,
       D.TIME_SPAN      TIME_SPAN,
       D.DAY_NUM        DAY_NUM,
       M.MONTH_ID       M_MONTH_ID,
       M.MONTH_DESC     M_MONTH_DESC,
       M.CYEAR_ID       M_CYEAR_ID,
       M.MONTH_OF_CYEAR M_MONTH_OF_CYEAR,
       M.MONTH_NAME     M_MONTH_NAME,
       M.START_DATE     M_START_DATE,
       M.END_DATE       M_END_DATE,
       M.TIME_SPAN      M_TIME_SPAN,
       M.MONTH_NUM      M_MONTH_NUM,
       CY.CYEAR_ID      CY_CYEAR_ID,
       CY.CYEAR_DESC    CY_CYEAR_DESC,
       CY.START_DATE    CY_START_DATE,
       CY.END_DATE      CY_END_DATE,
       CY.TIME_SPAN     CY_TIME_SPAN,
       CY.CYEAR_NUM     CY_CYEAR_NUM
  FROM DIM_DATE_DAY D
 INNER JOIN DIM_DATE_MONTH M
    ON D.MONTH_ID = M.MONTH_ID
 INNER JOIN DIM_DATE_CYEAR CY
    ON M.CYEAR_ID = CY.CYEAR_ID;


CREATE OR REPLACE VIEW V_DIM_TIME_CALENDAR_YM
AS
SELECT 
       M.MONTH_ID       MONTH_ID,
       M.MONTH_DESC     MONTH_DESC,
       M.CYEAR_ID       CYEAR_ID,
       M.MONTH_OF_CYEAR MONTH_OF_CYEAR,
       M.MONTH_NAME     MONTH_NAME,
       M.START_DATE     START_DATE,
       M.END_DATE       END_DATE,
       M.TIME_SPAN      TIME_SPAN,
       M.MONTH_NUM      MONTH_NUM,
       CY.CYEAR_ID      CY_CYEAR_ID,
       CY.CYEAR_DESC    CY_CYEAR_DESC,
       CY.START_DATE    CY_START_DATE,
       CY.END_DATE      CY_END_DATE,
       CY.TIME_SPAN     CY_TIME_SPAN,
       CY.CYEAR_NUM     CY_CYEAR_NUM
  FROM DIM_DATE_MONTH M
 INNER JOIN DIM_DATE_CYEAR CY
    ON M.CYEAR_ID = CY.CYEAR_ID;
    
    
CREATE OR REPLACE VIEW V_DIM_TIME_CALENDAR_YWD
AS
SELECT D.DATE_ID         DATE_ID,
       D.DAY_DATE        DAY_DATE,
       D.DAY_DESC        DAY_DESC,
       D.CWEEK_ID        CWEEK_ID,
       D.IWEEK_ID        IWEEK_ID,
       D.MONTH_ID        MONTH_ID,
       D.DAY_OF_CWEEK    DAY_OF_CWEEK,
       D.DAY_OF_IWEEK    DAY_OF_IWEEK,
       D.DAY_OF_MONTH    DAY_OF_MONTH,
       D.DAY_OF_CYEAR    DAY_OF_CYEAR,
       D.DAY_OF_IYEAR    DAY_OF_IYEAR,
       D.START_DATE      START_DATE,
       D.END_DATE        END_DATE,
       D.TIME_SPAN       TIME_SPAN,
       D.DAY_NUM         DAY_NUM,
       CW.CWEEK_ID       CW_CWEEK_ID,
       CW.CWEEK_DESC     CW_CWEEK_DESC,
       CW.CYEAR_ID       CW_CYEAR_ID,
       CW.CWEEK_OF_CYEAR CW_CWEEK_OF_CYEAR,
       CW.START_DATE     CW_START_DATE,
       CW.END_DATE       CW_END_DATE,
       CW.TIME_SPAN      CW_TIME_SPAN,
       CW.CWEEK_NUM      CW_CWEEK_NUM,
       CY.CYEAR_ID       CY_CYEAR_ID,
       CY.CYEAR_DESC     CY_CYEAR_DESC,
       CY.START_DATE     CY_START_DATE,
       CY.END_DATE       CY_END_DATE,
       CY.TIME_SPAN      CY_TIME_SPAN,
       CY.CYEAR_NUM      CY_CYEAR_NUM
  FROM DIM_DATE_DAY D
 INNER JOIN DIM_DATE_CWEEK CW
    ON D.CWEEK_ID = CW.CWEEK_ID
 INNER JOIN DIM_DATE_CYEAR CY
    ON CW.CYEAR_ID = CY.CYEAR_ID;


CREATE OR REPLACE VIEW V_DIM_TIME_CALENDAR_YW
AS
SELECT 
       CW.CWEEK_ID       CWEEK_ID,
       CW.CWEEK_DESC     CWEEK_DESC,
       CW.CYEAR_ID       CYEAR_ID,
       CW.CWEEK_OF_CYEAR CWEEK_OF_CYEAR,
       CW.START_DATE     START_DATE,
       CW.END_DATE       END_DATE,
       CW.TIME_SPAN      TIME_SPAN,
       CW.CWEEK_NUM      CWEEK_NUM,
       CY.CYEAR_ID       CY_CYEAR_ID,
       CY.CYEAR_DESC     CY_CYEAR_DESC,
       CY.START_DATE     CY_START_DATE,
       CY.END_DATE       CY_END_DATE,
       CY.TIME_SPAN      CY_TIME_SPAN,
       CY.CYEAR_NUM      CY_CYEAR_NUM
  FROM DIM_DATE_CWEEK CW
 INNER JOIN DIM_DATE_CYEAR CY
    ON CW.CYEAR_ID = CY.CYEAR_ID;


CREATE OR REPLACE VIEW V_DIM_TIME_ISO_YWD
AS
SELECT D.DATE_ID         DATE_ID,
       D.DAY_DATE        DAY_DATE,
       D.DAY_DESC        DAY_DESC,
       D.CWEEK_ID        CWEEK_ID,
       D.IWEEK_ID        IWEEK_ID,
       D.MONTH_ID        MONTH_ID,
       D.DAY_OF_CWEEK    DAY_OF_CWEEK,
       D.DAY_OF_IWEEK    DAY_OF_IWEEK,
       D.DAY_OF_MONTH    DAY_OF_MONTH,
       D.DAY_OF_CYEAR    DAY_OF_CYEAR,
       D.DAY_OF_IYEAR    DAY_OF_IYEAR,
       D.START_DATE      START_DATE,
       D.END_DATE        END_DATE,
       D.TIME_SPAN       TIME_SPAN,
       D.DAY_NUM         DAY_NUM,
       IW.IWEEK_ID       IW_IWEEK_ID,
       IW.IWEEK_DESC     IW_IWEEK_DESC,
       IW.IWEEK_OF_IYEAR IW_IWEEK_OF_IYEAR,
       IW.IYEAR_ID       IW_IYEAR_ID,
       IW.START_DATE     IW_START_DATE,
       IW.END_DATE       IW_END_DATE,
       IW.TIME_SPAN      IW_TIME_SPAN,
       IW.IWEEK_NUM      IW_IWEEK_NUM,
       IY.IYEAR_ID       IY_IYEAR_ID,
       IY.IYEAR_DESC     IY_IYEAR_DESC,
       IY.START_DATE     IY_START_DATE,
       IY.END_DATE       IY_END_DATE,
       IY.TIME_SPAN      IY_TIME_SPAN,
       IY.IYEAR_NUM      IY_IYEAR_NUM
  FROM DIM_DATE_DAY D
 INNER JOIN DIM_DATE_IWEEK IW
    ON D.IWEEK_ID = IW.IWEEK_ID
 INNER JOIN DIM_DATE_IYEAR IY
    ON IW.IYEAR_ID = IY.IYEAR_ID;

CREATE OR REPLACE VIEW V_DIM_TIME_ISO_YW
AS
SELECT 
       IW.IWEEK_ID       IWEEK_ID,
       IW.IWEEK_DESC     IWEEK_DESC,
       IW.IWEEK_OF_IYEAR IWEEK_OF_IYEAR,
       IW.IYEAR_ID       IYEAR_ID,
       IW.START_DATE     START_DATE,
       IW.END_DATE       END_DATE,
       IW.TIME_SPAN      TIME_SPAN,
       IW.IWEEK_NUM      IWEEK_NUM,
       IY.IYEAR_ID       IY_IYEAR_ID,
       IY.IYEAR_DESC     IY_IYEAR_DESC,
       IY.START_DATE     IY_START_DATE,
       IY.END_DATE       IY_END_DATE,
       IY.TIME_SPAN      IY_TIME_SPAN,
       IY.IYEAR_NUM      IY_IYEAR_NUM
  FROM DIM_DATE_IWEEK IW
 INNER JOIN DIM_DATE_IYEAR IY
    ON IW.IYEAR_ID = IY.IYEAR_ID;




--v_dim_style_primary_size
CREATE OR REPLACE VIEW V_DIM_STYLE_PRIMARY_SIZE AS
SELECT D.DEPT_ID            D_DEPT_ID,
       D.SOURCE_BUSKEY      D_SOURCE_BUSKEY,
       D.TARGET_BUSKEY      D_TARGET_BUSKEY,
       D.DEPT_NUM           D_DEPT_NUM,
       D.DEPT               D_DEPT,
       D.DIVISION           D_DIVISION,
       D.CORPORATE_DIVISION D_CORPORATE_DIVISION,
       D.ORI_DEPT_ID        D_ORI_DEPT_ID,
       V.VENDOR_ID               V_VENDOR_ID,
       V.SOURCE_BUSKEY           V_SOURCE_BUSKEY,
       V.NAME                    V_NAME,
       V.VENDOR_DIVISION         V_VENDOR_DIVISION,
       V.VENDOR_DEPT             V_VENDOR_DEPT,
       V.VENDOR_PRODUCT_CATEGORY V_VENDOR_PRODUCT_CATEGORY,
       V.ORI_MIC_ID              V_ORI_MIC_ID,
       V.MIC_CODE                V_MIC_CODE,
       V.MIC_DESC                V_MIC_DESC,
       V.PO_DIRECTION            V_PO_DIRECTION,
       V.VENDOR_REF_NUMBER       V_VENDOR_REF_NUMBER,
       V.ORI_VENDOR_COMPANY_ID   V_ORI_VENDOR_COMPANY_ID,
       V.TARGET_BUSKEY           V_TARGET_BUSKEY,
       S.STYLE_ID                S_STYLE_ID,
       S.SOURCE_BUSKEY           S_SOURCE_BUSKEY,
       S.TARGET_BUSKEY           S_TARGET_BUSKEY,
       S.STYLE_NUMBER            S_STYLE_NUMBER,
       S.DESCRIPTION             S_DESCRIPTION,
       S.DEPT_ID                 S_DEPT_ID,
       S.VENDOR_NAME             S_VENDOR_NAME,
       S.SIZE_RANGE              S_SIZE_RANGE,
       S.DEPT_TYPE               S_DEPT_TYPE,
       S.DIVISION_TYPE           S_DIVISION_TYPE,
       S.CLASS_CODE              S_CLASS_CODE,
       S.CLASS                   S_CLASS,
       S.PRODUCT_CATEGORY        S_PRODUCT_CATEGORY,
       S.CATEGORY                S_CATEGORY,
       S.PRODUCTION_TYPE         S_PRODUCTION_TYPE,
       S.FIBER_CONTENT           S_FIBER_CONTENT,
       S.FABRICATION             S_FABRICATION,
       S.PRODUCT_GROUP           S_PRODUCT_GROUP,
       S.RANGE_CODE              S_RANGE_CODE,
       S.COLLAR                  S_COLLAR,
       S.SLEEVE                  S_SLEEVE,
       S.LABEL_CODE              S_LABEL_CODE,
       S.TERM                    S_TERM,
       S.PRODUCT_CATEGORY_CODE   S_PRODUCT_CATEGORY_CODE,
       S.SEASON_CODE             S_SEASON_CODE,
       S.PRODUCT_GROUP_CODE      S_PRODUCT_GROUP_CODE,
       S.STYLE_REF_NUMBER        S_STYLE_REF_NUMBER,
       S.STYLE_NAME              S_STYLE_NAME,
       S.SUB_CLASS               S_SUB_CLASS,
       S.MINOR_CLASS             S_MINOR_CLASS,
       S.HANG_FOLD               S_HANG_FOLD,
       S.YIELD                   S_YIELD,
       S.DISCONTINUE_DATE        S_DISCONTINUE_DATE,
       S.CHANGE_DATE             S_CHANGE_DATE,
       S.REPLENISHMENT_IND       S_REPLENISHMENT_IND,
       S.ORI_STYLE_ID            S_ORI_STYLE_ID,
       S.ORI_COMPANY_ID          S_ORI_COMPANY_ID,
       S.ORI_BUYER_CLASS_ID      S_ORI_BUYER_CLASS_ID,
       S.ORI_BUYER_SUBCLASS_ID   S_ORI_BUYER_SUBCLASS_ID,
       S.ORI_MINOR_CLASS_ID      S_ORI_MINOR_CLASS_ID,
       S.ORI_PRODUCTION_TYPE_ID  S_ORI_PRODUCTION_TYPE_ID,
       S.LOW_COST                S_LOW_COST,
       S.LOW_RETAIL              S_LOW_RETAIL,
       S.STANDARD_COST           S_STANDARD_COST,
       S.VENDOR_REF_NUMBER       S_VENDOR_REF_NUMBER,
       S.STATUS                  S_STATUS,
       S.ORI_BUYER_COMPANY_ID    S_ORI_BUYER_COMPANY_ID,
       SC.STYLE_COLOR_ID         SC_STYLE_COLOR_ID,
       SC.SOURCE_BUSKEY          SC_SOURCE_BUSKEY,
       SC.TARGET_BUSKEY          SC_TARGET_BUSKEY,
       SC.STYLE_ID               SC_STYLE_ID,
       SC.COLOR_NAME             SC_COLOR_NAME,
       SC.COLOR_CODE             SC_COLOR_CODE,
       SC.VENDOR_COLOR_CODE      SC_VENDOR_COLOR_CODE,
       SC.COLOR_FAMILY           SC_COLOR_FAMILY,
       SC.SHORT_COLOR_NAME       SC_SHORT_COLOR_NAME,
       SC.COLOR_GROUP            SC_COLOR_GROUP,
       SC.PATTERN                SC_PATTERN,
       SC.ACCOUNT_EXCLUSIVE      SC_ACCOUNT_EXCLUSIVE,
       SC.START_SHIP_DATE        SC_START_SHIP_DATE,
       SC.PRODUCT_TEAM           SC_PRODUCT_TEAM,
       SC.KEY_ITEM_INDICATOR     SC_KEY_ITEM_INDICATOR,
       SC.PRODUCT_STOP_DATE      SC_PRODUCT_STOP_DATE,
       SC.OUTLET_STYLE_INDICATOR SC_OUTLET_STYLE_INDICATOR,
       SC.MULTI_CHANNEL_IND      SC_MULTI_CHANNEL_IND,
       SC.ORI_STYLE_COLOR_ID     SC_ORI_STYLE_COLOR_ID,
       SCS.STYLE_COLOR_SIZE_ID   STYLE_COLOR_SIZE_ID,
       SCS.SOURCE_BUSKEY         SOURCE_BUSKEY,
       SCS.TARGET_BUSKEY         TARGET_BUSKEY,
       SCS.STYLE_COLOR_ID        STYLE_COLOR_ID,
       SCS.SIZE_CODE             SIZE_CODE,
       SR.SIZE_RANGE_ID          SR_SIZE_RANGE_ID, 
       SR.SOURCE_BUSKEY          SR_SOURCE_BUSKEY, 
       SR.DEPT_ID                SR_DEPT_ID, 
       SR.NAME                   SR_NAME, 
       SI.SIZE_NAME1             SI_SIZE_NAME1,
       SI.SIZE_NAME2             SI_SIZE_NAME2,
       SI.SIZE_SEQ1              SI_SIZE_SEQ1,
       SI.SIZE_SEQ2              SI_SIZE_SEQ2,
       SI.CORE_SIZE_INDICATOR    SI_CORE_SIZE_INDICATOR,
       SCS.UPC                   UPC,
       SCS.ARTICLE_NUMBER        ARTICLE_NUMBER,
       SCS.ORI_STYLE_SIZE_ID     ORI_STYLE_SIZE_ID
  FROM DIM_DEPT D
 INNER JOIN DIM_STYLE S
    ON D.DEPT_ID = S.DEPT_ID
 INNER JOIN DIM_VENDOR V
    ON S.VENDOR_ID = V.VENDOR_ID
 INNER JOIN DIM_STYLE_COLOR SC
    ON S.STYLE_ID = SC.STYLE_ID
 INNER JOIN DIM_STYLE_COLOR_SIZE SCS
    ON SC.STYLE_COLOR_ID = SCS.STYLE_COLOR_ID
 INNER JOIN DIM_SIZE_ITEM SI
    ON SCS.SIZE_ITEM_ID = SI.SIZE_ITEM_ID
 INNER JOIN DIM_SIZE_RANGE SR
    ON SI.SIZE_RANGE_ID=SR.SIZE_RANGE_ID;


CREATE OR REPLACE VIEW V_DIM_STYLE_PRIMARY_GP AS
SELECT D.DEPT_ID            D_DEPT_ID,
       D.SOURCE_BUSKEY      D_SOURCE_BUSKEY,
       D.TARGET_BUSKEY      D_TARGET_BUSKEY,
       D.DEPT_NUM           D_DEPT_NUM,
       D.DEPT               D_DEPT,
       D.DIVISION           D_DIVISION,
       D.CORPORATE_DIVISION D_CORPORATE_DIVISION,
       D.ORI_DEPT_ID        D_ORI_DEPT_ID,
       V.VENDOR_ID               V_VENDOR_ID,
       V.SOURCE_BUSKEY           V_SOURCE_BUSKEY,
       V.NAME                    V_NAME,
       V.VENDOR_DIVISION         V_VENDOR_DIVISION,
       V.VENDOR_DEPT             V_VENDOR_DEPT,
       V.VENDOR_PRODUCT_CATEGORY V_VENDOR_PRODUCT_CATEGORY,
       V.ORI_MIC_ID              V_ORI_MIC_ID,
       V.MIC_CODE                V_MIC_CODE,
       V.MIC_DESC                V_MIC_DESC,
       V.PO_DIRECTION            V_PO_DIRECTION,
       V.VENDOR_REF_NUMBER       V_VENDOR_REF_NUMBER,
       V.ORI_VENDOR_COMPANY_ID   V_ORI_VENDOR_COMPANY_ID,
       V.TARGET_BUSKEY           V_TARGET_BUSKEY,
       S.STYLE_ID                  S_STYLE_ID,
       S.SOURCE_BUSKEY             S_SOURCE_BUSKEY,
       S.TARGET_BUSKEY             S_TARGET_BUSKEY,
       S.STYLE_NUMBER              S_STYLE_NUMBER,
       S.DESCRIPTION               S_DESCRIPTION,       
       S.DEPT_ID                   S_DEPT_ID,
       S.VENDOR_NAME               S_VENDOR_NAME,
       S.SIZE_RANGE                S_SIZE_RANGE,
       S.DEPT_TYPE                 S_DEPT_TYPE,
       S.DIVISION_TYPE             S_DIVISION_TYPE,
       S.CLASS_CODE                S_CLASS_CODE,
       S.CLASS                     S_CLASS,
       S.PRODUCT_CATEGORY          S_PRODUCT_CATEGORY,
       S.CATEGORY                  S_CATEGORY,
       S.PRODUCTION_TYPE           S_PRODUCTION_TYPE,
       S.FIBER_CONTENT             S_FIBER_CONTENT,
       S.FABRICATION               S_FABRICATION,
       S.PRODUCT_GROUP             S_PRODUCT_GROUP,
       S.RANGE_CODE                S_RANGE_CODE,
       S.COLLAR                    S_COLLAR,
       S.SLEEVE                    S_SLEEVE,
       S.LABEL_CODE                S_LABEL_CODE,
       S.TERM                      S_TERM,
       S.PRODUCT_CATEGORY_CODE     S_PRODUCT_CATEGORY_CODE,
       S.SEASON_CODE               S_SEASON_CODE,
       S.PRODUCT_GROUP_CODE        S_PRODUCT_GROUP_CODE,
       S.STYLE_REF_NUMBER          S_STYLE_REF_NUMBER,
       S.STYLE_NAME                S_STYLE_NAME,
       S.SUB_CLASS                 S_SUB_CLASS,
       S.MINOR_CLASS               S_MINOR_CLASS,
       S.HANG_FOLD                 S_HANG_FOLD,
       S.YIELD                     S_YIELD,
       S.DISCONTINUE_DATE          S_DISCONTINUE_DATE,
       S.CHANGE_DATE               S_CHANGE_DATE,
       S.REPLENISHMENT_IND         S_REPLENISHMENT_IND,
       S.ORI_STYLE_ID              S_ORI_STYLE_ID,
       S.ORI_COMPANY_ID            S_ORI_COMPANY_ID,
       S.ORI_BUYER_CLASS_ID        S_ORI_BUYER_CLASS_ID,
       S.ORI_BUYER_SUBCLASS_ID     S_ORI_BUYER_SUBCLASS_ID,
       S.ORI_MINOR_CLASS_ID        S_ORI_MINOR_CLASS_ID,
       S.ORI_PRODUCTION_TYPE_ID    S_ORI_PRODUCTION_TYPE_ID,
       S.LOW_COST                  S_LOW_COST,
       S.LOW_RETAIL                S_LOW_RETAIL,
       S.STANDARD_COST             S_STANDARD_COST,
       S.VENDOR_REF_NUMBER         S_VENDOR_REF_NUMBER,
       S.STATUS                    S_STATUS,
       S.ORI_BUYER_COMPANY_ID      S_ORI_BUYER_COMPANY_ID,
       SC.STYLE_COLOR_ID           SC_STYLE_COLOR_ID,
       SC.SOURCE_BUSKEY            SC_SOURCE_BUSKEY,
       SC.TARGET_BUSKEY            SC_TARGET_BUSKEY,
       SC.STYLE_ID                 SC_STYLE_ID,
       SC.COLOR_NAME               SC_COLOR_NAME,
       SC.COLOR_CODE               SC_COLOR_CODE,
       SC.VENDOR_COLOR_CODE        SC_VENDOR_COLOR_CODE,
       SC.COLOR_FAMILY             SC_COLOR_FAMILY,
       SC.SHORT_COLOR_NAME         SC_SHORT_COLOR_NAME,
       SC.COLOR_GROUP              SC_COLOR_GROUP,
       SC.PATTERN                  SC_PATTERN,
       SC.ACCOUNT_EXCLUSIVE        SC_ACCOUNT_EXCLUSIVE,
       SC.START_SHIP_DATE          SC_START_SHIP_DATE,
       SC.PRODUCT_TEAM             SC_PRODUCT_TEAM,
       SC.KEY_ITEM_INDICATOR       SC_KEY_ITEM_INDICATOR,
       SC.PRODUCT_STOP_DATE        SC_PRODUCT_STOP_DATE,
       SC.OUTLET_STYLE_INDICATOR   SC_OUTLET_STYLE_INDICATOR,
       SC.MULTI_CHANNEL_IND        SC_MULTI_CHANNEL_IND,
       SC.ORI_STYLE_COLOR_ID       SC_ORI_STYLE_COLOR_ID,
       SCS.STYLE_COLOR_SIZE_ID     SCS_STYLE_COLOR_SIZE_ID,
       SCS.SOURCE_BUSKEY           SCS_SOURCE_BUSKEY,
       SCS.TARGET_BUSKEY           SCS_TARGET_BUSKEY,
       SCS.STYLE_COLOR_ID          SCS_STYLE_COLOR_ID,
       SCS.SIZE_CODE               SCS_SIZE_CODE,
       SR.SIZE_RANGE_ID            SR_SIZE_RANGE_ID, 
       SR.SOURCE_BUSKEY            SR_SOURCE_BUSKEY, 
       SR.DEPT_ID                  SR_DEPT_ID, 
       SR.NAME                     SR_NAME,       
       SI.SIZE_NAME1               SI_SIZE_NAME1,
       SI.SIZE_NAME2               SI_SIZE_NAME2,
       SI.SIZE_SEQ1                SI_SIZE_SEQ1,
       SI.SIZE_SEQ2                SI_SIZE_SEQ2,
       SI.CORE_SIZE_INDICATOR      SI_CORE_SIZE_INDICATOR,
       SCS.UPC                     SCS_UPC,
       SCS.ARTICLE_NUMBER          SCS_ARTICLE_NUMBER,
       SCS.ORI_STYLE_SIZE_ID       SCS_ORI_STYLE_SIZE_ID,
       SCSG.STYLE_COLOR_SIZE_GP_ID STYLE_COLOR_SIZE_GP_ID,
       SCSG.SOURCE_BUSKEY          SOURCE_BUSKEY,
       SCSG.TARGET_BUSKEY          TARGET_BUSKEY,
       SCSG.GP_SIZE_ID             GP_SIZE_ID,
       SCSG.STYLE_COLOR_SIZE_ID    STYLE_COLOR_SIZE_ID,
       SCSG.PREPACK_CODE           PREPACK_CODE,
       SCSG.PREPACK_TYPE           PREPACK_TYPE,
       GS.GP_SIZE_ID               GS_GP_SIZE_ID,
       GS.SOURCE_BUSKEY            GS_SOURCE_BUSKEY,
       GS.GP_GP_ID                 GS_GP_GP_ID,
       GS.SIZE_CODE                GS_SIZE_CODE,
       GS.RATIO                    GS_RATIO,
       G.GP_GP_ID                  G_GP_GP_ID,
       G.SOURCE_BUSKEY             G_SOURCE_BUSKEY,
       G.NAME                      G_NAME
  FROM DIM_DEPT D
 INNER JOIN DIM_STYLE S
    ON D.DEPT_ID = S.DEPT_ID
 INNER JOIN DIM_VENDOR V
    ON S.VENDOR_ID = V.VENDOR_ID
 INNER JOIN DIM_STYLE_COLOR SC
    ON S.STYLE_ID = SC.STYLE_ID
 INNER JOIN DIM_STYLE_COLOR_SIZE SCS
    ON SC.STYLE_COLOR_ID = SCS.STYLE_COLOR_ID
 INNER JOIN DIM_SIZE_ITEM SI
    ON SCS.SIZE_ITEM_ID = SI.SIZE_ITEM_ID
 INNER JOIN DIM_SIZE_RANGE SR
    ON SI.SIZE_RANGE_ID=SR.SIZE_RANGE_ID    
 INNER JOIN DIM_STYLE_COLOR_SIZE_GP SCSG
    ON SCS.STYLE_COLOR_SIZE_ID = SCSG.STYLE_COLOR_SIZE_ID
 INNER JOIN DIM_GP_SIZE GS
    ON SCSG.GP_SIZE_ID = GS.GP_SIZE_ID
 INNER JOIN DIM_GP_GP G
    ON GS.GP_GP_ID = G.GP_GP_ID;





CREATE OR REPLACE VIEW V_DIM_STYLE_PAV_VALUE
AS
SELECT P.PROD_ATTR_ID        P_PROD_ATTR_ID,
       P.PROD_ATTR_NAME1     P_PROD_ATTR_NAME1,
       P.PROD_ATTR_NAME2     P_PROD_ATTR_NAME2,
       P.PROD_ATTR_NAME3     P_PROD_ATTR_NAME3,
       P.PROD_ATTR_NAME4     P_PROD_ATTR_NAME4,
       P.PROD_ATTR_NAME5     P_PROD_ATTR_NAME5,
       P.PROD_ATTR_NAME6     P_PROD_ATTR_NAME6,
       P.PROD_ATTR_NAME7     P_PROD_ATTR_NAME7,
       P.PROD_ATTR_NAME8     P_PROD_ATTR_NAME8,
       P.PROD_ATTR_NAME9     P_PROD_ATTR_NAME9,
       P.PROD_ATTR_NAME10    P_PROD_ATTR_NAME10,
       P.PROD_ATTR_NAME11    P_PROD_ATTR_NAME11,
       P.PROD_ATTR_NAME12    P_PROD_ATTR_NAME12,
       P.PROD_ATTR_NAME13    P_PROD_ATTR_NAME13,
       P.PROD_ATTR_NAME14    P_PROD_ATTR_NAME14,
       P.PROD_ATTR_NAME15    P_PROD_ATTR_NAME15,
       P.PROD_ATTR_NAME16    P_PROD_ATTR_NAME16,
       P.PROD_ATTR_NAME17    P_PROD_ATTR_NAME17,
       P.PROD_ATTR_NAME18    P_PROD_ATTR_NAME18,
       P.PROD_ATTR_NAME19    P_PROD_ATTR_NAME19,
       P.PROD_ATTR_NAME20    P_PROD_ATTR_NAME20,
       PV.PROD_ATTR_VALUE_ID PROD_ATTR_VALUE_ID,
       PV.PROD_ATTR_ID       PROD_ATTR_ID,
       PV.PROD_ATTR_VALUE1   PROD_ATTR_VALUE1,
       PV.PROD_ATTR_VALUE2   PROD_ATTR_VALUE2,
       PV.PROD_ATTR_VALUE3   PROD_ATTR_VALUE3,
       PV.PROD_ATTR_VALUE4   PROD_ATTR_VALUE4,
       PV.PROD_ATTR_VALUE5   PROD_ATTR_VALUE5,
       PV.PROD_ATTR_VALUE6   PROD_ATTR_VALUE6,
       PV.PROD_ATTR_VALUE7   PROD_ATTR_VALUE7,
       PV.PROD_ATTR_VALUE8   PROD_ATTR_VALUE8,
       PV.PROD_ATTR_VALUE9   PROD_ATTR_VALUE9,
       PV.PROD_ATTR_VALUE10  PROD_ATTR_VALUE10,
       PV.PROD_ATTR_VALUE11  PROD_ATTR_VALUE11,
       PV.PROD_ATTR_VALUE12  PROD_ATTR_VALUE12,
       PV.PROD_ATTR_VALUE13  PROD_ATTR_VALUE13,
       PV.PROD_ATTR_VALUE14  PROD_ATTR_VALUE14,
       PV.PROD_ATTR_VALUE15  PROD_ATTR_VALUE15,
       PV.PROD_ATTR_VALUE16  PROD_ATTR_VALUE16,
       PV.PROD_ATTR_VALUE17  PROD_ATTR_VALUE17,
       PV.PROD_ATTR_VALUE18  PROD_ATTR_VALUE18,
       PV.PROD_ATTR_VALUE19  PROD_ATTR_VALUE19,
       PV.PROD_ATTR_VALUE20  PROD_ATTR_VALUE20
  FROM DIM_PROD_ATTR P
 INNER JOIN DIM_PROD_ATTR_VALUE PV
    ON P.PROD_ATTR_ID = PV.PROD_ATTR_ID;

CREATE OR REPLACE VIEW V_DIM_STYLE_PAV_SIZE
AS
SELECT PV.PROD_ATTR_ID                 PV_PROD_ATTR_ID,
       PV.PROD_ATTR_VALUE_ID           PV_PROD_ATTR_VALUE_ID,
       PV.PROD_ATTR_VALUE1             PV_PROD_ATTR_VALUE1,
       PV.PROD_ATTR_VALUE2             PV_PROD_ATTR_VALUE2,
       PV.PROD_ATTR_VALUE3             PV_PROD_ATTR_VALUE3,
       PV.PROD_ATTR_VALUE4             PV_PROD_ATTR_VALUE4,
       PV.PROD_ATTR_VALUE5             PV_PROD_ATTR_VALUE5,
       PV.PROD_ATTR_VALUE6             PV_PROD_ATTR_VALUE6,
       PV.PROD_ATTR_VALUE7             PV_PROD_ATTR_VALUE7,
       PV.PROD_ATTR_VALUE8             PV_PROD_ATTR_VALUE8,
       PV.PROD_ATTR_VALUE9             PV_PROD_ATTR_VALUE9,
       PV.PROD_ATTR_VALUE10            PV_PROD_ATTR_VALUE10,
       PV.PROD_ATTR_VALUE11            PV_PROD_ATTR_VALUE11,
       PV.PROD_ATTR_VALUE12            PV_PROD_ATTR_VALUE12,
       PV.PROD_ATTR_VALUE13            PV_PROD_ATTR_VALUE13,
       PV.PROD_ATTR_VALUE14            PV_PROD_ATTR_VALUE14,
       PV.PROD_ATTR_VALUE15            PV_PROD_ATTR_VALUE15,
       PV.PROD_ATTR_VALUE16            PV_PROD_ATTR_VALUE16,
       PV.PROD_ATTR_VALUE17            PV_PROD_ATTR_VALUE17,
       PV.PROD_ATTR_VALUE18            PV_PROD_ATTR_VALUE18,
       PV.PROD_ATTR_VALUE19            PV_PROD_ATTR_VALUE19,
       PV.PROD_ATTR_VALUE20            PV_PROD_ATTR_VALUE20,
       PAVR.STYLE_COLOR_SIZE_ID
  FROM DIM_PROD_ATTR_VALUE PV
 INNER JOIN DIM_PROD_ATTR_VAL_REL PAVR
    ON PV.PROD_ATTR_VALUE_ID = PAVR.PROD_ATTR_VALUE_ID;


CREATE OR REPLACE VIEW V_DIM_YEARSEASON_PRIMARY_STYLE
AS
SELECT YS.YEAR_SEASON_ID         YS_YEAR_SEASON_ID,
       YS.SOURCE_BUSKEY          YS_SOURCE_BUSKEY,
       YS.STYLE_YEAR             YS_STYLE_YEAR,
       YS.SEASON_NAME            YS_SEASON_NAME,
       YS.ORI_SEASON_ID          YS_ORI_SEASON_ID,
       RYS.YEAR_SEASON_ID        RYS_YEAR_SEASON_ID,
       RYS.SOURCE_BUSKEY         RYS_SOURCE_BUSKEY,
       RYS.STYLE_YEAR            RYS_STYLE_YEAR,
       RYS.SEASON_NAME           RYS_SEASON_NAME,
       RYS.ORI_SEASON_ID         RYS_ORI_SEASON_ID,
       DSYS.STYLE_YEAR_SEASON_ID,
       DSYS.SOURCE_BUSKEY,
       DSYS.STYLE_COLOR_ID,
       DSYS.SMONTH_ID,
       DSYS.YEAR_SEASON_ID,
       DSYS.REAL_YEAR_SEASON_ID
  FROM DIM_STYLE_YEAR_SEASON DSYS
 INNER JOIN DIM_YEAR_SEASON YS
    ON DSYS.YEAR_SEASON_ID = YS.YEAR_SEASON_ID
 INNER JOIN DIM_YEAR_SEASON RYS
    ON DSYS.REAL_YEAR_SEASON_ID = RYS.YEAR_SEASON_ID;





CREATE OR REPLACE VIEW V_DIM_TIME_7TH_YMWD AS
SELECT D.DATE_ID          DATE_ID,
       D.DAY_DATE         DAY_DATE,
       D.DAY_DESC         DAY_DESC,
       D.CWEEK_ID         CWEEK_ID,
       D.IWEEK_ID         IWEEK_ID,
       D.MONTH_ID         MONTH_ID,
       D.SWEEK_ID         SWEEK_ID,
       D.DAY_OF_CWEEK     DAY_OF_CWEEK,
       D.DAY_OF_IWEEK     DAY_OF_IWEEK,
       D.DAY_OF_MONTH     DAY_OF_MONTH,
       D.DAY_OF_CYEAR     DAY_OF_CYEAR,
       D.DAY_OF_IYEAR     DAY_OF_IYEAR,
       D.DAY_OF_SWEEK     DAY_OF_SWEEK,
       D.DAY_OF_SMONTH    DAY_OF_SMONTH,
       D.DAY_OF_SYEAR     DAY_OF_SYEAR,
       D.START_DATE       START_DATE,
       D.END_DATE         END_DATE,
       D.TIME_SPAN        TIME_SPAN,
       D.DAY_NUM          DAY_NUM,
       SW.SWEEK_ID        SW_SWEEK_ID,
       SW.SWEEK_DESC      SW_SWEEK_DESC,
       SW.SMONTH_ID       SW_SMONTH_ID,
       SW.SWEEK_OF_SMONTH SW_SWEEK_OF_SMONTH,
       SW.SWEEK_OF_SYEAR  SW_SWEEK_OF_SYEAR,
       SW.START_DATE      SW_START_DATE,
       SW.END_DATE        SW_END_DATE,
       SW.TIME_SPAN       SW_TIME_SPAN,
       SW.SWEEK_NUM       SW_SWEEK_NUM,
       SM.SMONTH_ID       SM_SMONTH_ID,
       SM.SMONTH_DESC     SM_SMONTH_DESC,
       SM.SYEAR_ID        SM_SYEAR_ID,
       SM.SMONTH_OF_SYEAR SM_SMONTH_OF_CYEAR,
       SM.SMONTH_NAME     SM_SMONTH_NAME,
       SM.START_DATE      SM_START_DATE,
       SM.END_DATE        SM_END_DATE,
       SM.TIME_SPAN       SM_TIME_SPAN,
       SM.SMONTH_NUM      SM_SMONTH_NUM,
       SY.SYEAR_ID        SY_SYEAR_ID,
       SY.SYEAR_DESC      SY_SYEAR_DESC,
       SY.START_DATE      SY_START_DATE,
       SY.END_DATE        SY_END_DATE,
       SY.TIME_SPAN       SY_TIME_SPAN,
       SY.SYEAR_NUM       SY_SYEAR_NUM
  FROM DIM_DATE_DAY D
 INNER JOIN DIM_DATE_SWEEK SW
    ON D.SWEEK_ID = SW.SWEEK_ID
 INNER JOIN DIM_DATE_SMONTH SM
    ON SW.SMONTH_ID = SM.SMONTH_ID
 INNER JOIN DIM_DATE_SYEAR SY
    ON SM.SYEAR_ID = SY.SYEAR_ID;


CREATE OR REPLACE VIEW V_DIM_TIME_7TH_YMW AS
SELECT 
       SW.SWEEK_ID        SWEEK_ID,
       SW.SWEEK_DESC      SWEEK_DESC,
       SW.SMONTH_ID       SMONTH_ID,
       SW.SWEEK_OF_SMONTH SWEEK_OF_SMONTH,
       SW.SWEEK_OF_SYEAR  SWEEK_OF_SYEAR,
       SW.START_DATE      START_DATE,
       SW.END_DATE        END_DATE,
       SW.TIME_SPAN       TIME_SPAN,
       SW.SWEEK_NUM       SWEEK_NUM,
       SM.SMONTH_ID       SM_SMONTH_ID,
       SM.SMONTH_DESC     SM_SMONTH_DESC,
       SM.SYEAR_ID        SM_SYEAR_ID,
       SM.SMONTH_OF_SYEAR SM_SMONTH_OF_CYEAR,
       SM.SMONTH_NAME     SM_SMONTH_NAME,
       SM.START_DATE      SM_START_DATE,
       SM.END_DATE        SM_END_DATE,
       SM.TIME_SPAN       SM_TIME_SPAN,
       SM.SMONTH_NUM      SM_SMONTH_NUM,
       SY.SYEAR_ID        SY_SYEAR_ID,
       SY.SYEAR_DESC      SY_SYEAR_DESC,
       SY.START_DATE      SY_START_DATE,
       SY.END_DATE        SY_END_DATE,
       SY.TIME_SPAN       SY_TIME_SPAN,
       SY.SYEAR_NUM       SY_SYEAR_NUM
  FROM DIM_DATE_SWEEK SW
 INNER JOIN DIM_DATE_SMONTH SM
    ON SW.SMONTH_ID = SM.SMONTH_ID
 INNER JOIN DIM_DATE_SYEAR SY
    ON SM.SYEAR_ID = SY.SYEAR_ID;


CREATE OR REPLACE VIEW V_DIM_TIME_7TH_YM AS
SELECT 
       SM.SMONTH_ID       SMONTH_ID,
       SM.SMONTH_DESC     SMONTH_DESC,
       SM.SYEAR_ID        SYEAR_ID,
       SM.SMONTH_OF_SYEAR SMONTH_OF_CYEAR,
       SM.SMONTH_NAME     SMONTH_NAME,
       SM.START_DATE      START_DATE,
       SM.END_DATE        END_DATE,
       SM.TIME_SPAN       TIME_SPAN,
       SM.SMONTH_NUM      SMONTH_NUM,
       SY.SYEAR_ID        SY_SYEAR_ID,
       SY.SYEAR_DESC      SY_SYEAR_DESC,
       SY.START_DATE      SY_START_DATE,
       SY.END_DATE        SY_END_DATE,
       SY.TIME_SPAN       SY_TIME_SPAN,
       SY.SYEAR_NUM       SY_SYEAR_NUM
  FROM DIM_DATE_SMONTH SM
 INNER JOIN DIM_DATE_SYEAR SY
    ON SM.SYEAR_ID = SY.SYEAR_ID;    



CREATE OR REPLACE VIEW V_DIM_PROMO_PRIMARY_PROMOTION
AS
SELECT S.SALES_STYLE_ID     S_SALES_STYLE_ID,
       S.SOURCE_BUSKEY      S_SOURCE_BUSKEY,
       S.SALES_STYLE_CODE   S_SALES_STYLE_CODE,
       S.SALES_STYLE_NAME   S_SALES_STYLE_NAME,
       S.ORI_SALES_STYLE_ID S_ORI_SALES_STYLE_ID,
       P.PROMOTION_ID       PROMOTION_ID,
       P.SOURCE_BUSKEY      SOURCE_BUSKEY,
       P.SALES_STYLE_ID     SALES_STYLE_ID,
       P.GROUP_CODE         GROUP_CODE,
       P.GROUP_NAME         GROUP_NAME,
       P.TYPE               TYPE,
       P.CODE               CODE,
       P.NAME               NAME,
       P.START_DATE         START_DATE,
       P.END_DATE           END_DATE,
       P.PROMO_PERCENT      PROMO_PERCENT
  FROM DIM_SALES_STYLE S
 INNER JOIN DIM_PROMOTION P
    ON S.SALES_STYLE_ID = P.SALES_STYLE_ID;



CREATE OR REPLACE VIEW V_DIM_STORE_LAV_VALUE
AS
SELECT L.LOC_ATTR_ID        L_LOC_ATTR_ID,
       L.LOC_ATTR_NAME1     L_LOC_ATTR_NAME1,
       L.LOC_ATTR_NAME2     L_LOC_ATTR_NAME2,
       L.LOC_ATTR_NAME3     L_LOC_ATTR_NAME3,
       L.LOC_ATTR_NAME4     L_LOC_ATTR_NAME4,
       L.LOC_ATTR_NAME5     L_LOC_ATTR_NAME5,
       L.LOC_ATTR_NAME6     L_LOC_ATTR_NAME6,
       L.LOC_ATTR_NAME7     L_LOC_ATTR_NAME7,
       L.LOC_ATTR_NAME8     L_LOC_ATTR_NAME8,
       L.LOC_ATTR_NAME9     L_LOC_ATTR_NAME9,
       L.LOC_ATTR_NAME10    L_LOC_ATTR_NAME10,
       L.LOC_ATTR_NAME11    L_LOC_ATTR_NAME11,
       L.LOC_ATTR_NAME12    L_LOC_ATTR_NAME12,
       L.LOC_ATTR_NAME13    L_LOC_ATTR_NAME13,
       L.LOC_ATTR_NAME14    L_LOC_ATTR_NAME14,
       L.LOC_ATTR_NAME15    L_LOC_ATTR_NAME15,
       L.LOC_ATTR_NAME16    L_LOC_ATTR_NAME16,
       L.LOC_ATTR_NAME17    L_LOC_ATTR_NAME17,
       L.LOC_ATTR_NAME18    L_LOC_ATTR_NAME18,
       L.LOC_ATTR_NAME19    L_LOC_ATTR_NAME19,
       L.LOC_ATTR_NAME20    L_LOC_ATTR_NAME20,
       LV.LOC_ATTR_VALUE_ID,
       LV.LOC_ATTR_ID,
       LV.LOC_ATTR_VALUE1,
       LV.LOC_ATTR_VALUE2,
       LV.LOC_ATTR_VALUE3,
       LV.LOC_ATTR_VALUE4,
       LV.LOC_ATTR_VALUE5,
       LV.LOC_ATTR_VALUE6,
       LV.LOC_ATTR_VALUE7,
       LV.LOC_ATTR_VALUE8,
       LV.LOC_ATTR_VALUE9,
       LV.LOC_ATTR_VALUE10,
       LV.LOC_ATTR_VALUE11,
       LV.LOC_ATTR_VALUE12,
       LV.LOC_ATTR_VALUE13,
       LV.LOC_ATTR_VALUE14,
       LV.LOC_ATTR_VALUE15,
       LV.LOC_ATTR_VALUE16,
       LV.LOC_ATTR_VALUE17,
       LV.LOC_ATTR_VALUE18,
       LV.LOC_ATTR_VALUE19,
       LV.LOC_ATTR_VALUE20
  FROM DIM_LOC_ATTR L
 INNER JOIN DIM_LOC_ATTR_VALUE LV
    ON L.LOC_ATTR_ID = LV.LOC_ATTR_ID;


CREATE OR REPLACE VIEW V_DIM_STORE_PAV_STORE 
AS
SELECT LV.LOC_ATTR_VALUE_ID LV_LOC_ATTR_VALUE_ID,
       LV.LOC_ATTR_ID       LV_LOC_ATTR_ID,
       LV.LOC_ATTR_VALUE1   LV_LOC_ATTR_VALUE1,
       LV.LOC_ATTR_VALUE2   LV_LOC_ATTR_VALUE2,
       LV.LOC_ATTR_VALUE3   LV_LOC_ATTR_VALUE3,
       LV.LOC_ATTR_VALUE4   LV_LOC_ATTR_VALUE4,
       LV.LOC_ATTR_VALUE5   LV_LOC_ATTR_VALUE5,
       LV.LOC_ATTR_VALUE6   LV_LOC_ATTR_VALUE6,
       LV.LOC_ATTR_VALUE7   LV_LOC_ATTR_VALUE7,
       LV.LOC_ATTR_VALUE8   LV_LOC_ATTR_VALUE8,
       LV.LOC_ATTR_VALUE9   LV_LOC_ATTR_VALUE9,
       LV.LOC_ATTR_VALUE10  LV_LOC_ATTR_VALUE10,
       LV.LOC_ATTR_VALUE11  LV_LOC_ATTR_VALUE11,
       LV.LOC_ATTR_VALUE12  LV_LOC_ATTR_VALUE12,
       LV.LOC_ATTR_VALUE13  LV_LOC_ATTR_VALUE13,
       LV.LOC_ATTR_VALUE14  LV_LOC_ATTR_VALUE14,
       LV.LOC_ATTR_VALUE15  LV_LOC_ATTR_VALUE15,
       LV.LOC_ATTR_VALUE16  LV_LOC_ATTR_VALUE16,
       LV.LOC_ATTR_VALUE17  LV_LOC_ATTR_VALUE17,
       LV.LOC_ATTR_VALUE18  LV_LOC_ATTR_VALUE18,
       LV.LOC_ATTR_VALUE19  LV_LOC_ATTR_VALUE19,
       LV.LOC_ATTR_VALUE20  LV_LOC_ATTR_VALUE20,
       LAVR.STORE_ID
  FROM DIM_LOC_ATTR_VALUE LV
 INNER JOIN DIM_LOC_ATTR_VAL_REL LAVR
    ON LV.LOC_ATTR_VALUE_ID = LAVR.LOC_ATTR_VALUE_ID;


CREATE OR REPLACE VIEW V_DIM_PO_PRIMARY_RELEASE 
AS
SELECT PB.PO_BD_ID                     PB_PO_BD_ID,
       PB.SOURCE_BUSKEY                PB_SOURCE_BUSKEY,
       PB.PO_NUMBER                    PB_PO_NUMBER,
       PB.PO_BD_DATE                   PB_PO_BD_DATE,
       PB.PO_BD_NAME                   PB_PO_BD_NAME,
       PB.PROD_CRITERIA_GROUP_ID       PB_PROD_CRITERIA_GROUP_ID,
       PB.LOC_CRITERIA_GROUP_ID        PB_LOC_CRITERIA_GROUP_ID,
       PB.YEARSEASON_CRITERIA_GROUP_ID PB_YS_CRITERIA_GROUP_ID,
       PBR.PO_BD_RELEASE_ID             PBR_PO_BD_RELEASE_ID,
       PBR.SOURCE_BUSKEY                PBR_SOURCE_BUSKEY,
       PBR.PO_BD_ID                     PBR_PO_BD_ID,
       PBR.PO_BD_RELEASE_DATE           PBR_PO_BD_RELEASE_DATE,
       PBR.PO_BD_RELEASE_NAME           PBR_PO_BD_RELEASE_NAME,
       PBR.PROD_CRITERIA_GROUP_ID       PBR_PROD_CRITERIA_GROUP_ID,
       PBR.LOC_CRITERIA_GROUP_ID        PBR_LOC_CRITERIA_GROUP_ID,
       PBR.YEARSEASON_CRITERIA_GROUP_ID PBR_YS_CRITERIA_GROUP_ID,       
       PA.PO_ALLOCATE_ID               PA_PO_ALLOCATE_ID,
       PA.SOURCE_BUSKEY                PA_SOURCE_BUSKEY,
       PA.PO_ALLOCATE_DATE             PA_PO_ALLOCATE_DATE,
       PA.PO_ALLOCATE_NAME             PA_PO_ALLOCATE_NAME,
       PA.PROD_CRITERIA_GROUP_ID       PA_PROD_CRITERIA_GROUP_ID,
       PA.LOC_CRITERIA_GROUP_ID        PA_LOC_CRITERIA_GROUP_ID,
       PA.YEARSEASON_CRITERIA_GROUP_ID PA_YS_CRITERIA_GROUP_ID,
       PA.PO_BD_RELEASE_ID             PA_PO_BD_RELEASE_ID,
       PR.PO_RELEASE_ID,
       PR.SOURCE_BUSKEY,
       PR.PO_ALLOCATE_ID,
       PR.PO_RELEASE_DATE,
       PR.PO_RELEASE_NAME,
       PR.PROD_CRITERIA_GROUP_ID,
       PR.LOC_CRITERIA_GROUP_ID,
       PR.YEARSEASON_CRITERIA_GROUP_ID
  FROM DIM_PO_BD PB
 INNER JOIN DIM_PO_BD_RELEASE PBR
    ON PB.PO_BD_ID = PBR.PO_BD_ID
 INNER JOIN DIM_PO_ALLOCATE PA
    ON PBR.PO_BD_RELEASE_ID = PA.PO_BD_RELEASE_ID
 INNER JOIN DIM_PO_RELEASE PR
    ON PA.PO_ALLOCATE_ID = PR.PO_ALLOCATE_ID;
    


CREATE OR REPLACE VIEW V_DIM_PO_PRIMARY_ALLOCATE
AS
SELECT PB.PO_BD_ID                     PB_PO_BD_ID,
       PB.SOURCE_BUSKEY                PB_SOURCE_BUSKEY,
       PB.PO_NUMBER                    PB_PO_NUMBER,
       PB.PO_BD_DATE                   PB_PO_BD_DATE,
       PB.PO_BD_NAME                   PB_PO_BD_NAME,
       PB.PROD_CRITERIA_GROUP_ID       PB_PROD_CRITERIA_GROUP_ID,
       PB.LOC_CRITERIA_GROUP_ID        PB_LOC_CRITERIA_GROUP_ID,
       PB.YEARSEASON_CRITERIA_GROUP_ID PB_YS_CRITERIA_GROUP_ID,
       PBR.PO_BD_RELEASE_ID             PBR_PO_BD_RELEASE_ID,
       PBR.SOURCE_BUSKEY                PBR_SOURCE_BUSKEY,
       PBR.PO_BD_ID                     PBR_PO_BD_ID,
       PBR.PO_BD_RELEASE_DATE           PBR_PO_BD_RELEASE_DATE,
       PBR.PO_BD_RELEASE_NAME           PBR_PO_BD_RELEASE_NAME,
       PBR.PROD_CRITERIA_GROUP_ID       PBR_PROD_CRITERIA_GROUP_ID,
       PBR.LOC_CRITERIA_GROUP_ID        PBR_LOC_CRITERIA_GROUP_ID,
       PBR.YEARSEASON_CRITERIA_GROUP_ID PBR_YS_CRITERIA_GROUP_ID,
       PA.PO_ALLOCATE_ID,
       PA.SOURCE_BUSKEY,
       PA.PO_ALLOCATE_DATE,
       PA.PO_ALLOCATE_NAME,
       PA.PROD_CRITERIA_GROUP_ID,
       PA.LOC_CRITERIA_GROUP_ID,
       PA.YEARSEASON_CRITERIA_GROUP_ID,
       PA.PO_BD_RELEASE_ID
  FROM DIM_PO_BD PB
 INNER JOIN DIM_PO_BD_RELEASE PBR
    ON PB.PO_BD_ID = PBR.PO_BD_ID
 INNER JOIN DIM_PO_ALLOCATE PA
    ON PBR.PO_BD_RELEASE_ID = PA.PO_BD_RELEASE_ID;
    

CREATE OR REPLACE VIEW V_DIM_PO_PRIMARY_BD_RELEASE
AS
SELECT PB.PO_BD_ID                     PB_PO_BD_ID,
       PB.SOURCE_BUSKEY                PB_SOURCE_BUSKEY,
       PB.PO_NUMBER                    PB_PO_NUMBER,
       PB.PO_BD_DATE                   PB_PO_BD_DATE,
       PB.PO_BD_NAME                   PB_PO_BD_NAME,
       PB.PROD_CRITERIA_GROUP_ID       PB_PROD_CRITERIA_GROUP_ID,
       PB.LOC_CRITERIA_GROUP_ID        PB_LOC_CRITERIA_GROUP_ID,
       PB.YEARSEASON_CRITERIA_GROUP_ID PB_YS_CRITERIA_GROUP_ID,
       PBR.PO_BD_RELEASE_ID,
       PBR.SOURCE_BUSKEY,
       PBR.PO_BD_ID,
       PBR.PO_BD_RELEASE_DATE,
       PBR.PO_BD_RELEASE_NAME,
       PBR.PROD_CRITERIA_GROUP_ID,
       PBR.LOC_CRITERIA_GROUP_ID,
       PBR.YEARSEASON_CRITERIA_GROUP_ID
  FROM DIM_PO_BD PB
 INNER JOIN DIM_PO_BD_RELEASE PBR
    ON PB.PO_BD_ID = PBR.PO_BD_ID;


CREATE OR REPLACE VIEW V_DIM_ASN_PRIMARY_RELEASE 
AS
SELECT PB.ASN_BD_ID                    PB_ASN_BD_ID,
       PB.SOURCE_BUSKEY                PB_SOURCE_BUSKEY,
       PB.ASN_NUMBER                   PB_ASN_NUMBER,
       PB.ASN_BD_DATE                  PB_ASN_BD_DATE,
       PB.ASN_BD_NAME                  PB_ASN_BD_NAME,
       PB.PROD_CRITERIA_GROUP_ID       PB_PROD_CRITERIA_GROUP_ID,
       PB.LOC_CRITERIA_GROUP_ID        PB_LOC_CRITERIA_GROUP_ID,
       PB.YEARSEASON_CRITERIA_GROUP_ID PB_YS_CRITERIA_GROUP_ID,
       PBR.ASN_BD_RELEASE_ID            PBR_ASN_BD_RELEASE_ID,
       PBR.SOURCE_BUSKEY                PBR_SOURCE_BUSKEY,
       PBR.ASN_BD_ID                    PBR_ASN_BD_ID,
       PBR.ASN_BD_RELEASE_DATE          PBR_ASN_BD_RELEASE_DATE,
       PBR.ASN_BD_RELEASE_NAME          PBR_ASN_BD_RELEASE_NAME,
       PBR.PROD_CRITERIA_GROUP_ID       PBR_PROD_CRITERIA_GROUP_ID,
       PBR.LOC_CRITERIA_GROUP_ID        PBR_LOC_CRITERIA_GROUP_ID,
       PBR.YEARSEASON_CRITERIA_GROUP_ID PBR_YS_CRITERIA_GROUP_ID,
       PA.ASN_ALLOCATE_ID              PA_ASN_ALLOCATE_ID,
       PA.SOURCE_BUSKEY                PA_SOURCE_BUSKEY,
       PA.ASN_ALLOCATE_DATE            PA_ASN_ALLOCATE_DATE,
       PA.ASN_ALLOCATE_NAME            PA_ASN_ALLOCATE_NAME,
       PA.PROD_CRITERIA_GROUP_ID       PA_PROD_CRITERIA_GROUP_ID,
       PA.LOC_CRITERIA_GROUP_ID        PA_LOC_CRITERIA_GROUP_ID,
       PA.YEARSEASON_CRITERIA_GROUP_ID PA_YS_CRITERIA_GROUP_ID,
       PA.ASN_BD_RELEASE_ID            PA_ASN_BD_RELEASE_ID,
       PR.ASN_RELEASE_ID,
       PR.SOURCE_BUSKEY,
       PR.ASN_ALLOCATE_ID,
       PR.ASN_RELEASE_DATE,
       PR.ASN_RELEASE_NAME,
       PR.PROD_CRITERIA_GROUP_ID,
       PR.LOC_CRITERIA_GROUP_ID,
       PR.YEARSEASON_CRITERIA_GROUP_ID
  FROM DIM_ASN_BD PB
 INNER JOIN DIM_ASN_BD_RELEASE PBR
    ON PB.ASN_BD_ID = PBR.ASN_BD_ID
 INNER JOIN DIM_ASN_ALLOCATE PA
    ON PBR.ASN_BD_RELEASE_ID = PA.ASN_BD_RELEASE_ID
 INNER JOIN DIM_ASN_RELEASE PR
    ON PA.ASN_ALLOCATE_ID = PR.ASN_ALLOCATE_ID;
    


CREATE OR REPLACE VIEW V_DIM_ASN_PRIMARY_ALLOCATE
AS
SELECT PB.ASN_BD_ID                    PB_ASN_BD_ID,
       PB.SOURCE_BUSKEY                PB_SOURCE_BUSKEY,
       PB.ASN_NUMBER                   PB_ASN_NUMBER,
       PB.ASN_BD_DATE                  PB_ASN_BD_DATE,
       PB.ASN_BD_NAME                  PB_ASN_BD_NAME,
       PB.PROD_CRITERIA_GROUP_ID       PB_PROD_CRITERIA_GROUP_ID,
       PB.LOC_CRITERIA_GROUP_ID        PB_LOC_CRITERIA_GROUP_ID,
       PB.YEARSEASON_CRITERIA_GROUP_ID PB_YS_CRITERIA_GROUP_ID,
       PBR.ASN_BD_RELEASE_ID            PBR_ASN_BD_RELEASE_ID,
       PBR.SOURCE_BUSKEY                PBR_SOURCE_BUSKEY,
       PBR.ASN_BD_ID                    PBR_ASN_BD_ID,
       PBR.ASN_BD_RELEASE_DATE          PBR_ASN_BD_RELEASE_DATE,
       PBR.ASN_BD_RELEASE_NAME          PBR_ASN_BD_RELEASE_NAME,
       PBR.PROD_CRITERIA_GROUP_ID       PBR_PROD_CRITERIA_GROUP_ID,
       PBR.LOC_CRITERIA_GROUP_ID        PBR_LOC_CRITERIA_GROUP_ID,
       PBR.YEARSEASON_CRITERIA_GROUP_ID PBR_YS_CRITERIA_GROUP_ID,
       PA.ASN_ALLOCATE_ID,
       PA.SOURCE_BUSKEY,
       PA.ASN_ALLOCATE_DATE,
       PA.ASN_ALLOCATE_NAME,
       PA.PROD_CRITERIA_GROUP_ID,
       PA.LOC_CRITERIA_GROUP_ID,
       PA.YEARSEASON_CRITERIA_GROUP_ID,
       PA.ASN_BD_RELEASE_ID
  FROM DIM_ASN_BD PB
 INNER JOIN DIM_ASN_BD_RELEASE PBR
    ON PB.ASN_BD_ID = PBR.ASN_BD_ID
 INNER JOIN DIM_ASN_ALLOCATE PA
    ON PBR.ASN_BD_RELEASE_ID = PA.ASN_BD_RELEASE_ID;
    

CREATE OR REPLACE VIEW V_DIM_ASN_PRIMARY_BD_RELEASE
AS
SELECT PB.ASN_BD_ID                    PB_ASN_BD_ID,
       PB.SOURCE_BUSKEY                PB_SOURCE_BUSKEY,
       PB.ASN_NUMBER                   PB_ASN_NUMBER,
       PB.ASN_BD_DATE                  PB_ASN_BD_DATE,
       PB.ASN_BD_NAME                  PB_ASN_BD_NAME,
       PB.PROD_CRITERIA_GROUP_ID       PB_PROD_CRITERIA_GROUP_ID,
       PB.LOC_CRITERIA_GROUP_ID        PB_LOC_CRITERIA_GROUP_ID,
       PB.YEARSEASON_CRITERIA_GROUP_ID PB_YS_CRITERIA_GROUP_ID,
       PBR.ASN_BD_RELEASE_ID,
       PBR.SOURCE_BUSKEY,
       PBR.ASN_BD_ID,
       PBR.ASN_BD_RELEASE_DATE,
       PBR.ASN_BD_RELEASE_NAME,
       PBR.PROD_CRITERIA_GROUP_ID,
       PBR.LOC_CRITERIA_GROUP_ID,
       PBR.YEARSEASON_CRITERIA_GROUP_ID
  FROM DIM_ASN_BD PB
 INNER JOIN DIM_ASN_BD_RELEASE PBR
    ON PB.ASN_BD_ID = PBR.ASN_BD_ID;


CREATE OR REPLACE VIEW V_DIM_REC_PRIMARY_RELEASE 
AS
SELECT PB.RECEIVER_BD_ID               PB_RECEIVER_BD_ID,
       PB.SOURCE_BUSKEY                PB_SOURCE_BUSKEY,
       PB.RECEIVER_NUMBER              PB_RECEIVER_NUMBER,
       PB.RECEIVER_BD_DATE             PB_RECEIVER_BD_DATE,
       PB.RECEIVER_BD_NAME             PB_RECEIVER_BD_NAME,
       PB.PROD_CRITERIA_GROUP_ID       PB_PROD_CRITERIA_GROUP_ID,
       PB.LOC_CRITERIA_GROUP_ID        PB_LOC_CRITERIA_GROUP_ID,
       PB.YEARSEASON_CRITERIA_GROUP_ID PB_YS_CRITERIA_GROUP_ID,
       PBR.RECEIVER_BD_RELEASE_ID       PBR_RECEIVER_BD_RELEASE_ID,
       PBR.SOURCE_BUSKEY                PBR_SOURCE_BUSKEY,
       PBR.RECEIVER_BD_ID               PBR_RECEIVER_BD_ID,
       PBR.RECEIVER_BD_RELEASE_DATE     PBR_RECEIVER_BD_RELEASE_DATE,
       PBR.RECEIVER_BD_RELEASE_NAME     PBR_RECEIVER_BD_RELEASE_NAME,
       PBR.PROD_CRITERIA_GROUP_ID       PBR_PROD_CRITERIA_GROUP_ID,
       PBR.LOC_CRITERIA_GROUP_ID        PBR_LOC_CRITERIA_GROUP_ID,
       PBR.YEARSEASON_CRITERIA_GROUP_ID PBR_YS_CRITERIA_GROUP_ID,
       PA.RECEIVER_ALLOCATE_ID         PA_RECEIVER_ALLOCATE_ID,
       PA.SOURCE_BUSKEY                PA_SOURCE_BUSKEY,
       PA.RECEIVER_ALLOCATE_DATE       PA_RECEIVER_ALLOCATE_DATE,
       PA.RECEIVER_ALLOCATE_NAME       PA_RECEIVER_ALLOCATE_NAME,
       PA.PROD_CRITERIA_GROUP_ID       PA_PROD_CRITERIA_GROUP_ID,
       PA.LOC_CRITERIA_GROUP_ID        PA_LOC_CRITERIA_GROUP_ID,
       PA.YEARSEASON_CRITERIA_GROUP_ID PA_YS_CRITERIA_GROUP_ID,
       PA.RECEIVER_BD_RELEASE_ID       PA_RECEIVER_BD_RELEASE_ID,
       PR.RECEIVER_RELEASE_ID,
       PR.SOURCE_BUSKEY,
       PR.RECEIVER_ALLOCATE_ID,
       PR.RECEIVER_RELEASE_DATE,
       PR.RECEIVER_RELEASE_NAME,
       PR.PROD_CRITERIA_GROUP_ID,
       PR.LOC_CRITERIA_GROUP_ID,
       PR.YEARSEASON_CRITERIA_GROUP_ID
  FROM DIM_RECEIVER_BD PB
 INNER JOIN DIM_RECEIVER_BD_RELEASE PBR
    ON PB.RECEIVER_BD_ID = PBR.RECEIVER_BD_ID
 INNER JOIN DIM_RECEIVER_ALLOCATE PA
    ON PBR.RECEIVER_BD_RELEASE_ID = PA.RECEIVER_BD_RELEASE_ID
 INNER JOIN DIM_RECEIVER_RELEASE PR
    ON PA.RECEIVER_ALLOCATE_ID = PR.RECEIVER_ALLOCATE_ID;


CREATE OR REPLACE VIEW V_DIM_REC_PRIMARY_ALLOCATE
AS
SELECT PB.RECEIVER_BD_ID               PB_RECEIVER_BD_ID,
       PB.SOURCE_BUSKEY                PB_SOURCE_BUSKEY,
       PB.RECEIVER_NUMBER              PB_RECEIVER_NUMBER,
       PB.RECEIVER_BD_DATE             PB_RECEIVER_BD_DATE,
       PB.RECEIVER_BD_NAME             PB_RECEIVER_BD_NAME,
       PB.PROD_CRITERIA_GROUP_ID       PB_PROD_CRITERIA_GROUP_ID,
       PB.LOC_CRITERIA_GROUP_ID        PB_LOC_CRITERIA_GROUP_ID,
       PB.YEARSEASON_CRITERIA_GROUP_ID PB_YS_CRITERIA_GROUP_ID,
       PBR.RECEIVER_BD_RELEASE_ID       PBR_RECEIVER_BD_RELEASE_ID,
       PBR.SOURCE_BUSKEY                PBR_SOURCE_BUSKEY,
       PBR.RECEIVER_BD_ID               PBR_RECEIVER_BD_ID,
       PBR.RECEIVER_BD_RELEASE_DATE     PBR_RECEIVER_BD_RELEASE_DATE,
       PBR.RECEIVER_BD_RELEASE_NAME     PBR_RECEIVER_BD_RELEASE_NAME,
       PBR.PROD_CRITERIA_GROUP_ID       PBR_PROD_CRITERIA_GROUP_ID,
       PBR.LOC_CRITERIA_GROUP_ID        PBR_LOC_CRITERIA_GROUP_ID,
       PBR.YEARSEASON_CRITERIA_GROUP_ID PBR_YS_CRITERIA_GROUP_ID,
       PA.RECEIVER_ALLOCATE_ID,
       PA.SOURCE_BUSKEY,
       PA.RECEIVER_ALLOCATE_DATE,
       PA.RECEIVER_ALLOCATE_NAME,
       PA.PROD_CRITERIA_GROUP_ID,
       PA.LOC_CRITERIA_GROUP_ID,
       PA.YEARSEASON_CRITERIA_GROUP_ID,
       PA.RECEIVER_BD_RELEASE_ID
  FROM DIM_RECEIVER_BD PB
 INNER JOIN DIM_RECEIVER_BD_RELEASE PBR
    ON PB.RECEIVER_BD_ID = PBR.RECEIVER_BD_ID
 INNER JOIN DIM_RECEIVER_ALLOCATE PA
    ON PBR.RECEIVER_BD_RELEASE_ID = PA.RECEIVER_BD_RELEASE_ID;

CREATE OR REPLACE VIEW V_DIM_REC_PRIMARY_BD_RELEASE
AS
SELECT PB.RECEIVER_BD_ID               PB_RECEIVER_BD_ID,
       PB.SOURCE_BUSKEY                PB_SOURCE_BUSKEY,
       PB.RECEIVER_NUMBER              PB_RECEIVER_NUMBER,
       PB.RECEIVER_BD_DATE             PB_RECEIVER_BD_DATE,
       PB.RECEIVER_BD_NAME             PB_RECEIVER_BD_NAME,
       PB.PROD_CRITERIA_GROUP_ID       PB_PROD_CRITERIA_GROUP_ID,
       PB.LOC_CRITERIA_GROUP_ID        PB_LOC_CRITERIA_GROUP_ID,
       PB.YEARSEASON_CRITERIA_GROUP_ID PB_YS_CRITERIA_GROUP_ID,
       PBR.RECEIVER_BD_RELEASE_ID,
       PBR.SOURCE_BUSKEY,
       PBR.RECEIVER_BD_ID,
       PBR.RECEIVER_BD_RELEASE_DATE,
       PBR.RECEIVER_BD_RELEASE_NAME,
       PBR.PROD_CRITERIA_GROUP_ID,
       PBR.LOC_CRITERIA_GROUP_ID,
       PBR.YEARSEASON_CRITERIA_GROUP_ID
  FROM DIM_RECEIVER_BD PB
 INNER JOIN DIM_RECEIVER_BD_RELEASE PBR
    ON PB.RECEIVER_BD_ID = PBR.RECEIVER_BD_ID;



--DROP TABLE FACT_POS_SALES_TEMP PURGE;
CREATE GLOBAL TEMPORARY TABLE FACT_POS_SALES_TEMP
(
DATE_ID                    NUMBER(8)    NOT NULL,
STYLE_COLOR_SIZE_ID        NUMBER(7)    NOT NULL,
STYLE_YEAR_SEASON_ID       NUMBER(7)    NOT NULL,
STORE_ID                   NUMBER(7)    NOT NULL,
SALES_STYLE_ID             NUMBER(5)    NOT NULL,
SALES_UNIT                 NUMBER(11)   NOT NULL,
SALES_RETAIL               NUMBER(15,2) NOT NULL,
SALES_COST                 NUMBER(15,2) NOT NULL,
PROMO_RETAIL               NUMBER(15,2) NOT NULL,
PROMO_PERCENT              NUMBER(11,4) NOT NULL,
PROFIT_DOLLAR              NUMBER(15,2) NOT NULL,
OWNED_COST                 NUMBER(9,2)  NOT NULL,
MSRP                       NUMBER(15,2) NOT NULL,
OWNED_RETAIL               NUMBER(9,2)  NOT NULL,
DEMAND_SALES_UNIT          NUMBER(11)   NOT NULL,
DEMAND_SALES_COST          NUMBER(15,2) NOT NULL,
DEMAND_SALES_RETAIL        NUMBER(15,2) NOT NULL,
RETURN_UNIT                NUMBER(11)   NOT NULL,
RETURN_COST                NUMBER(15,2) NOT NULL,
RETURN_RETAIL              NUMBER(15,2) NOT NULL,
BACK_ORDER_UNIT            NUMBER(11)   NOT NULL,
BACK_ORDER_COST            NUMBER(15,2) NOT NULL,
BACK_ORDER_RETAIL          NUMBER(15,2) NOT NULL
) 
ON COMMIT PRESERVE ROWS;

CREATE INDEX XIE1FACT_POS_SALES_TEMP ON FACT_POS_SALES_TEMP(DATE_ID,STYLE_COLOR_SIZE_ID,STYLE_YEAR_SEASON_ID,STORE_ID);

--DROP TABLE FACT_POS_INVENTORY_TEMP PURGE;
CREATE GLOBAL TEMPORARY TABLE FACT_POS_INVENTORY_TEMP
(
  DATE_ID                       NUMBER(8)   NOT NULL,
  STYLE_COLOR_SIZE_ID           NUMBER(7)   NOT NULL,
  STYLE_YEAR_SEASON_ID          NUMBER(7)   NOT NULL,
  STORE_ID                      NUMBER(7)   NOT NULL,
  BEGIN_INVENTORY_UNIT          NUMBER(11)  NOT NULL,
  BEGIN_INVENTORY_RETAIL        NUMBER(15,2)NOT NULL,
  BEGIN_INVENTORY_COST          NUMBER(15,2)NOT NULL,
  RECEIPT_UNIT                  NUMBER(11)  NOT NULL,
  RECEIPT_RETAIL                NUMBER(15,2)NOT NULL,
  RECEIPT_COST                  NUMBER(15,2)NOT NULL,
  END_INVENTORY_UNIT            NUMBER(11)  NOT NULL,
  END_INVENTORY_RETAIL          NUMBER(15,2)NOT NULL,
  END_INVENTORY_COST            NUMBER(15,2)NOT NULL,
  TRANSFER_IN_UNIT              NUMBER(11)  NOT NULL,
  TRANSFER_IN_RETAIL            NUMBER(15,2)NOT NULL,
  TRANSFER_IN_COST              NUMBER(15,2)NOT NULL,
  TRANSFER_OUT_UNIT             NUMBER(11)  NOT NULL,
  TRANSFER_OUT_RETAIL           NUMBER(15,2)NOT NULL,
  TRANSFER_OUT_COST             NUMBER(15,2)NOT NULL,
  ADJUSTMENT_UNIT               NUMBER(11)  NOT NULL,
  ADJUSTMENT_RETAIL             NUMBER(15,2)NOT NULL,
  ADJUSTMENT_COST               NUMBER(15,2)NOT NULL,
  OWNED_COST                    NUMBER(9,2) NOT NULL,
  MSRP                          NUMBER(15,2)NOT NULL,
  OWNED_RETAIL                  NUMBER(9,2) NOT NULL,
  MKD_RETAIL                    NUMBER(11)  NOT NULL,
  MKD_PERCENT                   NUMBER(11,4)NOT NULL
)
ON COMMIT PRESERVE ROWS;

CREATE INDEX XIE1FACT_POS_INVENTORY_TEMP ON FACT_POS_INVENTORY_TEMP(DATE_ID,STYLE_COLOR_SIZE_ID,STYLE_YEAR_SEASON_ID,STORE_ID);






--**************************************************************************************
--**************************************************************************************
--*******************************RAW tables*********************************************
--**************************************************************************************
--**************************************************************************************

-- Create table
--DROP TABLE POS_SALES_RAW;
CREATE TABLE POS_SALES_RAW
(
  CORPORATE_DIVISION       VARCHAR2(60),
  BUYER_DEPT_NUM           VARCHAR2(60),
  BODY_CLASSIFICATION_CODE VARCHAR2(60),
  DOOR_NUM                 VARCHAR2(13),
  SALES_STYLE              VARCHAR2(60), 
  SIZE_CODE                VARCHAR2(20),  
  SIZE_DESC1               VARCHAR2(40),
  SIZE_DESC2               VARCHAR2(40),  
  STYLE_NUMBER             VARCHAR2(40),
  COLOR_CODE               VARCHAR2(20), 
  UPC                      VARCHAR2(14),   
  ARTICLE_NUMBER           VARCHAR2(200),
  VENDOR_REF_NUMBER        VARCHAR2(20), 
  TRANSACTION_DATE         VARCHAR2(8),  
  YEAR                     NUMBER(4),
  MONTH                    NUMBER(2),
  WEEK                     NUMBER(2),
  DAY                      NUMBER(3),
  SALES_UNIT               NUMBER(11),
  SALES_RETAIL             NUMBER(15,2),
  SALES_COST               NUMBER(15,2),
  PROMO_RETAIL             NUMBER(9,2),
  PROMO_PERCENT            NUMBER(11,4),
  PROFIT_DOLLAR            NUMBER(15,2),
  OWNED_RETAIL             NUMBER(9,2),  
  OWNED_COST               NUMBER(9,2),
  MSRP                     NUMBER(15,2),
  DEMAND_SALES_UNIT        NUMBER(11),
  DEMAND_SALES_COST        NUMBER(15,2),
  DEMAND_SALES_RETAIL      NUMBER(15,2),
  RETURN_UNIT              NUMBER(11),
  RETURN_COST              NUMBER(15,2),
  RETURN_RETAIL            NUMBER(15,2),
  BACK_ORDER_UNIT          NUMBER(11),
  BACK_ORDER_COST          NUMBER(15,2),
  BACK_ORDER_RETAIL        NUMBER(15,2),
  FILE_ROW_NUM             NUMBER(9) DEFAULT 0 NOT NULL,
  UPLOAD_ID                NUMBER(9) NOT NULL
) PARTITION BY RANGE(UPLOAD_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (1))
NOLOGGING;




-- Create table
--DROP TABLE POS_INVENTORY_RAW;
CREATE TABLE POS_INVENTORY_RAW
(
  CORPORATE_DIVISION       VARCHAR2(60),
  BUYER_DEPT_NUM           VARCHAR2(60),
  BODY_CLASSIFICATION_CODE VARCHAR2(60),
  DOOR_NUM                 VARCHAR2(13),
  SIZE_CODE                VARCHAR2(20),  
  SIZE_DESC1               VARCHAR2(40),
  SIZE_DESC2               VARCHAR2(40),  
  STYLE_NUMBER             VARCHAR2(40),
  COLOR_CODE               VARCHAR2(20), 
  UPC                      VARCHAR2(14),   
  ARTICLE_NUMBER           VARCHAR2(200),
  VENDOR_REF_NUMBER        VARCHAR2(20), 
  TRANSACTION_DATE         VARCHAR2(8),  
  YEAR                     NUMBER(4),
  MONTH                    NUMBER(2),
  WEEK                     NUMBER(2),
  DAY                      NUMBER(3),
  BEGIN_INVENTORY_UNIT     NUMBER(11),
  BEGIN_INVENTORY_RETAIL   NUMBER(15,2),
  BEGIN_INVENTORY_COST     NUMBER(15,2),
  RECEIPT_UNIT             NUMBER(11),
  RECEIPT_RETAIL           NUMBER(15,2),
  RECEIPT_COST             NUMBER(15,2),
  MKD_RETAIL               NUMBER(11),
  MKD_PERCENT              NUMBER(11,4),
  END_INVENTORY_UNIT       NUMBER(11),
  END_INVENTORY_RETAIL     NUMBER(15,2),
  END_INVENTORY_COST       NUMBER(15,2),
  TRANSFER_IN_UNIT         NUMBER(11),
  TRANSFER_IN_RETAIL       NUMBER(15,2),
  TRANSFER_IN_COST         NUMBER(15,2),
  TRANSFER_OUT_UNIT        NUMBER(11),
  TRANSFER_OUT_RETAIL      NUMBER(15,2),
  TRANSFER_OUT_COST        NUMBER(15,2),
  ADJUSTMENT_UNIT          NUMBER(11),
  ADJUSTMENT_RETAIL        NUMBER(15,2),
  ADJUSTMENT_COST          NUMBER(15,2),
  OWNED_COST               NUMBER(9,2),
  MSRP                     NUMBER(15,2),
  OWNED_RETAIL             NUMBER(9,2),
  FILE_ROW_NUM             NUMBER(9) DEFAULT 0 NOT NULL,
  UPLOAD_ID                NUMBER(9) NOT NULL
) PARTITION BY RANGE(UPLOAD_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (1))
NOLOGGING;


--**************************************************************************************
--**************************************************************************************
--*******************************POS AGGREGATION tables*********************************
--**************************************************************************************
--**************************************************************************************


-- POS SALES

-- PROD ATTR/WEEK
CREATE TABLE FACT_POS_SALES_ITEM_WEEK
(
  SWEEK_ID                   NUMBER(6) NOT NULL,
  STORE_ID                   NUMBER(7) NOT NULL,
  PROD_ATTR_VALUE_ID         NUMBER(7) NOT NULL,
  YEAR_SEASON_ID             NUMBER(7) NOT NULL,
  SALES_STYLE_ID             NUMBER(5) NOT NULL,
  SALES_UNIT                 NUMBER(11) NOT NULL,
  SALES_RETAIL               NUMBER(15,2) NOT NULL,
  SALES_COST                 NUMBER(15,2) NOT NULL,
  PROMO_RETAIL               NUMBER(15,2) NOT NULL,
  PROMO_PERCENT              NUMBER(11,4) NOT NULL,
  PROFIT_DOLLAR              NUMBER(15,2) NOT NULL,
  OWNED_COST                 NUMBER(9,2) NOT NULL,
  MSRP                       NUMBER(15,2) NOT NULL,
  OWNED_RETAIL               NUMBER(9,2) NOT NULL,
  DEMAND_SALES_UNIT          NUMBER(11) NOT NULL,
  DEMAND_SALES_COST          NUMBER(15,2) NOT NULL,
  DEMAND_SALES_RETAIL        NUMBER(15,2) NOT NULL,
  RETURN_UNIT                NUMBER(11) NOT NULL,
  RETURN_COST                NUMBER(15,2) NOT NULL,
  RETURN_RETAIL              NUMBER(15,2) NOT NULL,
  BACK_ORDER_UNIT            NUMBER(11) NOT NULL,
  BACK_ORDER_COST            NUMBER(15,2) NOT NULL,
  BACK_ORDER_RETAIL          NUMBER(15,2) NOT NULL
)
PARTITION BY RANGE(SWEEK_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (201301))
COMPRESS FOR OLTP
PARALLEL 
NOLOGGING;

ALTER TABLE FACT_POS_SALES_ITEM_WEEK ADD CONSTRAINT FKFACT_POS_SALES_ITEM_WEEK_D FOREIGN KEY (STORE_ID)
  REFERENCES DIM_STORE_STORE (STORE_ID);
  
ALTER TABLE FACT_POS_SALES_ITEM_WEEK ADD CONSTRAINT FKFACT_POS_SALES_ITEM_WEEK_M FOREIGN KEY (SWEEK_ID)
  REFERENCES DIM_DATE_SWEEK (SWEEK_ID);
  
ALTER TABLE FACT_POS_SALES_ITEM_WEEK ADD CONSTRAINT FKFACT_POS_SALES_ITEM_WEEK_V FOREIGN KEY (PROD_ATTR_VALUE_ID)
  REFERENCES DIM_PROD_ATTR_VALUE (PROD_ATTR_VALUE_ID);


ALTER TABLE FACT_POS_SALES_ITEM_WEEK ADD CONSTRAINT FKFACT_POS_SALES_ITEM_WEEK_Y FOREIGN KEY (YEAR_SEASON_ID)
  REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);
    
CREATE BITMAP INDEX BX1FACT_POS_SALES_ITEM_WEEK ON FACT_POS_SALES_ITEM_WEEK (SWEEK_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_POS_SALES_ITEM_WEEK ON FACT_POS_SALES_ITEM_WEEK (STORE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_POS_SALES_ITEM_WEEK ON FACT_POS_SALES_ITEM_WEEK (PROD_ATTR_VALUE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX4FACT_POS_SALES_ITEM_WEEK ON FACT_POS_SALES_ITEM_WEEK (YEAR_SEASON_ID) LOCAL PARALLEL;
  
-- PROD ATTR/MONTH
CREATE TABLE FACT_POS_SALES_ITEM
(
  SMONTH_ID                  NUMBER(6) NOT NULL,
  STORE_ID                   NUMBER(7) NOT NULL,
  PROD_ATTR_VALUE_ID         NUMBER(7) NOT NULL,
  YEAR_SEASON_ID             NUMBER(7) NOT NULL,  
  SALES_STYLE_ID             NUMBER(5) NOT NULL,
  SALES_UNIT                 NUMBER(11) NOT NULL,
  SALES_RETAIL               NUMBER(15,2) NOT NULL,
  SALES_COST                 NUMBER(15,2) NOT NULL,
  PROMO_RETAIL               NUMBER(15,2) NOT NULL,
  PROMO_PERCENT              NUMBER(11,4) NOT NULL,
  PROFIT_DOLLAR              NUMBER(15,2) NOT NULL,
  OWNED_COST                 NUMBER(9,2) NOT NULL,
  MSRP                       NUMBER(15,2) NOT NULL,
  OWNED_RETAIL               NUMBER(9,2) NOT NULL,
  DEMAND_SALES_UNIT          NUMBER(11) NOT NULL,
  DEMAND_SALES_COST          NUMBER(15,2) NOT NULL,
  DEMAND_SALES_RETAIL        NUMBER(15,2) NOT NULL,
  RETURN_UNIT                NUMBER(11) NOT NULL,
  RETURN_COST                NUMBER(15,2) NOT NULL,
  RETURN_RETAIL              NUMBER(15,2) NOT NULL,
  BACK_ORDER_UNIT            NUMBER(11) NOT NULL,
  BACK_ORDER_COST            NUMBER(15,2) NOT NULL,
  BACK_ORDER_RETAIL          NUMBER(15,2) NOT NULL
)
PARTITION BY RANGE(SMONTH_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (201301))
COMPRESS FOR OLTP
PARALLEL NOLOGGING;

ALTER TABLE FACT_POS_SALES_ITEM ADD CONSTRAINT FKFACT_POS_SALES_ITEM_D FOREIGN KEY (STORE_ID)
  REFERENCES DIM_STORE_STORE (STORE_ID);
  
ALTER TABLE FACT_POS_SALES_ITEM ADD CONSTRAINT FKFACT_POS_SALES_ITEM_M FOREIGN KEY (SMONTH_ID)
  REFERENCES DIM_DATE_SMONTH (SMONTH_ID);
  
ALTER TABLE FACT_POS_SALES_ITEM ADD CONSTRAINT FKFACT_POS_SALES_ITEM_V FOREIGN KEY (PROD_ATTR_VALUE_ID)
  REFERENCES DIM_PROD_ATTR_VALUE (PROD_ATTR_VALUE_ID);

ALTER TABLE FACT_POS_SALES_ITEM ADD CONSTRAINT FKFACT_POS_SALES_ITEM_Y FOREIGN KEY (YEAR_SEASON_ID)
  REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);
  
CREATE BITMAP INDEX BX1FACT_POS_SALES_ITEM ON FACT_POS_SALES_ITEM (SMONTH_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_POS_SALES_ITEM ON FACT_POS_SALES_ITEM (STORE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_POS_SALES_ITEM ON FACT_POS_SALES_ITEM (PROD_ATTR_VALUE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX4FACT_POS_SALES_ITEM ON FACT_POS_SALES_ITEM (YEAR_SEASON_ID) LOCAL PARALLEL;



-- POS INVENTORY

-- PROD ATTR/WEEK
CREATE TABLE FACT_POS_INV_ITEM_WEEK
(
  SWEEK_ID                   NUMBER(6)      NOT NULL,
  STORE_ID                   NUMBER(7)      NOT NULL,
  PROD_ATTR_VALUE_ID         NUMBER(7)      NOT NULL,
  YEAR_SEASON_ID             NUMBER(7)      NOT NULL,    
  BEGIN_INVENTORY_UNIT       NUMBER(11)     NOT NULL,
  BEGIN_INVENTORY_RETAIL     NUMBER(15,2)   NOT NULL,
  BEGIN_INVENTORY_COST       NUMBER(15,2)   NOT NULL,
  RECEIPT_UNIT               NUMBER(11)     NOT NULL,
  RECEIPT_RETAIL             NUMBER(15,2)   NOT NULL,
  RECEIPT_COST               NUMBER(15,2)   NOT NULL,
  END_INVENTORY_UNIT         NUMBER(11)     NOT NULL,
  END_INVENTORY_RETAIL       NUMBER(15,2)   NOT NULL,
  END_INVENTORY_COST         NUMBER(15,2)   NOT NULL,
  TRANSFER_IN_UNIT           NUMBER(11)     NOT NULL,
  TRANSFER_IN_RETAIL         NUMBER(15,2)   NOT NULL,
  TRANSFER_IN_COST           NUMBER(15,2)   NOT NULL,
  TRANSFER_OUT_UNIT          NUMBER(11)     NOT NULL,
  TRANSFER_OUT_RETAIL        NUMBER(15,2)   NOT NULL,
  TRANSFER_OUT_COST          NUMBER(15,2)   NOT NULL,
  ADJUSTMENT_UNIT            NUMBER(11)     NOT NULL,
  ADJUSTMENT_RETAIL          NUMBER(15,2)   NOT NULL,
  ADJUSTMENT_COST            NUMBER(15,2)   NOT NULL
)
PARTITION BY RANGE(SWEEK_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (201301))
COMPRESS FOR OLTP
PARALLEL NOLOGGING;

ALTER TABLE FACT_POS_INV_ITEM_WEEK ADD CONSTRAINT FKFACT_POS_INV_ITEM_WEEK_D FOREIGN KEY (STORE_ID)
  REFERENCES DIM_STORE_STORE (STORE_ID);
  
ALTER TABLE FACT_POS_INV_ITEM_WEEK ADD CONSTRAINT FKFACT_POS_INV_ITEM_WEEK_M FOREIGN KEY (SWEEK_ID)
  REFERENCES DIM_DATE_SWEEK (SWEEK_ID);
  
ALTER TABLE FACT_POS_INV_ITEM_WEEK ADD CONSTRAINT FKFACT_POS_INV_ITEM_WEEK_V FOREIGN KEY (PROD_ATTR_VALUE_ID)
  REFERENCES DIM_PROD_ATTR_VALUE (PROD_ATTR_VALUE_ID);

ALTER TABLE FACT_POS_INV_ITEM_WEEK ADD CONSTRAINT FKFACT_POS_INV_ITEM_WEEK_Y FOREIGN KEY (YEAR_SEASON_ID)
  REFERENCES DIM_YEAR_SEASON (YEAR_SEASON_ID);
  
CREATE BITMAP INDEX BX1FACT_POS_INV_ITEM_WEEK ON FACT_POS_INV_ITEM_WEEK (SWEEK_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_POS_INV_ITEM_WEEK ON FACT_POS_INV_ITEM_WEEK (STORE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_POS_INV_ITEM_WEEK ON FACT_POS_INV_ITEM_WEEK (PROD_ATTR_VALUE_ID)LOCAL PARALLEL;
CREATE BITMAP INDEX BX4FACT_POS_INV_ITEM_WEEK ON FACT_POS_INV_ITEM_WEEK (YEAR_SEASON_ID)LOCAL PARALLEL;

-- PROD ATTR/MONTH
CREATE TABLE FACT_POS_INV_ITEM
(
  SMONTH_ID                  NUMBER(6)    NOT NULL,
  STORE_ID                   NUMBER(7)    NOT NULL,
  PROD_ATTR_VALUE_ID         NUMBER(7)    NOT NULL,
  YEAR_SEASON_ID             NUMBER(7)    NOT NULL,  
  BEGIN_INVENTORY_UNIT       NUMBER(11)   NOT NULL,
  BEGIN_INVENTORY_RETAIL     NUMBER(15,2) NOT NULL,
  BEGIN_INVENTORY_COST       NUMBER(15,2) NOT NULL,
  RECEIPT_UNIT               NUMBER(11)   NOT NULL,
  RECEIPT_RETAIL             NUMBER(15,2) NOT NULL,
  RECEIPT_COST               NUMBER(15,2) NOT NULL,
  END_INVENTORY_UNIT         NUMBER(11)   NOT NULL,
  END_INVENTORY_RETAIL       NUMBER(15,2) NOT NULL,
  END_INVENTORY_COST         NUMBER(15,2) NOT NULL,
  TRANSFER_IN_UNIT           NUMBER(11)   NOT NULL,
  TRANSFER_IN_RETAIL         NUMBER(15,2) NOT NULL,
  TRANSFER_IN_COST           NUMBER(15,2) NOT NULL,
  TRANSFER_OUT_UNIT          NUMBER(11)   NOT NULL,
  TRANSFER_OUT_RETAIL        NUMBER(15,2) NOT NULL,
  TRANSFER_OUT_COST          NUMBER(15,2) NOT NULL,
  ADJUSTMENT_UNIT            NUMBER(11)   NOT NULL,
  ADJUSTMENT_RETAIL          NUMBER(15,2) NOT NULL,
  ADJUSTMENT_COST            NUMBER(15,2) NOT NULL
)
PARTITION BY RANGE(SMONTH_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (201301))
COMPRESS FOR OLTP
PARALLEL NOLOGGING;

ALTER TABLE FACT_POS_INV_ITEM ADD CONSTRAINT FKFACT_POS_INV_ITEM_D FOREIGN KEY (STORE_ID)
  REFERENCES DIM_STORE_STORE (STORE_ID);
  
ALTER TABLE FACT_POS_INV_ITEM ADD CONSTRAINT FKFACT_POS_INV_ITEM_M FOREIGN KEY (SMONTH_ID)
  REFERENCES DIM_DATE_SMONTH (SMONTH_ID);
  
ALTER TABLE FACT_POS_INV_ITEM ADD CONSTRAINT FKFACT_POS_INV_ITEM_V FOREIGN KEY (PROD_ATTR_VALUE_ID)
  REFERENCES DIM_PROD_ATTR_VALUE (PROD_ATTR_VALUE_ID);

ALTER TABLE FACT_POS_INV_ITEM ADD CONSTRAINT FKFACT_POS_INV_ITEM_Y FOREIGN KEY (YEAR_SEASON_ID)
  REFERENCES DIM_YEAR_SEASON (YEAR_SEASON_ID);
    
CREATE BITMAP INDEX BX1FACT_POS_INV_ITEM ON FACT_POS_INV_ITEM (SMONTH_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_POS_INV_ITEM ON FACT_POS_INV_ITEM (STORE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_POS_INV_ITEM ON FACT_POS_INV_ITEM (PROD_ATTR_VALUE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX4FACT_POS_INV_ITEM ON FACT_POS_INV_ITEM (YEAR_SEASON_ID) LOCAL PARALLEL;




-- POS SALES

-- STYLE COLOR/WEEK
CREATE TABLE FACT_POS_SALES_STYLECOLOR_WEEK
(
  SWEEK_ID                   NUMBER(6) NOT NULL,
  STORE_LOC_ID               NUMBER(7) NOT NULL,
  STYLE_COLOR_SIZE_ID        NUMBER(7) NOT NULL,
  STYLE_YEAR_SEASON_ID       NUMBER(7) NOT NULL,
  SALES_STYLE_ID             NUMBER(5) NOT NULL,
  SALES_UNIT                 NUMBER(11) NOT NULL,
  SALES_RETAIL               NUMBER(15,2) NOT NULL,
  SALES_COST                 NUMBER(15,2) NOT NULL,
  PROMO_RETAIL               NUMBER(15,2) NOT NULL,
  PROMO_PERCENT              NUMBER(11,4) NOT NULL,
  PROFIT_DOLLAR              NUMBER(15,2) NOT NULL,
  OWNED_COST                 NUMBER(9,2) NOT NULL,
  MSRP                       NUMBER(15,2) NOT NULL,
  OWNED_RETAIL               NUMBER(9,2) NOT NULL,
  DEMAND_SALES_UNIT          NUMBER(11) NOT NULL,
  DEMAND_SALES_COST          NUMBER(15,2) NOT NULL,
  DEMAND_SALES_RETAIL        NUMBER(15,2) NOT NULL,
  RETURN_UNIT                NUMBER(11) NOT NULL,
  RETURN_COST                NUMBER(15,2) NOT NULL,
  RETURN_RETAIL              NUMBER(15,2) NOT NULL,
  BACK_ORDER_UNIT            NUMBER(11) NOT NULL,
  BACK_ORDER_COST            NUMBER(15,2) NOT NULL,
  BACK_ORDER_RETAIL          NUMBER(15,2) NOT NULL,
  NO_OF_DOOR                 NUMBER(5) NOT NULL,
  FULL_UNIT                  NUMBER(11) NOT NULL,
  PROMO_UNIT                 NUMBER(11) NOT NULL,
  CLEAR_UNIT                 NUMBER(11) NOT NULL  
)
PARTITION BY RANGE(SWEEK_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (201301))
COMPRESS FOR OLTP
PARALLEL NOLOGGING;

ALTER TABLE FACT_POS_SALES_STYLECOLOR_WEEK ADD CONSTRAINT FKFACT_POS_SALES_SC_WEEK_L FOREIGN KEY (STORE_LOC_ID)
  REFERENCES DIM_STORE_LOC(STORE_LOC_ID);
  
ALTER TABLE FACT_POS_SALES_STYLECOLOR_WEEK ADD CONSTRAINT FKFACT_POS_SALES_SC_WEEK_M FOREIGN KEY (SWEEK_ID)
  REFERENCES DIM_DATE_SWEEK (SWEEK_ID);
  
ALTER TABLE FACT_POS_SALES_STYLECOLOR_WEEK ADD CONSTRAINT FKFACT_POS_SALES_SC_WEEK_V FOREIGN KEY (STYLE_COLOR_SIZE_ID)
  REFERENCES DIM_STYLE_COLOR_SIZE (STYLE_COLOR_SIZE_ID);

ALTER TABLE FACT_POS_SALES_STYLECOLOR_WEEK ADD CONSTRAINT FKFACT_POS_SALES_SC_WEEK_Y FOREIGN KEY (STYLE_YEAR_SEASON_ID)
  REFERENCES DIM_STYLE_YEAR_SEASON (STYLE_YEAR_SEASON_ID);
  
CREATE BITMAP INDEX BX1FACT_POS_SALES_SC_WEEK ON FACT_POS_SALES_STYLECOLOR_WEEK (SWEEK_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_POS_SALES_SC_WEEK ON FACT_POS_SALES_STYLECOLOR_WEEK (STORE_LOC_ID)LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_POS_SALES_SC_WEEK ON FACT_POS_SALES_STYLECOLOR_WEEK (STYLE_COLOR_SIZE_ID)LOCAL PARALLEL;
CREATE BITMAP INDEX BX4FACT_POS_SALES_SC_WEEK ON FACT_POS_SALES_STYLECOLOR_WEEK (STYLE_YEAR_SEASON_ID)LOCAL PARALLEL;
    
-- STYLE COLOR/MONTH
CREATE TABLE FACT_POS_SALES_STYLECOLOR
(
  SMONTH_ID                  NUMBER(6) NOT NULL,
  STORE_LOC_ID               NUMBER(7) NOT NULL,
  STYLE_COLOR_SIZE_ID        NUMBER(7) NOT NULL,
  STYLE_YEAR_SEASON_ID       NUMBER(7) NOT NULL,  
  SALES_STYLE_ID             NUMBER(5) NOT NULL,
  SALES_UNIT                 NUMBER(11) NOT NULL,
  SALES_RETAIL               NUMBER(15,2) NOT NULL,
  SALES_COST                 NUMBER(15,2) NOT NULL,
  PROMO_RETAIL               NUMBER(15,2) NOT NULL,
  PROMO_PERCENT              NUMBER(11,4) NOT NULL,
  PROFIT_DOLLAR              NUMBER(15,2) NOT NULL,
  OWNED_COST                 NUMBER(9,2) NOT NULL,
  MSRP                       NUMBER(15,2) NOT NULL,
  OWNED_RETAIL               NUMBER(9,2) NOT NULL,
  DEMAND_SALES_UNIT          NUMBER(11) NOT NULL,
  DEMAND_SALES_COST          NUMBER(15,2) NOT NULL,
  DEMAND_SALES_RETAIL        NUMBER(15,2) NOT NULL,
  RETURN_UNIT                NUMBER(11) NOT NULL,
  RETURN_COST                NUMBER(15,2) NOT NULL,
  RETURN_RETAIL              NUMBER(15,2) NOT NULL,
  BACK_ORDER_UNIT            NUMBER(11) NOT NULL,
  BACK_ORDER_COST            NUMBER(15,2) NOT NULL,
  BACK_ORDER_RETAIL          NUMBER(15,2) NOT NULL,
  NO_OF_DOOR                 NUMBER(5) NOT NULL,
  FULL_UNIT                  NUMBER(11) NOT NULL,
  PROMO_UNIT                 NUMBER(11) NOT NULL,
  CLEAR_UNIT                 NUMBER(11) NOT NULL    
)
PARTITION BY RANGE(SMONTH_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (201301))
COMPRESS FOR OLTP
PARALLEL NOLOGGING;


ALTER TABLE FACT_POS_SALES_STYLECOLOR ADD CONSTRAINT FKFACT_POS_SALES_STYLECOLOR_L FOREIGN KEY (STORE_LOC_ID)
  REFERENCES DIM_STORE_LOC (STORE_LOC_ID);
  
ALTER TABLE FACT_POS_SALES_STYLECOLOR ADD CONSTRAINT FKFACT_POS_SALES_STYLECOLOR_M FOREIGN KEY (SMONTH_ID)
  REFERENCES DIM_DATE_SMONTH (SMONTH_ID);
  
ALTER TABLE FACT_POS_SALES_STYLECOLOR ADD CONSTRAINT FKFACT_POS_SALES_STYLECOLOR_V FOREIGN KEY (STYLE_COLOR_SIZE_ID)
  REFERENCES DIM_STYLE_COLOR_SIZE (STYLE_COLOR_SIZE_ID);

ALTER TABLE FACT_POS_SALES_STYLECOLOR ADD CONSTRAINT FKFACT_POS_SALES_STYLECOLOR_Y FOREIGN KEY (STYLE_YEAR_SEASON_ID)
  REFERENCES DIM_STYLE_YEAR_SEASON (STYLE_YEAR_SEASON_ID);
  
CREATE BITMAP INDEX BX1FACT_POS_SALES_STYLECOLOR ON FACT_POS_SALES_STYLECOLOR (SMONTH_ID)LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_POS_SALES_STYLECOLOR ON FACT_POS_SALES_STYLECOLOR (STORE_LOC_ID)LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_POS_SALES_STYLECOLOR ON FACT_POS_SALES_STYLECOLOR (STYLE_COLOR_SIZE_ID)LOCAL PARALLEL;
CREATE BITMAP INDEX BX4FACT_POS_SALES_STYLECOLOR ON FACT_POS_SALES_STYLECOLOR (STYLE_YEAR_SEASON_ID)LOCAL PARALLEL;

  


-- POS INVENTORY

-- STYLE COLOR/WEEK
CREATE TABLE FACT_POS_INV_STYLECOLOR_WEEK
(
  SWEEK_ID                   NUMBER(6) NOT NULL,
  STORE_LOC_ID               NUMBER(7) NOT NULL,
  STYLE_COLOR_SIZE_ID        NUMBER(7) NOT NULL,
  STYLE_YEAR_SEASON_ID       NUMBER(7) NOT NULL,  
  BEGIN_INVENTORY_UNIT       NUMBER(11),
  BEGIN_INVENTORY_RETAIL     NUMBER(15,2),
  BEGIN_INVENTORY_COST       NUMBER(15,2),
  RECEIPT_UNIT               NUMBER(11),
  RECEIPT_RETAIL             NUMBER(15,2),
  RECEIPT_COST               NUMBER(15,2),
  END_INVENTORY_UNIT         NUMBER(11),
  END_INVENTORY_RETAIL       NUMBER(15,2),
  END_INVENTORY_COST         NUMBER(15,2),
  TRANSFER_IN_UNIT           NUMBER(11),
  TRANSFER_IN_RETAIL         NUMBER(15,2),
  TRANSFER_IN_COST           NUMBER(15,2),
  TRANSFER_OUT_UNIT          NUMBER(11),
  TRANSFER_OUT_RETAIL        NUMBER(15,2),
  TRANSFER_OUT_COST          NUMBER(15,2),
  ADJUSTMENT_UNIT            NUMBER(11),
  ADJUSTMENT_RETAIL          NUMBER(15,2),
  ADJUSTMENT_COST            NUMBER(15,2)
)
PARTITION BY RANGE(SWEEK_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (201301))
COMPRESS FOR OLTP
PARALLEL NOLOGGING;

ALTER TABLE FACT_POS_INV_STYLECOLOR_WEEK ADD CONSTRAINT FKFACT_POS_INV_SC_WEEK_L FOREIGN KEY (STORE_LOC_ID)
  REFERENCES DIM_STORE_LOC (STORE_LOC_ID);
  
ALTER TABLE FACT_POS_INV_STYLECOLOR_WEEK ADD CONSTRAINT FKFACT_POS_INV_SC_WEEK_M FOREIGN KEY (SWEEK_ID)
  REFERENCES DIM_DATE_SWEEK (SWEEK_ID);
  
ALTER TABLE FACT_POS_INV_STYLECOLOR_WEEK ADD CONSTRAINT FKFACT_POS_INV_SC_WEEK_V FOREIGN KEY (STYLE_COLOR_SIZE_ID)
  REFERENCES DIM_STYLE_COLOR_SIZE (STYLE_COLOR_SIZE_ID);

ALTER TABLE FACT_POS_INV_STYLECOLOR_WEEK ADD CONSTRAINT FKFACT_POS_INV_SC_WEEK_Y FOREIGN KEY (STYLE_YEAR_SEASON_ID)
  REFERENCES DIM_STYLE_YEAR_SEASON (STYLE_YEAR_SEASON_ID);
  
CREATE BITMAP INDEX BX1FACT_POS_INV_SC_WEEK ON FACT_POS_INV_STYLECOLOR_WEEK (SWEEK_ID)LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_POS_INV_SC_WEEK ON FACT_POS_INV_STYLECOLOR_WEEK (STORE_LOC_ID)LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_POS_INV_SC_WEEK ON FACT_POS_INV_STYLECOLOR_WEEK (STYLE_COLOR_SIZE_ID)LOCAL PARALLEL;
CREATE BITMAP INDEX BX4FACT_POS_INV_SC_WEEK ON FACT_POS_INV_STYLECOLOR_WEEK (STYLE_YEAR_SEASON_ID)LOCAL PARALLEL;

    
-- STYLE COLOR/MONTH
CREATE TABLE FACT_POS_INV_STYLECOLOR
(
  SMONTH_ID                  NUMBER(6) NOT NULL,
  STORE_LOC_ID               NUMBER(7) NOT NULL,
  STYLE_COLOR_SIZE_ID        NUMBER(7) NOT NULL,
  STYLE_YEAR_SEASON_ID       NUMBER(7) NOT NULL,  
  BEGIN_INVENTORY_UNIT       NUMBER(11),
  BEGIN_INVENTORY_RETAIL     NUMBER(15,2),
  BEGIN_INVENTORY_COST       NUMBER(15,2),
  RECEIPT_UNIT               NUMBER(11),
  RECEIPT_RETAIL             NUMBER(15,2),
  RECEIPT_COST               NUMBER(15,2),
  END_INVENTORY_UNIT         NUMBER(11),
  END_INVENTORY_RETAIL       NUMBER(15,2),
  END_INVENTORY_COST         NUMBER(15,2),
  TRANSFER_IN_UNIT           NUMBER(11),
  TRANSFER_IN_RETAIL         NUMBER(15,2),
  TRANSFER_IN_COST           NUMBER(15,2),
  TRANSFER_OUT_UNIT          NUMBER(11),
  TRANSFER_OUT_RETAIL        NUMBER(15,2),
  TRANSFER_OUT_COST          NUMBER(15,2),
  ADJUSTMENT_UNIT            NUMBER(11),
  ADJUSTMENT_RETAIL          NUMBER(15,2),
  ADJUSTMENT_COST            NUMBER(15,2)
)
PARTITION BY RANGE(SMONTH_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (201301))
COMPRESS FOR OLTP
PARALLEL NOLOGGING;

ALTER TABLE FACT_POS_INV_STYLECOLOR ADD CONSTRAINT FKFACT_POS_INV_STYLECOLOR_L FOREIGN KEY (STORE_LOC_ID)
  REFERENCES DIM_STORE_LOC (STORE_LOC_ID);
  
ALTER TABLE FACT_POS_INV_STYLECOLOR ADD CONSTRAINT FKFACT_POS_INV_STYLECOLOR_M FOREIGN KEY (SMONTH_ID)
  REFERENCES DIM_DATE_SMONTH (SMONTH_ID);
  
ALTER TABLE FACT_POS_INV_STYLECOLOR ADD CONSTRAINT FKFACT_POS_INV_STYLECOLOR_V FOREIGN KEY (STYLE_COLOR_SIZE_ID)
  REFERENCES DIM_STYLE_COLOR_SIZE (STYLE_COLOR_SIZE_ID);

ALTER TABLE FACT_POS_INV_STYLECOLOR ADD CONSTRAINT FKFACT_POS_INV_STYLECOLOR_Y FOREIGN KEY (STYLE_YEAR_SEASON_ID)
  REFERENCES DIM_STYLE_YEAR_SEASON (STYLE_YEAR_SEASON_ID);


CREATE BITMAP INDEX BX1FACT_POS_INV_STYLECOLOR ON FACT_POS_INV_STYLECOLOR (SMONTH_ID)LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_POS_INV_STYLECOLOR ON FACT_POS_INV_STYLECOLOR (STORE_LOC_ID)LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_POS_INV_STYLECOLOR ON FACT_POS_INV_STYLECOLOR (STYLE_COLOR_SIZE_ID)LOCAL PARALLEL;
CREATE BITMAP INDEX BX4FACT_POS_INV_STYLECOLOR ON FACT_POS_INV_STYLECOLOR (STYLE_YEAR_SEASON_ID)LOCAL PARALLEL;


--**************************************************************************************
--**************************************************************************************
--*******************************errorlog fact tables*********************************
--**************************************************************************************
--**************************************************************************************
--DROP TABLE FACT_ERROR_LOG PURGE;
CREATE TABLE FACT_ERROR_LOG(
DATE_ID           NUMBER(8) NOT NULL,
UPLOAD_ID         NUMBER(9) NOT NULL,
ERROR_ID          NUMBER(5) NOT NULL,
LOG_DATE          DATE      NOT NULL,
FILE_ROW_NUM      NUMBER(9) NOT NULL,
FIELD_VALUE       VARCHAR2(255) 
)
PARTITION BY RANGE(UPLOAD_ID)
INTERVAL(1)
(PARTITION P0 VALUES LESS THAN (1))
PARALLEL
NOLOGGING;

ALTER TABLE FACT_ERROR_LOG ADD CONSTRAINT FKFACT_ERROR_LOG_DATE FOREIGN KEY(DATE_ID) REFERENCES DIM_DATE_DAY(DATE_ID)  ;
ALTER TABLE FACT_ERROR_LOG ADD CONSTRAINT FKFACT_ERROR_LOG_UPLOAD FOREIGN KEY (UPLOAD_ID)REFERENCES DIM_UPLOAD_TRACKING(UPLOAD_ID) ;
ALTER TABLE FACT_ERROR_LOG ADD CONSTRAINT FKFACT_ERROR_LOG_ERROR FOREIGN KEY (ERROR_ID)REFERENCES DIM_ERROR(ERROR_ID) ;


CREATE BITMAP INDEX BX1FACT_ERROR_LOG ON FACT_ERROR_LOG(DATE_ID) LOCAL;
CREATE BITMAP INDEX BX2FACT_ERROR_LOG ON FACT_ERROR_LOG(UPLOAD_ID) LOCAL;
CREATE BITMAP INDEX BX3FACT_ERROR_LOG ON FACT_ERROR_LOG(ERROR_ID) LOCAL;


--**************************************************************************************
--**************************************************************************************
--*******************************CORE_SIZE fact tables*********************************
--**************************************************************************************
--**************************************************************************************
--DROP TABLE FACT_CORE_SIZE PURGE;

CREATE TABLE DIM_CORE_SIZE(
CORE_SIZE_ID                  NUMBER(7)   NOT NULL
CONSTRAINT PKDIM_CORE_SIZE PRIMARY KEY,
SOURCE_BUSKEY                VARCHAR2(30)NOT NULL,
PROD_CRITERIA_GROUP_ID       NUMBER(7)   NOT NULL,
LOC_CRITERIA_GROUP_ID        NUMBER(7)   NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID NUMBER(7)   NOT NULL,
BASE_UNITS_BK                NUMBER(7)   NOT NULL,
CONSTRAINT UN1DIM_CORE_SIZE UNIQUE(SOURCE_BUSKEY)
);

ALTER TABLE DIM_CORE_SIZE ADD CONSTRAINT FKDIM_CORE_SIZE_P 
FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

ALTER TABLE DIM_CORE_SIZE ADD CONSTRAINT FKDIM_CORE_SIZE_L
FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

ALTER TABLE DIM_CORE_SIZE ADD CONSTRAINT FKDIM_CORE_SIZE_YS 
FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

CREATE INDEX XIE1DIM_CORE_SIZE ON DIM_CORE_SIZE(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE2DIM_CORE_SIZE ON DIM_CORE_SIZE(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_CORE_SIZE ON DIM_CORE_SIZE(YEARSEASON_CRITERIA_GROUP_ID);

CREATE SEQUENCE SEQ_CORE_SIZE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE TABLE FACT_CORE_SIZE(
CORE_SIZE_ID                   NUMBER(7)   NOT NULL,
SIZE_ITEM_ID                   NUMBER(7)    NOT NULL,
PROD_ATTR_VALUE_ID             NUMBER(7)    NOT NULL,
STORE_LOC_ID                   NUMBER(7)    NOT NULL,
CORE_SIZE_INDICATOR            VARCHAR2(1)  NOT NULL,
CONSTRAINT PKFACT_CORE_SIZE PRIMARY KEY(CORE_SIZE_ID,SIZE_ITEM_ID,PROD_ATTR_VALUE_ID,STORE_LOC_ID)
);
ALTER TABLE FACT_CORE_SIZE ADD CONSTRAINT FKFACT_CORE_SIZE_C FOREIGN KEY(CORE_SIZE_ID) REFERENCES DIM_CORE_SIZE(CORE_SIZE_ID);
ALTER TABLE FACT_CORE_SIZE ADD CONSTRAINT FKFACT_CORE_SIZE_S FOREIGN KEY(SIZE_ITEM_ID) REFERENCES DIM_SIZE_ITEM(SIZE_ITEM_ID);
ALTER TABLE FACT_CORE_SIZE ADD CONSTRAINT FKFACT_CORE_SIZE_P FOREIGN KEY(PROD_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);
ALTER TABLE FACT_CORE_SIZE ADD CONSTRAINT FKFACT_CORE_SIZE_L FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);


CREATE INDEX XIE1FACT_CORE_SIZE ON FACT_CORE_SIZE(PROD_ATTR_VALUE_ID);
CREATE INDEX XIE2FACT_CORE_SIZE ON FACT_CORE_SIZE(STORE_LOC_ID);
CREATE INDEX XIE3FACT_CORE_SIZE ON FACT_CORE_SIZE(SIZE_ITEM_ID);
CREATE INDEX XIE4FACT_CORE_SIZE ON FACT_CORE_SIZE(CORE_SIZE_ID);

--**************************************************************************************
--**************************************************************************************
--*******************************temporary fact tables*********************************
--**************************************************************************************
--**************************************************************************************
--DROP TABLE FACT_PO_STEP1_TEMP PURGE;
CREATE GLOBAL TEMPORARY TABLE FACT_PO_STEP1_TEMP(
ACTION_FLAG                VARCHAR2(1)  NOT NULL,
TRANS_BUSKEY               VARCHAR2(30) NOT NULL,
PO_NUMBER                  VARCHAR2(30) NOT NULL,
STYLE_COLOR_SIZE_GP_ID     NUMBER(7) NOT NULL,
YEAR_SEASON_ID             NUMBER(7) NOT NULL,
STORE_LOC_ID               NUMBER(7) NOT NULL,
STATUS_ID                  NUMBER(7) NOT NULL,
START_DT                   NUMBER(8) NOT NULL,
CANCEL_DT                     NUMBER(8) NOT NULL,
IN_DC_DT                 NUMBER(8) NOT NULL,
COST                       NUMBER(9,2) NOT NULL,
RETAIL                     NUMBER(9,2) NOT NULL,
TOTAL_QTY                  NUMBER(11) NOT NULL,
TOTAL_RETAIL               NUMBER(15,2) NOT NULL,
TOTAL_COST                 NUMBER(15,2) NOT NULL,
FILE_ROW_NUM               NUMBER(9) NOT NULL
) 
ON COMMIT DELETE ROWS;


--DROP TABLE FACT_PO_STEP2_TEMP PURGE;
CREATE GLOBAL TEMPORARY TABLE FACT_PO_STEP2_TEMP(
ACTION_FLAG                VARCHAR2(1)  NOT NULL,
TRANS_BUSKEY               VARCHAR2(30) NOT NULL,
PO_NUMBER                  VARCHAR2(30) NOT NULL,
STYLE_COLOR_SIZE_GP_ID     NUMBER(7) NOT NULL,
YEAR_SEASON_ID             NUMBER(7) NOT NULL,
STORE_LOC_ID               NUMBER(7) NOT NULL,
STATUS_ID                  NUMBER(7) NOT NULL,
START_DT                   NUMBER(8) NOT NULL,
CANCEL_DT                     NUMBER(8) NOT NULL,
IN_DC_DT                 NUMBER(8) NOT NULL,
COST                       NUMBER(9,2) NOT NULL,
RETAIL                     NUMBER(9,2) NOT NULL,
TOTAL_QTY                  NUMBER(11) NOT NULL,
TOTAL_RETAIL               NUMBER(15,2) NOT NULL,
TOTAL_COST                 NUMBER(15,2) NOT NULL
) 
ON COMMIT DELETE ROWS;

--DROP TABLE FACT_ASN_STEP1_TEMP PURGE;
CREATE GLOBAL TEMPORARY TABLE FACT_ASN_STEP1_TEMP(
ACTION_FLAG                VARCHAR2(1)  NOT NULL,
TRANS_BUSKEY               VARCHAR2(30) NOT NULL,
ASN_NUMBER                 VARCHAR2(30) NOT NULL,
STYLE_COLOR_SIZE_GP_ID     NUMBER(7) NOT NULL,
YEAR_SEASON_ID             NUMBER(7) NOT NULL,
STORE_LOC_ID               NUMBER(7) NOT NULL,
STATUS_ID                  NUMBER(7) NOT NULL,
START_DT                   NUMBER(8) NOT NULL,
CANCEL_DT                  NUMBER(8) NOT NULL,
IN_DC_DT                   NUMBER(8) NOT NULL,
COST                       NUMBER(9,2) NOT NULL,
RETAIL                     NUMBER(9,2) NOT NULL,
TOTAL_QTY                  NUMBER(11) NOT NULL,
TOTAL_RETAIL               NUMBER(15,2) NOT NULL,
TOTAL_COST                 NUMBER(15,2) NOT NULL,
FILE_ROW_NUM               NUMBER(9) NOT NULL
) 
ON COMMIT DELETE ROWS;


--DROP TABLE FACT_ASN_STEP2_TEMP PURGE;
CREATE GLOBAL TEMPORARY TABLE FACT_ASN_STEP2_TEMP(
ACTION_FLAG                VARCHAR2(1)  NOT NULL,
TRANS_BUSKEY               VARCHAR2(30) NOT NULL,
ASN_NUMBER                 VARCHAR2(30) NOT NULL,
STYLE_COLOR_SIZE_GP_ID     NUMBER(7) NOT NULL,
YEAR_SEASON_ID             NUMBER(7) NOT NULL,
STORE_LOC_ID               NUMBER(7) NOT NULL,
STATUS_ID                  NUMBER(7) NOT NULL,
START_DT                   NUMBER(8) NOT NULL,
CANCEL_DT                  NUMBER(8) NOT NULL,
IN_DC_DT                   NUMBER(8) NOT NULL,
COST                       NUMBER(9,2) NOT NULL,
RETAIL                     NUMBER(9,2) NOT NULL,
TOTAL_QTY                  NUMBER(11) NOT NULL,
TOTAL_RETAIL               NUMBER(15,2) NOT NULL,
TOTAL_COST                 NUMBER(15,2) NOT NULL
) 
ON COMMIT DELETE ROWS;




--DROP TABLE FACT_RECEIVER_STEP1_TEMP PURGE;
CREATE GLOBAL TEMPORARY TABLE FACT_RECEIVER_STEP1_TEMP(
ACTION_FLAG                VARCHAR2(1)  NOT NULL,
TRANS_BUSKEY               VARCHAR2(30) NOT NULL,
RECEIVER_NUMBER            VARCHAR2(30) NOT NULL,
STYLE_COLOR_SIZE_GP_ID     NUMBER(7) NOT NULL,
YEAR_SEASON_ID             NUMBER(7) NOT NULL,
STORE_LOC_ID               NUMBER(7) NOT NULL,
STATUS_ID                  NUMBER(7) NOT NULL,
START_DT                   NUMBER(8) NOT NULL,
CANCEL_DT                     NUMBER(8) NOT NULL,
IN_DC_DT                 NUMBER(8) NOT NULL,
COST                       NUMBER(9,2) NOT NULL,
RETAIL                     NUMBER(9,2) NOT NULL,
TOTAL_QTY                  NUMBER(11) NOT NULL,
TOTAL_RETAIL               NUMBER(15,2) NOT NULL,
TOTAL_COST                 NUMBER(15,2) NOT NULL,
FILE_ROW_NUM               NUMBER(9) NOT NULL
) 
ON COMMIT DELETE ROWS;


--DROP TABLE FACT_RECEIVER_STEP2_TEMP PURGE;
CREATE GLOBAL TEMPORARY TABLE FACT_RECEIVER_STEP2_TEMP(
ACTION_FLAG                VARCHAR2(1)  NOT NULL,
TRANS_BUSKEY               VARCHAR2(30) NOT NULL,
RECEIVER_NUMBER            VARCHAR2(30) NOT NULL,
STYLE_COLOR_SIZE_GP_ID     NUMBER(7) NOT NULL,
YEAR_SEASON_ID             NUMBER(7) NOT NULL,
STORE_LOC_ID               NUMBER(7) NOT NULL,
STATUS_ID                  NUMBER(7) NOT NULL,
START_DT                   NUMBER(8) NOT NULL,
CANCEL_DT                     NUMBER(8) NOT NULL,
IN_DC_DT                 NUMBER(8) NOT NULL,
COST                       NUMBER(9,2) NOT NULL,
RETAIL                     NUMBER(9,2) NOT NULL,
TOTAL_QTY                  NUMBER(11) NOT NULL,
TOTAL_RETAIL               NUMBER(15,2) NOT NULL,
TOTAL_COST                 NUMBER(15,2) NOT NULL
) 
ON COMMIT DELETE ROWS;

CREATE SEQUENCE SEQ_TRANS_PO_ALLOCATE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_TRANS_PO_RELEASE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_TRANS_ASN_ALLOCATE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_TRANS_ASN_RELEASE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_TRANS_REC_ALLOCATE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_TRANS_REC_RELEASE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

--**************************************************************************************
--**************************************************************************************
--*******************************Transfer fact tables*********************************
--**************************************************************************************


--1,Transfer Forecast transaction
--a.  The grain is per style color size year season+per Door+per forecast
--b.  This is a snapshot of Transfer Forecast transaction with semi-accumulative measurements
--c.  The Batch dimension represents the snapshot for next 1 week or next X week, it contains when this batch runs as well as the related criteria

CREATE TABLE FACT_FORECAST_DEMAND(
TRANS_BUSKEY                      VARCHAR2(30)   NOT NULL
CONSTRAINT PKFACT_FORECAST_DEMAND PRIMARY KEY,
TRANSFER_FORECAST_ID              NUMBER(7)      NOT NULL,
STYLE_COLOR_SIZE_ID               NUMBER(7)      NOT NULL,
STYLE_YEAR_SEASON_ID              NUMBER(7)      NOT NULL,
STORE_ID                          NUMBER(7)      NOT NULL,
RULE_ID                           NUMBER(7)      NOT NULL,
AUDIT_ID                          NUMBER(12)     NOT NULL,
DEMAND_UNIT                       NUMBER(11,2)   NOT NULL,
LY_PREV_WKS_SALES_UNIT            NUMBER(11,2)   NOT NULL,
LY_NEXT_WKS_SALES_UNIT            NUMBER(11,2)   NOT NULL,
TY_PREV_WKS_SALES_UNIT            NUMBER(11,2)   NOT NULL,
SIZE_PROFILE                      NUMBER(9,8)    NOT NULL
)COMPRESS FOR OLTP;

ALTER TABLE FACT_FORECAST_DEMAND ADD CONSTRAINT FKFACT_FORECAST_DEMAND_S 
      FOREIGN KEY(STYLE_COLOR_SIZE_ID) REFERENCES DIM_STYLE_COLOR_SIZE(STYLE_COLOR_SIZE_ID);

ALTER TABLE FACT_FORECAST_DEMAND ADD CONSTRAINT FKFACT_FORECAST_DEMAND_Y 
      FOREIGN KEY(STYLE_YEAR_SEASON_ID) REFERENCES DIM_STYLE_YEAR_SEASON(STYLE_YEAR_SEASON_ID);
       
ALTER TABLE FACT_FORECAST_DEMAND ADD CONSTRAINT FKFACT_FORECAST_DEMAND_D
      FOREIGN KEY(STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID);

ALTER TABLE FACT_FORECAST_DEMAND ADD CONSTRAINT FKFACT_FORECAST_DEMAND_F
      FOREIGN KEY(TRANSFER_FORECAST_ID) REFERENCES DIM_TRANSFER_FORECAST(TRANSFER_FORECAST_ID);
    

ALTER TABLE FACT_FORECAST_DEMAND ADD CONSTRAINT FKFACT_FORECAST_DEMAND_A
      FOREIGN KEY(AUDIT_ID) REFERENCES DIM_AUDIT(AUDIT_ID);

ALTER TABLE FACT_FORECAST_DEMAND ADD CONSTRAINT FKFACT_FORECAST_DEMAND_R
      FOREIGN KEY(RULE_ID) REFERENCES DIM_RULE(RULE_ID);
            
CREATE INDEX XIE1FACT_FORECAST_DEMAND ON FACT_FORECAST_DEMAND(STYLE_COLOR_SIZE_ID);
CREATE INDEX XIE2FACT_FORECAST_DEMAND ON FACT_FORECAST_DEMAND(STORE_ID);
CREATE INDEX XIE3FACT_FORECAST_DEMAND ON FACT_FORECAST_DEMAND(TRANSFER_FORECAST_ID);
CREATE INDEX XIE4FACT_FORECAST_DEMAND ON FACT_FORECAST_DEMAND(RULE_ID);
CREATE INDEX XIE5FACT_FORECAST_DEMAND ON FACT_FORECAST_DEMAND(STYLE_YEAR_SEASON_ID);
CREATE INDEX XIE6FACT_FORECAST_DEMAND ON FACT_FORECAST_DEMAND(AUDIT_ID);


--2.  Transfer Star-schema
--a.  The grain is per style color size year season +per from location + per to location +per logical rules group + per Transfer batch.
--b.  This is a transactional fact, each row represents how many a style needs to be transferred from a location to another location given the predefined rules, the transfer transaction can be suggested or adjusted.  This should be implemented in a junked dimension.
--c.  Due to massive combinations of various of rules, Logical rules group is taken into account instead of actual rule groups.
--d.  Transfer batch dimension has only one hierarch with 2 levels: Transfer level as well as Release level.  Each level has the corresponding numbers, for example, Transfer level has Transfer #, Release level has Transfer # and Release #.
--e.  Whether it should involve all the relevant Forecast/POS_Inventory measurements calculated at the time point of Transferring  still need BAs confirmation.

CREATE TABLE FACT_TRANSFER(
TRANS_BUSKEY                       VARCHAR2(30)  NOT NULL
CONSTRAINT PKFACT_TRANSFER PRIMARY KEY,
TRANSFER_TRANSFER_ID               NUMBER(7)     NOT NULL,
STYLE_COLOR_SIZE_ID                NUMBER(7)     NOT NULL,
STYLE_YEAR_SEASON_ID               NUMBER(7)     NOT NULL,
FROM_LOC_ID                        NUMBER(7)     NOT NULL,
TO_LOC_ID                          NUMBER(7)     NOT NULL,
FROM_RULE_ID                       NUMBER(7)     NOT NULL,
TO_RULE_ID                         NUMBER(7)     NOT NULL,
TRANSFER_PRIORITY_ID                NUMBER(7)     NOT NULL,
STATUS_ID                          NUMBER(7)     NOT NULL,--SUGGESTED OR ADJUSTED
AUDIT_ID                           NUMBER(12)    NOT NULL,
TRANSFER_UNIT                      NUMBER(13)    NOT NULL
)
COMPRESS FOR OLTP;

ALTER TABLE FACT_TRANSFER ADD CONSTRAINT FKFACT_TRANSFER_SC 
      FOREIGN KEY(STYLE_COLOR_SIZE_ID) REFERENCES DIM_STYLE_COLOR_SIZE(STYLE_COLOR_SIZE_ID);

ALTER TABLE FACT_TRANSFER ADD CONSTRAINT FKFACT_TRANSFER_YS 
      FOREIGN KEY(STYLE_YEAR_SEASON_ID) REFERENCES DIM_STYLE_YEAR_SEASON(STYLE_YEAR_SEASON_ID);
        
ALTER TABLE FACT_TRANSFER ADD CONSTRAINT FKFACT_TRANSFER_FL
      FOREIGN KEY(FROM_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_TRANSFER ADD CONSTRAINT FKFACT_TRANSFER_TL
      FOREIGN KEY(TO_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);
      
ALTER TABLE FACT_TRANSFER ADD CONSTRAINT FKFACT_TRANSFER_ST
      FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

ALTER TABLE FACT_TRANSFER ADD CONSTRAINT FKFACT_TRANSFER_TT
      FOREIGN KEY(TRANSFER_TRANSFER_ID) REFERENCES DIM_TRANSFER_TRANSFER(TRANSFER_TRANSFER_ID);


ALTER TABLE FACT_TRANSFER ADD CONSTRAINT FKFACT_TRANSFER_A
      FOREIGN KEY(AUDIT_ID) REFERENCES DIM_AUDIT(AUDIT_ID);

ALTER TABLE FACT_TRANSFER ADD CONSTRAINT FKFACT_TRANSFER_FR
      FOREIGN KEY(FROM_RULE_ID) REFERENCES DIM_RULE(RULE_ID);


ALTER TABLE FACT_TRANSFER ADD CONSTRAINT FKFACT_TRANSFER_TR
      FOREIGN KEY(TO_RULE_ID) REFERENCES DIM_RULE(RULE_ID);
      
ALTER TABLE FACT_TRANSFER ADD CONSTRAINT FKFACT_TRANSFER_TP
      FOREIGN KEY(TRANSFER_PRIORITY_ID) REFERENCES DIM_TRANSFER_PRIORITY(TRANSFER_PRIORITY_ID);      
      
                
CREATE INDEX XIE1FACT_TRANSFER ON FACT_TRANSFER(STYLE_COLOR_SIZE_ID);
CREATE INDEX XIE2FACT_TRANSFER ON FACT_TRANSFER(FROM_LOC_ID);
CREATE INDEX XIE3FACT_TRANSFER ON FACT_TRANSFER(TO_LOC_ID);
CREATE INDEX XIE4FACT_TRANSFER ON FACT_TRANSFER(STATUS_ID);
CREATE INDEX XIE5FACT_TRANSFER ON FACT_TRANSFER(TRANSFER_PRIORITY_ID);
CREATE INDEX XIE6FACT_TRANSFER ON FACT_TRANSFER(TRANSFER_TRANSFER_ID);
CREATE INDEX XIE7FACT_TRANSFER ON FACT_TRANSFER(STYLE_YEAR_SEASON_ID);
CREATE INDEX XIE8FACT_TRANSFER ON FACT_TRANSFER(AUDIT_ID);  
CREATE INDEX XIE9FACT_TRANSFER ON FACT_TRANSFER(FROM_RULE_ID);  
CREATE INDEX XIE10FACT_TRANSFER ON FACT_TRANSFER(TO_RULE_ID);  


      
--3.  Transfer Release Star-schema
--a.	The grain is per style color size year season + per from location + per to location + Release batch.
--b.	This is a transactional fact, each row represents how many a style needs to be indeed transferred from a location to another location and this is the real released data. 
--c.	Release batch is the 2nd level in Transfer dimension. 

CREATE TABLE FACT_TRANSFER_RELEASE(
TRANS_BUSKEY                       VARCHAR2(30)  NOT NULL
CONSTRAINT PKFACT_TRANSFER_RELEASE PRIMARY KEY,
RELEASE_NUMBER                     VARCHAR2(60)  NOT NULL,
TRANSFER_RELEASE_ID                NUMBER(7)     NOT NULL,
STYLE_COLOR_SIZE_ID                NUMBER(7)     NOT NULL,
STYLE_YEAR_SEASON_ID               NUMBER(7)     NOT NULL,
FROM_LOC_ID                        NUMBER(7)     NOT NULL,
TO_LOC_ID                          NUMBER(7)     NOT NULL,
STATUS_ID                          NUMBER(7)     NOT NULL,--RELEASED/APO
AUDIT_ID                           NUMBER(12)    NOT NULL,
RELEASE_UNIT                       NUMBER(13)    NOT NULL
)
COMPRESS FOR OLTP;

ALTER TABLE FACT_TRANSFER_RELEASE ADD CONSTRAINT FKFACT_TRANSFER_RELEASE_SC 
      FOREIGN KEY(STYLE_COLOR_SIZE_ID) REFERENCES DIM_STYLE_COLOR_SIZE(STYLE_COLOR_SIZE_ID);

ALTER TABLE FACT_TRANSFER_RELEASE ADD CONSTRAINT FKFACT_TRANSFER_RELEASE_YS 
      FOREIGN KEY(STYLE_YEAR_SEASON_ID) REFERENCES DIM_STYLE_YEAR_SEASON(STYLE_YEAR_SEASON_ID);
      
ALTER TABLE FACT_TRANSFER_RELEASE ADD CONSTRAINT FKFACT_TRANSFER_RELEASE_FL 
      FOREIGN KEY(FROM_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_TRANSFER_RELEASE ADD CONSTRAINT FKFACT_TRANSFER_RELEASE_TL
      FOREIGN KEY(TO_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_TRANSFER_RELEASE ADD CONSTRAINT FKFACT_TRANSFER_RELEASE_TR
      FOREIGN KEY(TRANSFER_RELEASE_ID) REFERENCES DIM_TRANSFER_RELEASE(TRANSFER_RELEASE_ID);

ALTER TABLE FACT_TRANSFER_RELEASE ADD CONSTRAINT FKFACT_TRANSFER_RELEASE_ST
      FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

ALTER TABLE FACT_TRANSFER_RELEASE ADD CONSTRAINT FKFACT_TRANSFER_RELEASE_A
      FOREIGN KEY(AUDIT_ID) REFERENCES DIM_AUDIT(AUDIT_ID);

CREATE INDEX XIE1FACT_TRANSFER_RELEASE ON FACT_TRANSFER_RELEASE(STYLE_COLOR_SIZE_ID);
CREATE INDEX XIE2FACT_TRANSFER_RELEASE ON FACT_TRANSFER_RELEASE(FROM_LOC_ID);
CREATE INDEX XIE3FACT_TRANSFER_RELEASE ON FACT_TRANSFER_RELEASE(TO_LOC_ID);
CREATE INDEX XIE4FACT_TRANSFER_RELEASE ON FACT_TRANSFER_RELEASE(TRANSFER_RELEASE_ID);
CREATE INDEX XIE5FACT_TRANSFER_RELEASE ON FACT_TRANSFER_RELEASE(STYLE_YEAR_SEASON_ID);
CREATE INDEX XIE6FACT_TRANSFER_RELEASE ON FACT_TRANSFER_RELEASE(STATUS_ID);
CREATE INDEX XIE7FACT_TRANSFER_RELEASE ON FACT_TRANSFER_RELEASE(AUDIT_ID);
CREATE INDEX XIE8FACT_TRANSFER_RELEASE ON FACT_TRANSFER_RELEASE(RELEASE_NUMBER);

--This is a Periodical Snapshot fact, each row represents the sales/inventory info for each door and each SKU for a given tranfering time point
CREATE TABLE FACT_TRANSFER_SNAPSHOT(
TRANSFER_TRANSFER_ID                   NUMBER(7)     NOT NULL,
STYLE_COLOR_SIZE_ID                    NUMBER(7)     NOT NULL,
STYLE_YEAR_SEASON_ID                   NUMBER(7)     NOT NULL,
STORE_LOC_ID                           NUMBER(7)     NOT NULL,
SALES_UNIT_LAST1W                      NUMBER(11)    NOT NULL,
SALES_UNIT_LASTXW                      NUMBER(11)    NOT NULL,
SALES_UNIT_LASTTW                      NUMBER(11)    NOT NULL,
END_INVENTORY_UNIT                     NUMBER(11)    NOT NULL,
NUM_OF_WEEKS_IN_STOCK                  NUMBER(7)     NOT NULL,
WEEK_OF_SUPPLY                         NUMBER(7,2)   NOT NULL,
SUPPLY_UNIT                            NUMBER(11)    NOT NULL,
DEMAND_UNIT                            NUMBER(11)    NOT NULL,
SEASON_TO_DAY_SALES_UNIT               NUMBER(11)    NOT NULL,
IN_TRANSIT_UNIT                        NUMBER(11)    NOT NULL,
FORECAST_UNIT_NEXT1W                   NUMBER(13,2)  NOT NULL,
FORECAST_UNIT_NEXTTW                   NUMBER(13,2)  NOT NULL
)PARTITION BY RANGE(TRANSFER_TRANSFER_ID)
  INTERVAL(1)
  SUBPARTITION BY HASH(STYLE_COLOR_SIZE_ID) SUBPARTITIONS 8
  (PARTITION P0 VALUES LESS THAN (1)
      )
COMPRESS FOR OLTP;


ALTER TABLE FACT_TRANSFER_SNAPSHOT ADD CONSTRAINT FKFACT_TRANSFER_SNAPSHOT_T
      FOREIGN KEY(TRANSFER_TRANSFER_ID) REFERENCES DIM_TRANSFER_TRANSFER(TRANSFER_TRANSFER_ID);

ALTER TABLE FACT_TRANSFER_SNAPSHOT ADD CONSTRAINT FKFACT_TRANSFER_SNAPSHOT_SC
      FOREIGN KEY(STYLE_COLOR_SIZE_ID) REFERENCES DIM_STYLE_COLOR_SIZE(STYLE_COLOR_SIZE_ID);

ALTER TABLE FACT_TRANSFER_SNAPSHOT ADD CONSTRAINT FKFACT_TRANSFER_SNAPSHOT_SY
      FOREIGN KEY(STYLE_YEAR_SEASON_ID) REFERENCES DIM_STYLE_YEAR_SEASON(STYLE_YEAR_SEASON_ID);

ALTER TABLE FACT_TRANSFER_SNAPSHOT ADD CONSTRAINT FKFACT_TRANSFER_SNAPSHOT_SL
      FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);                  

CREATE BITMAP INDEX BX1FACT_TRANSFER_SNAPSHOT ON FACT_TRANSFER_SNAPSHOT(TRANSFER_TRANSFER_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_TRANSFER_SNAPSHOT ON FACT_TRANSFER_SNAPSHOT(STYLE_COLOR_SIZE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_TRANSFER_SNAPSHOT ON FACT_TRANSFER_SNAPSHOT(STYLE_YEAR_SEASON_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX4FACT_TRANSFER_SNAPSHOT ON FACT_TRANSFER_SNAPSHOT(STORE_LOC_ID) LOCAL PARALLEL;



CREATE SEQUENCE SEQ_TRANS_FORECAST_DEMAND
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_TRANS_TRANSFER
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;


CREATE SEQUENCE SEQ_TRANS_TRANSFER_RELEASE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;


CREATE SEQUENCE SEQ_TRANSFER_SPREAD_DC
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE SEQ_TRANS_SPREAD_DC
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE TABLE DIM_TRANSFER_SPREAD_DC(
TRANSFER_SPREAD_DC_ID    NUMBER(7) NOT NULL
CONSTRAINT PKDIM_TRANSFER_SPREAD_DC PRIMARY KEY,
SOURCE_BUSKEY            VARCHAR2(30) NOT NULL,
SPREAD_DC_DATE           DATE NOT NULL,
SPREAD_DC_DT             NUMBER(8) NOT NULL,
SPREAD_DC_NAME           VARCHAR2(30) NOT NULL,
PROD_CRITERIA_GROUP_ID  NUMBER(7) NOT NULL,
LOC_CRITERIA_GROUP_ID   NUMBER(7) NOT NULL
);

ALTER TABLE DIM_TRANSFER_SPREAD_DC ADD CONSTRAINT FKDIM_TRANSFER_SPREAD_DC_P
FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

ALTER TABLE DIM_TRANSFER_SPREAD_DC ADD CONSTRAINT FKDIM_TRANSFER_SPREAD_DC_L
FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

CREATE INDEX XIE1DIM_TRANSFER_SPREAD_DC ON DIM_TRANSFER_SPREAD_DC(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE2DIM_TRANSFER_SPREAD_DC ON DIM_TRANSFER_SPREAD_DC(LOC_CRITERIA_GROUP_ID);


CREATE TABLE FACT_SPREAD_DC(
TRANS_BUSKEY             VARCHAR2(30) NOT NULL
CONSTRAINT PKFACT_SPREAD_DC PRIMARY KEY,
TRANSFER_SPREAD_DC_ID    NUMBER(7) NOT NULL,
PARENT_STORE_LOC_ID      NUMBER(7) NOT NULL,
DATE_ID                  NUMBER(8) NOT NULL,
STYLE_COLOR_SIZE_ID      NUMBER(7) NOT NULL,
STYLE_YEAR_SEASON_ID     NUMBER(7) NOT NULL,
STORE_LOC_ID             NUMBER(7) NOT NULL,
RULE_ID                  NUMBER(7) NOT NULL,
AUDIT_ID                 NUMBER(12)NOT NULL,
END_INVENTORY_UNIT       NUMBER(13) NOT NULL
);


ALTER TABLE FACT_SPREAD_DC ADD CONSTRAINT FKFACT_SPREAD_DC_T 
FOREIGN KEY(TRANSFER_SPREAD_DC_ID) REFERENCES DIM_TRANSFER_SPREAD_DC(TRANSFER_SPREAD_DC_ID);

ALTER TABLE FACT_SPREAD_DC ADD CONSTRAINT FKFACT_SPREAD_DC_S
FOREIGN KEY(STYLE_COLOR_SIZE_ID) REFERENCES DIM_STYLE_COLOR_SIZE(STYLE_COLOR_SIZE_ID);

ALTER TABLE FACT_SPREAD_DC ADD CONSTRAINT FKFACT_SPREAD_DC_YS
FOREIGN KEY(STYLE_YEAR_SEASON_ID) REFERENCES DIM_STYLE_YEAR_SEASON(STYLE_YEAR_SEASON_ID);

ALTER TABLE FACT_SPREAD_DC ADD CONSTRAINT FKFACT_SPREAD_DC_L
FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);


ALTER TABLE FACT_SPREAD_DC ADD CONSTRAINT FKFACT_SPREAD_DC_D 
      FOREIGN KEY(DATE_ID) REFERENCES DIM_DATE_DAY(DATE_ID);
      
ALTER TABLE FACT_SPREAD_DC ADD CONSTRAINT FKFACT_SPREAD_DC_A 
      FOREIGN KEY(AUDIT_ID) REFERENCES DIM_AUDIT(AUDIT_ID);      

ALTER TABLE FACT_SPREAD_DC
  ADD CONSTRAINT FKFACT_SPREAD_DC_P_L FOREIGN KEY (PARENT_STORE_LOC_ID)
  REFERENCES DIM_STORE_LOC (STORE_LOC_ID);

ALTER TABLE FACT_SPREAD_DC
  ADD CONSTRAINT FKFACT_SPREAD_DC_R FOREIGN KEY (RULE_ID)
  REFERENCES DIM_RULE(RULE_ID)
    
CREATE INDEX XIE1FACT_SPREAD_DC ON FACT_SPREAD_DC(TRANSFER_SPREAD_DC_ID);
CREATE INDEX XIE2FACT_SPREAD_DC ON FACT_SPREAD_DC(STYLE_COLOR_SIZE_ID);
CREATE INDEX XIE3FACT_SPREAD_DC ON FACT_SPREAD_DC(STYLE_YEAR_SEASON_ID);
CREATE INDEX XIE4FACT_SPREAD_DC ON FACT_SPREAD_DC(STORE_LOC_ID);
CREATE INDEX XIE5FACT_SPREAD_DC ON FACT_SPREAD_DC(RULE_ID);
CREATE INDEX XIE6FACT_SPREAD_DC ON FACT_SPREAD_DC(DATE_ID);
CREATE INDEX XIE7FACT_SPREAD_DC ON FACT_SPREAD_DC(AUDIT_ID);
CREATE INDEX XIE8FACT_SPREAD_DC ON FACT_SPREAD_DC (PARENT_STORE_LOC_ID);

CREATE GLOBAL TEMPORARY TABLE DIM_STYLE_YEAR_SEASON_TEMP
(
  SOURCE_BUSKEY        VARCHAR2(60) NOT NULL,
  STYLE_COLOR_ID       NUMBER(7) NOT NULL,
  SMONTH_ID            NUMBER(6) NOT NULL,
  YEAR_SEASON_ID       NUMBER(5) NOT NULL,
  REAL_YEAR_SEASON_ID  NUMBER(5) NOT NULL
)ON COMMIT PRESERVE ROWS;

CREATE INDEX XIE1DIM_STYLE_YEAR_SEASON_TEMP ON DIM_STYLE_YEAR_SEASON_TEMP(SOURCE_BUSKEY);

CREATE INDEX XIE2DIM_STYLE_YEAR_SEASON_TEMP ON DIM_STYLE_YEAR_SEASON_TEMP(STYLE_COLOR_ID,SMONTH_ID);

CREATE GLOBAL TEMPORARY TABLE FACT_TRANSFER_TEMP(
TRANS_BUSKEY                       VARCHAR2(30)  NOT NULL
CONSTRAINT PKFACT_TRANSFER_TEMP PRIMARY KEY,
TRANSFER_TRANSFER_ID               NUMBER(7)     NOT NULL,
STYLE_COLOR_SIZE_ID                NUMBER(7)     NOT NULL,
STYLE_YEAR_SEASON_ID               NUMBER(7)     NOT NULL,
FROM_LOC_ID                        NUMBER(7)     NOT NULL,
TO_LOC_ID                          NUMBER(7)     NOT NULL,
FROM_RULE_ID                       NUMBER(7)     NOT NULL,
TO_RULE_ID                         NUMBER(7)     NOT NULL,
TRANSFER_PRIORITY_ID                NUMBER(7)     NOT NULL,
STATUS_ID                          NUMBER(7)     NOT NULL,--SUGGESTED OR ADJUSTED
AUDIT_ID                           NUMBER(12)    NOT NULL,
TRANSFER_UNIT                      NUMBER(13)    NOT NULL,
ACTION_FLAG                        CHAR          NOT NULL--A/M/D
)ON COMMIT DELETE ROWS;


--FACT_STYLE_BUYER_DETAIL
--this is a factless fact, the grain is per style color+per year season+per loc attr group
--sourcing from style_color_buyer_season as well as style_color_buyer_attr_child
--DROP TABLE FACT_STYLE_BUYER_DETAIL;
CREATE TABLE FACT_STYLE_BUYER_DETAIL(
STYLE_COLOR_ID          NUMBER(7)     NOT NULL,
YEAR_SEASON_ID          NUMBER(7)     NOT NULL,
LOC_ATTR_VALUE_ID       NUMBER(7)     NOT NULL,
UNIT_PRICE              NUMBER(9,2)   NOT NULL,
SUGGESTED_RETAIL_PRICE  NUMBER(9,2)   NOT NULL,
POS_OWNED_RETAIL        NUMBER(9,2)   NOT NULL,
POS_OWNED_COST          NUMBER(9,2)   NOT NULL,
OWNED_RETAIL            NUMBER(9,2)   NOT NULL,
OWNED_COST              NUMBER(9,2)   NOT NULL,
SITE_ACTIVATION_DATE    DATE          NOT NULL,
SITE_DEACTIVATION_DATE  DATE          NOT NULL,
MINIMUM_1               NUMBER(10)    NOT NULL,
MINIMUM_2               NUMBER(10)    NOT NULL,
CONSTRAINT PKFACT_STYLE_BUYER_DETAIL PRIMARY KEY(STYLE_COLOR_ID,YEAR_SEASON_ID,LOC_ATTR_VALUE_ID)
);

ALTER TABLE FACT_STYLE_BUYER_DETAIL ADD CONSTRAINT FKFACT_STYLE_BUYER_DETAIL_S 
FOREIGN KEY(STYLE_COLOR_ID) REFERENCES DIM_STYLE_COLOR(STYLE_COLOR_ID);

ALTER TABLE FACT_STYLE_BUYER_DETAIL ADD CONSTRAINT FKFACT_STYLE_BUYER_DETAIL_YS
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_STYLE_BUYER_DETAIL ADD CONSTRAINT FKFACT_STYLE_BUYER_DETAIL_L
FOREIGN KEY(LOC_ATTR_VALUE_ID) REFERENCES DIM_LOC_ATTR_VALUE(LOC_ATTR_VALUE_ID);

CREATE INDEX XIE1FACT_STYLE_BUYER_DETAIL ON FACT_STYLE_BUYER_DETAIL(STYLE_COLOR_ID);
CREATE INDEX XIE2FACT_STYLE_BUYER_DETAIL ON FACT_STYLE_BUYER_DETAIL(YEAR_SEASON_ID);
CREATE INDEX XIE3FACT_STYLE_BUYER_DETAIL ON FACT_STYLE_BUYER_DETAIL(LOC_ATTR_VALUE_ID);



--**************************************************************************************
--*****************************CMM_TRANSFER**************************************
CREATE TABLE CMM_TRANSFER_RAW(
CORPORATE_DIVISION       VARCHAR2(60),
VENDOR_REF_NUMBER        VARCHAR2(20),
TRACKING_NUMBER          VARCHAR2(20),--???
CURRENT_YEAR             NUMBER(4),
CURRENT_MONTH            NUMBER(2),
UPC                      VARCHAR2(14),
STYLE_NUMBER             VARCHAR2(40),
COLOR_CODE               VARCHAR2(20),
COLOR_NAME               VARCHAR2(100),
SIZE_CODE                VARCHAR2(20),
SIZE_DESC1               VARCHAR2(40),
SIZE_DESC2               VARCHAR2(40), 
COST                     NUMBER(9,2),
RETAIL                   NUMBER(9,2),
SENDING_DOOR_NUM         VARCHAR2(13),
RECEIVING_DOOR_NUM       VARCHAR2(13),
DOOR_QTY                 NUMBER(11),
TOTAL_RETAIL             NUMBER(15,2),
TOTAL_COST               NUMBER(15,2),
CURRENT_WEEK             NUMBER(2),
COUNTRY                  VARCHAR2(30),
UNIQUE_KEY_ATTR1         VARCHAR2(50),
UNIQUE_KEY_ATTR2         VARCHAR2(50),
UNIQUE_KEY_ATTR3         VARCHAR2(50),
UNIQUE_KEY_ATTR4         VARCHAR2(50),
UNIQUE_KEY_ATTR5         VARCHAR2(50),
UNIQUE_KEY_ATTR6         VARCHAR2(50),
SENDING_DC               VARCHAR2(13),
CURRENT_DAY              NUMBER(3),
START_DATE               VARCHAR2(8),
RECEIVING_DATE           VARCHAR2(8),
TRANSACTION_DATE         VARCHAR2(8),
FILE_ROW_NUM             NUMBER(9) DEFAULT 0 NOT NULL,
UPLOAD_ID                NUMBER(9) NOT NULL
)
PARTITION BY RANGE(UPLOAD_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (1))
NOLOGGING;



--DROP TABLE FACT_CMM_TRANSFER PURGE;
CREATE TABLE FACT_CMM_TRANSFER(
TRANS_BUSKEY                     VARCHAR2(30)NOT NULL,
STYLE_COLOR_SIZE_ID              NUMBER(7)   NOT NULL,
SENDING_LOC_ID                   NUMBER(7)   NOT NULL,
RECEIVING_LOC_ID                 NUMBER(7)   NOT NULL,
TYPE_ID                          NUMBER(7)   NOT NULL,--SYSTEM SUGGESTED/USER UPLOADED
DATE_ID                          NUMBER(8)   NOT NULL,
START_DATE                       DATE        NOT NULL,
RECEIVING_DATE                   DATE        NOT NULL,
START_DT                         NUMBER(8)   NOT NULL,
RECEIVING_DT                     NUMBER(8)   NOT NULL,
DOOR_QTY                         NUMBER(11)  NOT NULL,
COST                             NUMBER(9,2) NOT NULL,
RETAIL                           NUMBER(9,2) NOT NULL,
TOTAL_RETAIL                     NUMBER(15,2)NOT NULL,
TOTAL_COST                       NUMBER(15,2)NOT NULL,
CONSTRAINT PKFACT_CMM_TRANSFER PRIMARY KEY(DATE_ID,STYLE_COLOR_SIZE_ID,SENDING_LOC_ID,RECEIVING_LOC_ID,TYPE_ID,TRANS_BUSKEY)
)PARTITION BY RANGE(DATE_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (20130101)
      )
COMPRESS FOR OLTP
PARALLEL;

ALTER TABLE FACT_CMM_TRANSFER ADD CONSTRAINT FKFACT_CMM_TRANSFER_S
FOREIGN KEY(STYLE_COLOR_SIZE_ID) REFERENCES DIM_STYLE_COLOR_SIZE(STYLE_COLOR_SIZE_ID);

ALTER TABLE FACT_CMM_TRANSFER ADD CONSTRAINT FKFACT_CMM_TRANSFER_SL
FOREIGN KEY(SENDING_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_CMM_TRANSFER ADD CONSTRAINT FKFACT_CMM_TRANSFER_RL
FOREIGN KEY(RECEIVING_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_CMM_TRANSFER ADD CONSTRAINT FKFACT_CMM_TRANSFER_D
FOREIGN KEY(DATE_ID) REFERENCES DIM_DATE_DAY(DATE_ID);

ALTER TABLE FACT_CMM_TRANSFER ADD CONSTRAINT FKFACT_CMM_TRANSFER_T
FOREIGN KEY(TYPE_ID) REFERENCES DIM_COMMON(COMMON_ID);

CREATE BITMAP INDEX BX1FACT_CMM_TRANSFER ON FACT_CMM_TRANSFER(STYLE_COLOR_SIZE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX2FACT_CMM_TRANSFER ON FACT_CMM_TRANSFER(SENDING_LOC_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX3FACT_CMM_TRANSFER ON FACT_CMM_TRANSFER(RECEIVING_LOC_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX4FACT_CMM_TRANSFER ON FACT_CMM_TRANSFER(DATE_ID) LOCAL PARALLEL;
CREATE BITMAP INDEX BX6FACT_CMM_TRANSFER ON FACT_CMM_TRANSFER(START_DT) LOCAL PARALLEL;
CREATE BITMAP INDEX BX7FACT_CMM_TRANSFER ON FACT_CMM_TRANSFER(RECEIVING_DT) LOCAL PARALLEL;
CREATE BITMAP INDEX BX8FACT_CMM_TRANSFER ON FACT_CMM_TRANSFER(TRANS_BUSKEY) LOCAL PARALLEL;
CREATE BITMAP INDEX BX9FACT_CMM_TRANSFER ON FACT_CMM_TRANSFER(TYPE_ID) LOCAL PARALLEL;


CREATE GLOBAL TEMPORARY TABLE FACT_CMM_TRANSFER_STEP1_TEMP(
TRANS_BUSKEY                     VARCHAR2(30)NOT NULL,
STYLE_COLOR_SIZE_ID              NUMBER(7)   NOT NULL,
SENDING_LOC_ID                   NUMBER(7)   NOT NULL,
RECEIVING_LOC_ID                 NUMBER(7)   NOT NULL,
TYPE_ID                          NUMBER(7)   NOT NULL,--SYSTEM SUGGESTED/USER UPLOADED
DATE_ID                          NUMBER(8)   NOT NULL,
START_DATE                       DATE        NOT NULL,
RECEIVING_DATE                   DATE        NOT NULL,
START_DT                         NUMBER(8)   NOT NULL,
RECEIVING_DT                     NUMBER(8)   NOT NULL,
DOOR_QTY                         NUMBER(11)  NOT NULL,
COST                             NUMBER(9,2) NOT NULL,
RETAIL                           NUMBER(9,2) NOT NULL,
TOTAL_RETAIL                     NUMBER(15,2)NOT NULL,
TOTAL_COST                       NUMBER(15,2)NOT NULL,
FILE_ROW_NUM                     NUMBER(9)   NOT NULL
) ON COMMIT DELETE ROWS;


CREATE GLOBAL TEMPORARY TABLE FACT_CMM_TRANSFER_STEP2_TEMP(
TRANS_BUSKEY                     VARCHAR2(30)NOT NULL,
STYLE_COLOR_SIZE_ID              NUMBER(7)   NOT NULL,
SENDING_LOC_ID                   NUMBER(7)   NOT NULL,
RECEIVING_LOC_ID                 NUMBER(7)   NOT NULL,
TYPE_ID                          NUMBER(7)   NOT NULL,--SYSTEM SUGGESTED/USER UPLOADED
DATE_ID                          NUMBER(8)   NOT NULL,
START_DATE                       DATE        NOT NULL,
RECEIVING_DATE                   DATE        NOT NULL,
START_DT                         NUMBER(8)   NOT NULL,
RECEIVING_DT                     NUMBER(8)   NOT NULL,
DOOR_QTY                         NUMBER(11)  NOT NULL,
COST                             NUMBER(9,2) NOT NULL,
RETAIL                           NUMBER(9,2) NOT NULL,
TOTAL_RETAIL                     NUMBER(15,2)NOT NULL,
TOTAL_COST                       NUMBER(15,2)NOT NULL
) ON COMMIT DELETE ROWS;

--**************************************************************************************
--********************************FACT_PROMOTION*************************************
CREATE TABLE DIM_PROMOTION_SCOPE(
PROMOTION_SCOPE_ID                  NUMBER(7)   NOT NULL
CONSTRAINT PKDIM_PROMOTION_SCOPE PRIMARY KEY,
SOURCE_BUSKEY                       VARCHAR2(30)NOT NULL, --BASE_UNITS_BK+PROD_CRITERIA_GROUP_ID+LOC_CRITERIA_GROUP_ID+YEARSEASON_CRITERIA_GROUP_ID
PROD_CRITERIA_GROUP_ID              NUMBER(7)   NOT NULL,
LOC_CRITERIA_GROUP_ID               NUMBER(7)   NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID        NUMBER(7)   NOT NULL,
BASE_UNITS_BK                       NUMBER(7)   NOT NULL  --BASE_UNITS_BK
CONSTRAINT UN1DIM_PROMOTION_SCOPE UNIQUE(SOURCE_BUSKEY)
);

ALTER TABLE DIM_PROMOTION_SCOPE ADD CONSTRAINT UN2DIM_PROMOTION_SCOPE
UNIQUE(PROD_CRITERIA_GROUP_ID,LOC_CRITERIA_GROUP_ID,YEARSEASON_CRITERIA_GROUP_ID);

ALTER TABLE DIM_PROMOTION_SCOPE ADD CONSTRAINT FKDIM_PROMOTION_SCOPE_P
FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

ALTER TABLE DIM_PROMOTION_SCOPE ADD CONSTRAINT FKDIM_PROMOTION_SCOPE_L
FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

ALTER TABLE DIM_PROMOTION_SCOPE ADD CONSTRAINT FKDIM_PROMOTION_SCOPE_YS
FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

CREATE INDEX XIE1DIM_PROMOTION_SCOPE ON DIM_PROMOTION_SCOPE(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE2DIM_PROMOTION_SCOPE ON DIM_PROMOTION_SCOPE(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_PROMOTION_SCOPE ON DIM_PROMOTION_SCOPE(YEARSEASON_CRITERIA_GROUP_ID);


CREATE SEQUENCE SEQ_PROMOTION_SCOPE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

--THIS IS PROMOTION DIMENSION WITH HIERARCHY:
--SALES_STYLE-->PROMOTION
--SCD1
--EACH RECORD REPRESENTS A PROMOTION
CREATE TABLE DIM_PROMOTION(
PROMOTION_ID            NUMBER(7)     NOT NULL
CONSTRAINT PKDIM_PROMOTION PRIMARY KEY,
SOURCE_BUSKEY           VARCHAR2(60)  NOT NULL,
SALES_STYLE_ID          NUMBER(5)     NOT NULL,
GROUP_CODE              VARCHAR2(60)  NOT NULL,
GROUP_NAME              VARCHAR2(60)  NOT NULL,
TYPE                    VARCHAR2(60)  NOT NULL,--PROMOTION_TYPE
CODE                    VARCHAR2(60)  NOT NULL,--PROMOTION_CODE
NAME                    VARCHAR2(60)  NOT NULL,--PROMOTION_NAME
START_DATE              DATE          NOT NULL,
END_DATE                DATE          NOT NULL,
PROMO_PERCENT           NUMBER(11,4)  NOT NULL,
CONSTRAINT UN1DIM_PROMOTION UNIQUE(SOURCE_BUSKEY)
);

ALTER TABLE DIM_PROMOTION ADD CONSTRAINT FKDIM_PROMOTION_SS
FOREIGN KEY(SALES_STYLE_ID) REFERENCES DIM_SALES_STYLE(SALES_STYLE_ID);

CREATE INDEX XIE1DIM_PROMOTION ON DIM_PROMOTION(SALES_STYLE_ID);


CREATE SEQUENCE SEQ_PROMOTION
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;




--THIS IS PROMOTION FACT, FACTLESS FACT
--THE GRAIN IS PER style color+PER door + PER YEARSEASON  
CREATE TABLE FACT_PROMOTION_SC_DOOR(
PROMOTION_SCOPE_ID             NUMBER(7)     NOT NULL,
PROMOTION_ID                   NUMBER(7)     NOT NULL,
STYLE_COLOR_ID                 NUMBER(7)     NOT NULL,
STORE_ID                       NUMBER(7)     NOT NULL,
YEAR_SEASON_ID                 NUMBER(7)     NOT NULL,
STATUS_ID                      NUMBER(7)     NOT NULL,
TARGET_INVENTORY               NUMBER(11)    NOT NULL,
STYLE_COLOR_MIN_INVENTORY      NUMBER(11)    NOT NULL,
CONSTRAINT PKFACT_PROMOTION_SC_DOOR PRIMARY KEY(PROMOTION_ID,STYLE_COLOR_ID,STORE_ID,YEAR_SEASON_ID,STATUS_ID)
);


ALTER TABLE FACT_PROMOTION_SC_DOOR ADD CONSTRAINT FKFACT_PROMOTION_SC_DOOR_P
FOREIGN KEY(PROMOTION_ID) REFERENCES DIM_PROMOTION(PROMOTION_ID);

ALTER TABLE FACT_PROMOTION_SC_DOOR ADD CONSTRAINT FKFACT_PROMOTION_SC_DOOR_SC
FOREIGN KEY(STYLE_COLOR_ID) REFERENCES DIM_STYLE_COLOR(STYLE_COLOR_ID);

ALTER TABLE FACT_PROMOTION_SC_DOOR ADD CONSTRAINT FKFACT_PROMOTION_SC_DOOR_L
FOREIGN KEY(STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID);

ALTER TABLE FACT_PROMOTION_SC_DOOR ADD CONSTRAINT FKFACT_PROMOTION_SC_DOOR_YS
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_PROMOTION_SC_DOOR ADD CONSTRAINT FKFACT_PROMOTION_SC_DOOR_ST
FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

ALTER TABLE FACT_PROMOTION_SC_DOOR ADD CONSTRAINT FKFACT_PROMOTION_SC_DOOR_PS
FOREIGN KEY(PROMOTION_SCOPE_ID) REFERENCES DIM_PROMOTION_SCOPE(PROMOTION_SCOPE_ID);

CREATE INDEX XIE1FACT_PROMOTION_SC_DOOR ON FACT_PROMOTION_SC_DOOR(PROMOTION_ID);
CREATE INDEX XIE2FACT_PROMOTION_SC_DOOR ON FACT_PROMOTION_SC_DOOR(STYLE_COLOR_ID);
CREATE INDEX XIE3FACT_PROMOTION_SC_DOOR ON FACT_PROMOTION_SC_DOOR(STORE_ID);
CREATE INDEX XIE4FACT_PROMOTION_SC_DOOR ON FACT_PROMOTION_SC_DOOR(YEAR_SEASON_ID);
CREATE INDEX XIE5FACT_PROMOTION_SC_DOOR ON FACT_PROMOTION_SC_DOOR(STATUS_ID);
CREATE INDEX XIE6FACT_PROMOTION_SC_DOOR ON FACT_PROMOTION_SC_DOOR(PROMOTION_SCOPE_ID);

--THIS IS PROMOTION FACT, FACTLESS FACT
--THE GRAIN IS PER prod+PER loc + PER YEARSEASON 
CREATE TABLE FACT_PROMOTION_PROD_LOC(
PROMOTION_SCOPE_ID             NUMBER(7)     NOT NULL,
PROMOTION_ID                   NUMBER(7)     NOT NULL,
PROD_ATTR_VALUE_ID             NUMBER(7)     NOT NULL,
LOC_ATTR_VALUE_ID              NUMBER(7)     NOT NULL,
YEAR_SEASON_ID                 NUMBER(7)     NOT NULL,
STATUS_ID                      NUMBER(7)     NOT NULL,
TARGET_INVENTORY               NUMBER(11)    NOT NULL,
STYLE_COLOR_MIN_INVENTORY      NUMBER(11)    NOT NULL,
CONSTRAINT PKFACT_PROMOTION_PROD_LOC PRIMARY KEY(PROMOTION_ID,PROD_ATTR_VALUE_ID,LOC_ATTR_VALUE_ID,YEAR_SEASON_ID,STATUS_ID)
);


ALTER TABLE FACT_PROMOTION_PROD_LOC ADD CONSTRAINT FKFACT_PROMOTION_PROD_LOC_P
FOREIGN KEY(PROMOTION_ID) REFERENCES DIM_PROMOTION(PROMOTION_ID);

ALTER TABLE FACT_PROMOTION_PROD_LOC ADD CONSTRAINT FKFACT_PROMOTION_PROD_LOC_PC
FOREIGN KEY(PROD_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);

ALTER TABLE FACT_PROMOTION_PROD_LOC ADD CONSTRAINT FKFACT_PROMOTION_PROD_LOC_LC
FOREIGN KEY(LOC_ATTR_VALUE_ID) REFERENCES DIM_LOC_ATTR_VALUE(LOC_ATTR_VALUE_ID);

ALTER TABLE FACT_PROMOTION_PROD_LOC ADD CONSTRAINT FKFACT_PROMOTION_PROD_LOC_YS
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_PROMOTION_PROD_LOC ADD CONSTRAINT FKFACT_PROMOTION_PROD_LOC_ST
FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

ALTER TABLE FACT_PROMOTION_PROD_LOC ADD CONSTRAINT FKFACT_PROMOTION_PROD_LOC_PS
FOREIGN KEY(PROMOTION_SCOPE_ID) REFERENCES DIM_PROMOTION_SCOPE(PROMOTION_SCOPE_ID);

CREATE INDEX XIE1FACT_PROMOTION_PROD_LOC ON FACT_PROMOTION_PROD_LOC(PROMOTION_ID);
CREATE INDEX XIE2FACT_PROMOTION_PROD_LOC ON FACT_PROMOTION_PROD_LOC(PROD_ATTR_VALUE_ID);
CREATE INDEX XIE3FACT_PROMOTION_PROD_LOC ON FACT_PROMOTION_PROD_LOC(LOC_ATTR_VALUE_ID);
CREATE INDEX XIE4FACT_PROMOTION_PROD_LOC ON FACT_PROMOTION_PROD_LOC(YEAR_SEASON_ID);
CREATE INDEX XIE5FACT_PROMOTION_PROD_LOC ON FACT_PROMOTION_PROD_LOC(STATUS_ID);
CREATE INDEX XIE6FACT_PROMOTION_PROD_LOC ON FACT_PROMOTION_PROD_LOC(PROMOTION_SCOPE_ID);

--THIS IS PROMOTION FACT, FACTLESS FACT
--THE GRAIN IS PER prod+PER door + PER YEARSEASON 
CREATE TABLE FACT_PROMOTION_PROD_DOOR(
PROMOTION_SCOPE_ID             NUMBER(7)     NOT NULL,
PROMOTION_ID                   NUMBER(7)     NOT NULL,
PROD_ATTR_VALUE_ID             NUMBER(7)     NOT NULL,
STORE_ID                       NUMBER(7)     NOT NULL,
YEAR_SEASON_ID                 NUMBER(7)     NOT NULL,
STATUS_ID                      NUMBER(7)     NOT NULL,
TARGET_INVENTORY               NUMBER(11)    NOT NULL,
STYLE_COLOR_MIN_INVENTORY      NUMBER(11)    NOT NULL,
CONSTRAINT PKFACT_PROMOTION_PROD_DOOR PRIMARY KEY(PROMOTION_ID,PROD_ATTR_VALUE_ID,STORE_ID,YEAR_SEASON_ID,STATUS_ID)
);


ALTER TABLE FACT_PROMOTION_PROD_DOOR ADD CONSTRAINT FKFACT_PROMOTION_PROD_DOOR_P
FOREIGN KEY(PROMOTION_ID) REFERENCES DIM_PROMOTION(PROMOTION_ID);

ALTER TABLE FACT_PROMOTION_PROD_DOOR ADD CONSTRAINT FKFACT_PROMOTION_PROD_DOOR_PC
FOREIGN KEY(PROD_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);

ALTER TABLE FACT_PROMOTION_PROD_DOOR ADD CONSTRAINT FKFACT_PROMOTION_PROD_DOOR_LC
FOREIGN KEY(STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID);

ALTER TABLE FACT_PROMOTION_PROD_DOOR ADD CONSTRAINT FKFACT_PROMOTION_PROD_DOOR_YS
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_PROMOTION_PROD_DOOR ADD CONSTRAINT FKFACT_PROMOTION_PROD_DOOR_ST
FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

ALTER TABLE FACT_PROMOTION_PROD_DOOR ADD CONSTRAINT FKFACT_PROMOTION_PROD_DOOR_PS
FOREIGN KEY(PROMOTION_SCOPE_ID) REFERENCES DIM_PROMOTION_SCOPE(PROMOTION_SCOPE_ID);

CREATE INDEX XIE1FACT_PROMOTION_PROD_DOOR ON FACT_PROMOTION_PROD_DOOR(PROMOTION_ID);
CREATE INDEX XIE2FACT_PROMOTION_PROD_DOOR ON FACT_PROMOTION_PROD_DOOR(PROD_ATTR_VALUE_ID);
CREATE INDEX XIE3FACT_PROMOTION_PROD_DOOR ON FACT_PROMOTION_PROD_DOOR(STORE_ID);
CREATE INDEX XIE4FACT_PROMOTION_PROD_DOOR ON FACT_PROMOTION_PROD_DOOR(YEAR_SEASON_ID);
CREATE INDEX XIE5FACT_PROMOTION_PROD_DOOR ON FACT_PROMOTION_PROD_DOOR(STATUS_ID);
CREATE INDEX XIE6FACT_PROMOTION_PROD_DOOR ON FACT_PROMOTION_PROD_DOOR(PROMOTION_SCOPE_ID);

--THIS IS PROMOTION FACT, FACTLESS FACT
--THE GRAIN IS PER style color+PER loc + PER YEARSEASON 
CREATE TABLE FACT_PROMOTION_SC_LOC(
PROMOTION_SCOPE_ID             NUMBER(7)     NOT NULL,
PROMOTION_ID                   NUMBER(7)     NOT NULL,
STYLE_COLOR_ID                 NUMBER(7)     NOT NULL,
LOC_ATTR_VALUE_ID              NUMBER(7)     NOT NULL,
YEAR_SEASON_ID                 NUMBER(7)     NOT NULL,
STATUS_ID                      NUMBER(7)     NOT NULL,
TARGET_INVENTORY               NUMBER(11)    NOT NULL,
STYLE_COLOR_MIN_INVENTORY      NUMBER(11)    NOT NULL,
CONSTRAINT PKFACT_PROMOTION_SC_LOC PRIMARY KEY(PROMOTION_ID,STYLE_COLOR_ID,LOC_ATTR_VALUE_ID,YEAR_SEASON_ID,STATUS_ID)
);


ALTER TABLE FACT_PROMOTION_SC_LOC ADD CONSTRAINT FKFACT_PROMOTION_SC_LOC_P
FOREIGN KEY(PROMOTION_ID) REFERENCES DIM_PROMOTION(PROMOTION_ID);

ALTER TABLE FACT_PROMOTION_SC_LOC ADD CONSTRAINT FKFACT_PROMOTION_SC_LOC_PC
FOREIGN KEY(STYLE_COLOR_ID) REFERENCES DIM_STYLE_COLOR(STYLE_COLOR_ID);

ALTER TABLE FACT_PROMOTION_SC_LOC ADD CONSTRAINT FKFACT_PROMOTION_SC_LOC_LC
FOREIGN KEY(LOC_ATTR_VALUE_ID) REFERENCES DIM_LOC_ATTR_VALUE(LOC_ATTR_VALUE_ID);

ALTER TABLE FACT_PROMOTION_SC_LOC ADD CONSTRAINT FKFACT_PROMOTION_SC_LOC_YS
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_PROMOTION_SC_LOC ADD CONSTRAINT FKFACT_PROMOTION_SC_LOC_ST
FOREIGN KEY(STATUS_ID) REFERENCES DIM_COMMON(COMMON_ID);

ALTER TABLE FACT_PROMOTION_SC_LOC ADD CONSTRAINT FKFACT_PROMOTION_SC_LOC_PS
FOREIGN KEY(PROMOTION_SCOPE_ID) REFERENCES DIM_PROMOTION_SCOPE(PROMOTION_SCOPE_ID);

CREATE INDEX XIE1FACT_PROMOTION_SC_LOC ON FACT_PROMOTION_SC_LOC(PROMOTION_ID);
CREATE INDEX XIE2FACT_PROMOTION_SC_LOC ON FACT_PROMOTION_SC_LOC(STYLE_COLOR_ID);
CREATE INDEX XIE3FACT_PROMOTION_SC_LOC ON FACT_PROMOTION_SC_LOC(LOC_ATTR_VALUE_ID);
CREATE INDEX XIE4FACT_PROMOTION_SC_LOC ON FACT_PROMOTION_SC_LOC(YEAR_SEASON_ID);
CREATE INDEX XIE5FACT_PROMOTION_SC_LOC ON FACT_PROMOTION_SC_LOC(STATUS_ID);
CREATE INDEX XIE6FACT_PROMOTION_SC_LOC ON FACT_PROMOTION_SC_LOC(PROMOTION_SCOPE_ID);

CREATE GLOBAL TEMPORARY TABLE FACT_PROMOTION_STEP1_TEMP(
PROMOTION_SCOPE_ID             NUMBER(7)     NOT NULL,
PROMOTION_ID                   NUMBER(7)     NOT NULL,
STYLE_COLOR_ID                 NUMBER(7)     NOT NULL,
PROD_ATTR_VALUE_ID             NUMBER(7)     NOT NULL,
STORE_ID                       NUMBER(7)     NOT NULL,
LOC_ATTR_VALUE_ID              NUMBER(7)     NOT NULL,
YEAR_SEASON_ID                 NUMBER(7)     NOT NULL,
TARGET_INVENTORY               NUMBER(11)    NOT NULL,
STYLE_COLOR_MIN_INVENTORY      NUMBER(11)    NOT NULL,
ACTION_FLAG                    VARCHAR2(1)   NOT NULL,
FILE_ROW_NUM                   NUMBER(9)     NOT NULL
) ON COMMIT DELETE ROWS; 



CREATE GLOBAL TEMPORARY TABLE FACT_PROMOTION_STEP2_TEMP(
PROMOTION_SCOPE_ID             NUMBER(7)     NOT NULL,
PROMOTION_ID                   NUMBER(7)     NOT NULL,
STYLE_COLOR_ID                 NUMBER(7)     NOT NULL,
PROD_ATTR_VALUE_ID             NUMBER(7)     NOT NULL,
STORE_ID                       NUMBER(7)     NOT NULL,
LOC_ATTR_VALUE_ID              NUMBER(7)     NOT NULL,
YEAR_SEASON_ID                 NUMBER(7)     NOT NULL,
TARGET_INVENTORY               NUMBER(11)    NOT NULL,
STYLE_COLOR_MIN_INVENTORY      NUMBER(11)    NOT NULL,
ACTION_FLAG                    VARCHAR2(1)   NOT NULL
) ON COMMIT DELETE ROWS;





--****************************PROMOTION_RAW********************************

CREATE TABLE PROMOTION_RAW(
CORPORATE_DIVISION       VARCHAR2(60),
VENDOR_REF_NUMBER        VARCHAR2(20),
ACTION_FLAG              VARCHAR2(1),
PROMOTION_CODE           VARCHAR2(60),
STYLE_YEAR               NUMBER(4),
STYLE_SEASON             VARCHAR2(30),
STYLE_NUMBER             VARCHAR2(40),
COLOR_CODE               VARCHAR2(20),
COLOR_NAME               VARCHAR2(20),
DOOR_NUMBER              VARCHAR2(13),
TARGET_INVENTORY         NUMBER(11),
STYLE_COLOR_MIN_INVENTORY      NUMBER(11),
LOC_ATTR1                VARCHAR2(30),
LOC_ATTR2                VARCHAR2(30),
LOC_ATTR3                VARCHAR2(30),
PROD_ATTR1               VARCHAR2(60),
PROD_ATTR2               VARCHAR2(60),
PROD_ATTR3               VARCHAR2(60),
PROD_ATTR4               VARCHAR2(60),
PROD_ATTR5               VARCHAR2(60),
STYLE_UK_ATTR_VALUE1     VARCHAR2(40),
STYLE_UK_ATTR_VALUE2     VARCHAR2(40),
STYLE_UK_ATTR_VALUE3     VARCHAR2(40),
STYLE_UK_ATTR_VALUE4     VARCHAR2(40),
STYLE_UK_ATTR_VALUE5     VARCHAR2(40),
STYLE_UK_ATTR_VALUE6     VARCHAR2(40),
FILE_ROW_NUM             NUMBER(9) DEFAULT 0 NOT NULL,
UPLOAD_ID                NUMBER(9) NOT NULL
)  PARTITION BY RANGE(UPLOAD_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (1))
NOLOGGING;



--This is a factless fact, the grain is per prod attr value + per loc attr value + per year season
--each row reprents the setting of base unit and allocation setting for each attr value combination
--it sources from criteria_item
CREATE TABLE FACT_CRITERIA_ITEM(
PROD_ATTR_VALUE_ID              NUMBER(7) NOT NULL,
LOC_ATTR_VALUE_ID               NUMBER(7) NOT NULL,
YEAR_SEASON_ID                  NUMBER(7) NOT NULL,
BASE_UNITS_BK                   NUMBER(7) NOT NULL,
ALLOCATION_SETTING_BK           NUMBER(7) NOT NULL,
CONSTRAINT PKFACT_CRITERIA_ITEM PRIMARY KEY(PROD_ATTR_VALUE_ID,LOC_ATTR_VALUE_ID,YEAR_SEASON_ID)
);

ALTER TABLE FACT_CRITERIA_ITEM ADD CONSTRAINT FKFACT_CRITERIA_ITEM_P
FOREIGN KEY(PROD_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);

ALTER TABLE FACT_CRITERIA_ITEM ADD CONSTRAINT FKFACT_CRITERIA_ITEM_L
FOREIGN KEY(LOC_ATTR_VALUE_ID) REFERENCES DIM_LOC_ATTR_VALUE(LOC_ATTR_VALUE_ID);

ALTER TABLE FACT_CRITERIA_ITEM ADD CONSTRAINT FKFACT_CRITERIA_ITEM_YS
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);


CREATE INDEX XIE1FACT_CRITERIA_ITEM ON FACT_CRITERIA_ITEM(PROD_ATTR_VALUE_ID);
CREATE INDEX XIE2FACT_CRITERIA_ITEM ON FACT_CRITERIA_ITEM(LOC_ATTR_VALUE_ID);
CREATE INDEX XIE3FACT_CRITERIA_ITEM ON FACT_CRITERIA_ITEM(YEAR_SEASON_ID);




--SIZE PROFILE/SALES INDEX DIMENSION
CREATE TABLE DIM_ALLOCATION_REFERENCE(
ALLOCATION_REFERENCE_ID             NUMBER(7)   NOT NULL
CONSTRAINT PKDIM_ALLOCATION_REFERENCE PRIMARY KEY,
SOURCE_BUSKEY                       VARCHAR2(30)NOT NULL, 
PROD_CRITERIA_GROUP_ID              NUMBER(7)   NOT NULL,
LOC_CRITERIA_GROUP_ID               NUMBER(7)   NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID        NUMBER(7)   NOT NULL,
CONSTRAINT UN1DIM_ALLOCATION_REFERENCE UNIQUE(SOURCE_BUSKEY)
);

ALTER TABLE DIM_ALLOCATION_REFERENCE ADD CONSTRAINT UN2DIM_ALLOCATION_REFERENCE
UNIQUE(PROD_CRITERIA_GROUP_ID,LOC_CRITERIA_GROUP_ID,YEARSEASON_CRITERIA_GROUP_ID);

ALTER TABLE DIM_ALLOCATION_REFERENCE ADD CONSTRAINT FKDIM_ALLOCATION_REFERENCE_P
FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

ALTER TABLE DIM_ALLOCATION_REFERENCE ADD CONSTRAINT FKDIM_ALLOCATION_REFERENCE_L
FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

ALTER TABLE DIM_ALLOCATION_REFERENCE ADD CONSTRAINT FKDIM_ALLOCATION_REFERENCE_YS
FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

CREATE INDEX XIE1DIM_ALLOCATION_REFERENCE ON DIM_ALLOCATION_REFERENCE(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE2DIM_ALLOCATION_REFERENCE ON DIM_ALLOCATION_REFERENCE(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_ALLOCATION_REFERENCE ON DIM_ALLOCATION_REFERENCE(YEARSEASON_CRITERIA_GROUP_ID);


CREATE SEQUENCE SEQ_ALLOCATION_REFERENCE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;


--This is a transaction fact, the grain is per ALLOCATION REFERENCE+per FE ATTR VALUES + per FE LEVEL+per YEAR SEASON+ per STORE LOC+per PROD ATTR VALUE
CREATE TABLE FACT_SALES_INDEX(
TRANS_BUSKEY                         VARCHAR2(30)NOT NULL
CONSTRAINT PKFACT_SALES_INDEX PRIMARY KEY,
ALLOCATION_REFERENCE_ID              NUMBER(7)   NOT NULL,
FE_ATTR_VALUE_ID                     NUMBER(7)   NOT NULL,
FE_LEVEL_ID                          NUMBER(7)   NOT NULL,
YEAR_SEASON_ID                       NUMBER(7)   NOT NULL,
STORE_LOC_ID                         NUMBER(7)   NOT NULL,
PROD_ATTR_VALUE_ID                   NUMBER(7)   NOT NULL,
SMONTH_ID                            NUMBER(6)   NOT NULL,
SALES_INDEX                          NUMBER(9,2) NOT NULL,
SALES_UNIT                           NUMBER(11)  NOT NULL,
HIST_SALES_INDEX                     NUMBER(9,2) NOT NULL,
INDEX_RATIO                          NUMBER(9,2) NOT NULL,
CONSTRAINT UN1FACT_SALES_INDEX UNIQUE(ALLOCATION_REFERENCE_ID,FE_ATTR_VALUE_ID,FE_LEVEL_ID,YEAR_SEASON_ID,STORE_LOC_ID,PROD_ATTR_VALUE_ID,SMONTH_ID)
)PARTITION BY RANGE(ALLOCATION_REFERENCE_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (1)
      )
COMPRESS FOR OLTP;


ALTER TABLE FACT_SALES_INDEX ADD CONSTRAINT FKFACT_SALES_INDEX_AR
FOREIGN KEY(ALLOCATION_REFERENCE_ID) REFERENCES DIM_ALLOCATION_REFERENCE(ALLOCATION_REFERENCE_ID);

ALTER TABLE FACT_SALES_INDEX ADD CONSTRAINT FKFACT_SALES_INDEX_FEA
FOREIGN KEY(FE_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);

ALTER TABLE FACT_SALES_INDEX ADD CONSTRAINT FKFACT_SALES_INDEX_FEL
FOREIGN KEY(FE_LEVEL_ID) REFERENCES DIM_COMMON(COMMON_ID);

ALTER TABLE FACT_SALES_INDEX ADD CONSTRAINT FKFACT_SALES_INDEX_YS 
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_SALES_INDEX ADD CONSTRAINT FKFACT_SALES_INDEX_SL
FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_SALES_INDEX ADD CONSTRAINT FKFACT_SALES_INDEX_P
FOREIGN KEY(PROD_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);

ALTER TABLE FACT_SALES_INDEX ADD CONSTRAINT FKFACT_SALES_INDEX_SM
FOREIGN KEY(SMONTH_ID) REFERENCES DIM_DATE_SMONTH(SMONTH_ID);

CREATE BITMAP INDEX BX1FACT_SALES_INDEX ON FACT_SALES_INDEX(ALLOCATION_REFERENCE_ID) LOCAL;
CREATE BITMAP INDEX BX2FACT_SALES_INDEX ON FACT_SALES_INDEX(PROD_ATTR_VALUE_ID) LOCAL;
CREATE BITMAP INDEX BX3FACT_SALES_INDEX ON FACT_SALES_INDEX(FE_LEVEL_ID) LOCAL;
CREATE BITMAP INDEX BX4FACT_SALES_INDEX ON FACT_SALES_INDEX(YEAR_SEASON_ID) LOCAL;
CREATE BITMAP INDEX BX5FACT_SALES_INDEX ON FACT_SALES_INDEX(STORE_LOC_ID) LOCAL;
CREATE BITMAP INDEX BX6FACT_SALES_INDEX ON FACT_SALES_INDEX(FE_ATTR_VALUE_ID) LOCAL;
CREATE BITMAP INDEX BX7FACT_SALES_INDEX ON FACT_SALES_INDEX(SMONTH_ID) LOCAL;


CREATE SEQUENCE SEQ_TRANS_SALES_INDEX
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;


--SIZE PROFILE
--This is a transaction fact, the grain is per ALLOCATION REFERENCE+per FE ATTR VALUES + per FE LEVEL+per YEAR SEASON+ per STORE LOC+per PROD ATTR VALUE+per SIZE ITEM
CREATE TABLE FACT_SIZE_PROFILE(
TRANS_BUSKEY                         VARCHAR2(30)NOT NULL
CONSTRAINT PKFACT_SIZE_PROFILE PRIMARY KEY,
ALLOCATION_REFERENCE_ID              NUMBER(7)   NOT NULL,
FE_ATTR_VALUE_ID                     NUMBER(7)   NOT NULL,
FE_LEVEL_ID                          NUMBER(7)   NOT NULL,
YEAR_SEASON_ID                       NUMBER(7)   NOT NULL,
STORE_LOC_ID                         NUMBER(7)   NOT NULL,
PROD_ATTR_VALUE_ID                   NUMBER(7)   NOT NULL,
SIZE_ITEM_ID                         NUMBER(7)   NOT NULL,
SIZE_PROFILE                         NUMBER(7,6) NOT NULL,
CONSTRAINT UN1FACT_SIZE_PROFILE UNIQUE(ALLOCATION_REFERENCE_ID,FE_ATTR_VALUE_ID,FE_LEVEL_ID,YEAR_SEASON_ID,STORE_LOC_ID,PROD_ATTR_VALUE_ID,SIZE_ITEM_ID)
)PARTITION BY RANGE(ALLOCATION_REFERENCE_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (1)
      )
COMPRESS FOR OLTP;



ALTER TABLE FACT_SIZE_PROFILE ADD CONSTRAINT FKFACT_SIZE_PROFILE_AR
FOREIGN KEY(ALLOCATION_REFERENCE_ID) REFERENCES DIM_ALLOCATION_REFERENCE(ALLOCATION_REFERENCE_ID);

ALTER TABLE FACT_SIZE_PROFILE ADD CONSTRAINT FKFACT_SIZE_PROFILE_FEA
FOREIGN KEY(FE_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);

ALTER TABLE FACT_SIZE_PROFILE ADD CONSTRAINT FKFACT_SIZE_PROFILE_FEL
FOREIGN KEY(FE_LEVEL_ID) REFERENCES DIM_COMMON(COMMON_ID);

ALTER TABLE FACT_SIZE_PROFILE ADD CONSTRAINT FKFACT_SIZE_PROFILE_YS
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_SIZE_PROFILE ADD CONSTRAINT FKFACT_SIZE_PROFILE_SL
FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_SIZE_PROFILE ADD CONSTRAINT FKFACT_SIZE_PROFILE_P
FOREIGN KEY(PROD_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);

ALTER TABLE FACT_SIZE_PROFILE ADD CONSTRAINT FKFACT_SIZE_PROFILE_SI
FOREIGN KEY(SIZE_ITEM_ID) REFERENCES DIM_SIZE_ITEM(SIZE_ITEM_ID);


CREATE BITMAP INDEX BX1FACT_SIZE_PROFILE ON FACT_SIZE_PROFILE(ALLOCATION_REFERENCE_ID) LOCAL;
CREATE BITMAP INDEX BX2FACT_SIZE_PROFILE ON FACT_SIZE_PROFILE(FE_ATTR_VALUE_ID) LOCAL;
CREATE BITMAP INDEX BX3FACT_SIZE_PROFILE ON FACT_SIZE_PROFILE(FE_LEVEL_ID) LOCAL;
CREATE BITMAP INDEX BX4FACT_SIZE_PROFILE ON FACT_SIZE_PROFILE(YEAR_SEASON_ID) LOCAL;
CREATE BITMAP INDEX BX5FACT_SIZE_PROFILE ON FACT_SIZE_PROFILE(STORE_LOC_ID) LOCAL;
CREATE BITMAP INDEX BX6FACT_SIZE_PROFILE ON FACT_SIZE_PROFILE(PROD_ATTR_VALUE_ID) LOCAL;
CREATE BITMAP INDEX BX7FACT_SIZE_PROFILE ON FACT_SIZE_PROFILE(SIZE_ITEM_ID) LOCAL;

CREATE SEQUENCE SEQ_TRANS_SIZE_PROFILE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;


--STORE CLUSTER
--This is a transaction fact, the grain is per ALLOCATION REFERENCE+per FE ATTR VALUES + per FE LEVEL+per YEAR SEASON+ per STORE LOC+per PROD ATTR VALUE
CREATE TABLE FACT_STORE_CLUSTER(
TRANS_BUSKEY                         VARCHAR2(30)NOT NULL
CONSTRAINT PKFACT_STORE_CLUSTER PRIMARY KEY,
ALLOCATION_REFERENCE_ID              NUMBER(7)   NOT NULL,
FE_ATTR_VALUE_ID                     NUMBER(7)   NOT NULL,
FE_LEVEL_ID                          NUMBER(7)   NOT NULL,
YEAR_SEASON_ID                       NUMBER(7)   NOT NULL,
STORE_LOC_ID                         NUMBER(7)   NOT NULL,
PROD_ATTR_VALUE_ID                   NUMBER(7)   NOT NULL,
SMONTH_ID                            NUMBER(6)   NOT NULL,
SALES_UNIT                           NUMBER(11)  NOT NULL,
HIST_SALES_INDEX                     NUMBER(9,2) NOT NULL,
INDEX_RATIO                          NUMBER(9,2) NOT NULL,
SALES_INDEX                          NUMBER(9,2) NOT NULL,
SUGGEST_CLUSTER                      VARCHAR2(10)NOT NULL,
CONSTRAINT UN1FACT_STORE_CLUSTER UNIQUE(ALLOCATION_REFERENCE_ID,FE_ATTR_VALUE_ID,FE_LEVEL_ID,YEAR_SEASON_ID,STORE_LOC_ID,PROD_ATTR_VALUE_ID,SMONTH_ID)
)PARTITION BY RANGE(ALLOCATION_REFERENCE_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (1)
      )
COMPRESS FOR OLTP;

ALTER TABLE FACT_STORE_CLUSTER ADD CONSTRAINT FKFACT_STORE_CLUSTER_AR
FOREIGN KEY(ALLOCATION_REFERENCE_ID) REFERENCES DIM_ALLOCATION_REFERENCE(ALLOCATION_REFERENCE_ID);

ALTER TABLE FACT_STORE_CLUSTER ADD CONSTRAINT FKFACT_STORE_CLUSTER_FEA
FOREIGN KEY(FE_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);

ALTER TABLE FACT_STORE_CLUSTER ADD CONSTRAINT FKFACT_STORE_CLUSTER_FEL
FOREIGN KEY(FE_LEVEL_ID) REFERENCES DIM_COMMON(COMMON_ID);

ALTER TABLE FACT_STORE_CLUSTER ADD CONSTRAINT FKFACT_STORE_CLUSTER_YS
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_STORE_CLUSTER ADD CONSTRAINT FKFACT_STORE_CLUSTER_SL
FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_STORE_CLUSTER ADD CONSTRAINT FKFACT_STORE_CLUSTER_P
FOREIGN KEY(PROD_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);

ALTER TABLE FACT_STORE_CLUSTER ADD CONSTRAINT FKFACT_STORE_CLUSTER_SM
FOREIGN KEY(SMONTH_ID) REFERENCES DIM_DATE_SMONTH(SMONTH_ID);

CREATE BITMAP INDEX BX1FACT_STORE_CLUSTER ON FACT_STORE_CLUSTER(ALLOCATION_REFERENCE_ID) LOCAL;
CREATE BITMAP INDEX BX2FACT_STORE_CLUSTER ON FACT_STORE_CLUSTER(FE_ATTR_VALUE_ID) LOCAL;
CREATE BITMAP INDEX BX3FACT_STORE_CLUSTER ON FACT_STORE_CLUSTER(FE_LEVEL_ID) LOCAL;
CREATE BITMAP INDEX BX4FACT_STORE_CLUSTER ON FACT_STORE_CLUSTER(YEAR_SEASON_ID) LOCAL;
CREATE BITMAP INDEX BX5FACT_STORE_CLUSTER ON FACT_STORE_CLUSTER(STORE_LOC_ID) LOCAL;
CREATE BITMAP INDEX BX6FACT_STORE_CLUSTER ON FACT_STORE_CLUSTER(PROD_ATTR_VALUE_ID) LOCAL;
CREATE BITMAP INDEX BX7FACT_STORE_CLUSTER ON FACT_STORE_CLUSTER(SMONTH_ID) LOCAL;


CREATE SEQUENCE SEQ_TRANS_STORE_CLUSTER
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;




--SMOOTH ALPHA
--This is a transaction fact, the grain is per ALLOCATION REFERENCE+per FE ATTR VALUES + per FE LEVEL+per YEAR SEASON+ per STORE LOC+per PROD ATTR VALUE
CREATE TABLE FACT_SMOOTH_ALPHA(
TRANS_BUSKEY                         VARCHAR2(30)NOT NULL
CONSTRAINT PKFACT_SMOOTH_ALPHA PRIMARY KEY,
ALLOCATION_REFERENCE_ID              NUMBER(7)   NOT NULL,
FE_ATTR_VALUE_ID                     NUMBER(7)   NOT NULL,
FE_LEVEL_ID                          NUMBER(7)   NOT NULL,
YEAR_SEASON_ID                       NUMBER(7)   NOT NULL,
STORE_LOC_ID                         NUMBER(7)   NOT NULL,
PROD_ATTR_VALUE_ID                   NUMBER(7)   NOT NULL,
SMOOTH_ALPHA                         NUMBER(9,2) NOT NULL,
LY_PREV_SALES_UNIT                   NUMBER(11)  NOT NULL,
LY_PREV_ADJ_SALES_UNIT               NUMBER(11)  NOT NULL,
LY_PREV_ADJ_SALES_INDEX              NUMBER(9,2) NOT NULL,
TY_PREV_SALES_UNIT                   NUMBER(11)  NOT NULL,
TY_PREV_ADJ_SALES_UNIT               NUMBER(11)  NOT NULL,
TY_PREV_ADJ_SALES_INDEX              NUMBER(9,2) NOT NULL,
CONSTRAINT UN1FACT_SMOOTH_ALPHA UNIQUE(ALLOCATION_REFERENCE_ID,FE_ATTR_VALUE_ID,FE_LEVEL_ID,YEAR_SEASON_ID,STORE_LOC_ID,PROD_ATTR_VALUE_ID)
)PARTITION BY RANGE(ALLOCATION_REFERENCE_ID)
  INTERVAL(1)
  (PARTITION P0 VALUES LESS THAN (1)
      )
COMPRESS FOR OLTP;


ALTER TABLE FACT_SMOOTH_ALPHA ADD CONSTRAINT FKFACT_SMOOTH_ALPHA_AR
FOREIGN KEY(ALLOCATION_REFERENCE_ID) REFERENCES DIM_ALLOCATION_REFERENCE(ALLOCATION_REFERENCE_ID);

ALTER TABLE FACT_SMOOTH_ALPHA ADD CONSTRAINT FKFACT_SMOOTH_ALPHA_FEA
FOREIGN KEY(FE_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);

ALTER TABLE FACT_SMOOTH_ALPHA ADD CONSTRAINT FKFACT_SMOOTH_ALPHA_FEL
FOREIGN KEY(FE_LEVEL_ID) REFERENCES DIM_COMMON(COMMON_ID);

ALTER TABLE FACT_SMOOTH_ALPHA ADD CONSTRAINT FKFACT_SMOOTH_ALPHA_YS 
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_SMOOTH_ALPHA ADD CONSTRAINT FKFACT_SMOOTH_ALPHA_SL
FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

ALTER TABLE FACT_SMOOTH_ALPHA ADD CONSTRAINT FKFACT_SMOOTH_ALPHA_P
FOREIGN KEY(PROD_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);

CREATE BITMAP INDEX BX1FACT_SMOOTH_ALPHA ON FACT_SMOOTH_ALPHA(ALLOCATION_REFERENCE_ID) LOCAL;
CREATE BITMAP INDEX BX2FACT_SMOOTH_ALPHA ON FACT_SMOOTH_ALPHA(PROD_ATTR_VALUE_ID) LOCAL;
CREATE BITMAP INDEX BX3FACT_SMOOTH_ALPHA ON FACT_SMOOTH_ALPHA(FE_LEVEL_ID) LOCAL;
CREATE BITMAP INDEX BX4FACT_SMOOTH_ALPHA ON FACT_SMOOTH_ALPHA(YEAR_SEASON_ID) LOCAL;
CREATE BITMAP INDEX BX5FACT_SMOOTH_ALPHA ON FACT_SMOOTH_ALPHA(STORE_LOC_ID) LOCAL;
CREATE BITMAP INDEX BX6FACT_SMOOTH_ALPHA ON FACT_SMOOTH_ALPHA(FE_ATTR_VALUE_ID) LOCAL;

CREATE SEQUENCE SEQ_TRANS_SMOOTH_ALPHA
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;




--***************************************************************************************
--********************************TRANSFER MATRIX****************************************
--***************************************************************************************

CREATE TABLE DIM_TRANSFER_MATRIX(
TRANSFER_MATRIX_ID               NUMBER(7)     NOT NULL
CONSTRAINT PKDIM_TRANSFER_MATRIX PRIMARY KEY,
SOURCE_BUSKEY                    VARCHAR2(30)  NOT NULL,
PROD_CRITERIA_GROUP_ID           NUMBER(7)     NOT NULL,
LOC_CRITERIA_GROUP_ID            NUMBER(7)     NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID     NUMBER(7)     NOT NULL,
BASE_UNITS_BK                    NUMBER(7)     NOT NULL,
CONSTRAINT UN1DIM_TRANSFER_MATRIX UNIQUE(SOURCE_BUSKEY)
);

ALTER TABLE DIM_TRANSFER_MATRIX ADD CONSTRAINT FKDIM_TRANSFER_MATRIX_P
FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

ALTER TABLE DIM_TRANSFER_MATRIX ADD CONSTRAINT FKDIM_TRANSFER_MATRIX_L
FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

ALTER TABLE DIM_TRANSFER_MATRIX ADD CONSTRAINT FKDIM_TRANSFER_MATRIX_YS
FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

CREATE INDEX XIE1DIM_TRANSFER_MATRIX ON DIM_TRANSFER_MATRIX(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE2DIM_TRANSFER_MATRIX ON DIM_TRANSFER_MATRIX(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_TRANSFER_MATRIX ON DIM_TRANSFER_MATRIX(YEARSEASON_CRITERIA_GROUP_ID);


CREATE SEQUENCE SEQ_TRANSFER_MATRIX
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;




--FACT_TRANSFER_MATRIX_LOC_LOC
--THIS IS A FACTLESS FACT, SOURCED FROM TRANSFER_MATRIX
--THE GRAIN IS PER FROM LOC ATTR + PER TO LOC ATTR
CREATE TABLE FACT_TRANSFER_MATRIX_LOC_LOC(
TRANSFER_MATRIX_ID       NUMBER(7)   NOT NULL,
FROM_LOC_ATTR_VALUE_ID   NUMBER(7)   NOT NULL,
TO_LOC_ATTR_VALUE_ID     NUMBER(7)   NOT NULL,
PRIORITY                 NUMBER(7)   NOT NULL,
LEADTIME                 NUMBER(3)   NOT NULL,
CONSTRAINT PKFACT_TRANSFER_MATRIX_L2L PRIMARY KEY(TRANSFER_MATRIX_ID,FROM_LOC_ATTR_VALUE_ID,TO_LOC_ATTR_VALUE_ID)
);

ALTER TABLE FACT_TRANSFER_MATRIX_LOC_LOC ADD CONSTRAINT FKFACT_TRANSFER_MATRIX_L2L_M
FOREIGN KEY(TRANSFER_MATRIX_ID) REFERENCES DIM_TRANSFER_MATRIX(TRANSFER_MATRIX_ID);

ALTER TABLE FACT_TRANSFER_MATRIX_LOC_LOC ADD CONSTRAINT FKFACT_TRANSFER_MATRIX_L2L_F 
FOREIGN KEY(FROM_LOC_ATTR_VALUE_ID) REFERENCES DIM_LOC_ATTR_VALUE(LOC_ATTR_VALUE_ID);

ALTER TABLE FACT_TRANSFER_MATRIX_LOC_LOC ADD CONSTRAINT FKFACT_TRANSFER_MATRIX_L2L_T
FOREIGN KEY(TO_LOC_ATTR_VALUE_ID) REFERENCES DIM_LOC_ATTR_VALUE(LOC_ATTR_VALUE_ID);

CREATE INDEX XIE1FACT_TRANSFER_MATRIX_L2L ON FACT_TRANSFER_MATRIX_LOC_LOC(FROM_LOC_ATTR_VALUE_ID);
CREATE INDEX XIE2FACT_TRANSFER_MATRIX_L2L ON FACT_TRANSFER_MATRIX_LOC_LOC(TO_LOC_ATTR_VALUE_ID);
CREATE INDEX XIE3FACT_TRANSFER_MATRIX_L2L ON FACT_TRANSFER_MATRIX_LOC_LOC(TRANSFER_MATRIX_ID);

--FACT_TRANSFER_MATRIX_DOOR_DOOR
--THIS IS A FACTLESS FACT, SOURCED FROM TRANSFER_MATRIX
--THE GRAIN IS PER FROM DOOR + PER TO DOOR
CREATE TABLE FACT_TRANSFER_MATRIX_DOOR_DOOR(
TRANSFER_MATRIX_ID       NUMBER(7)   NOT NULL,
FROM_STORE_ID            NUMBER(7)   NOT NULL,
TO_STORE_ID              NUMBER(7)   NOT NULL,
PRIORITY                 NUMBER(7)   NOT NULL,
LEADTIME                 NUMBER(3)   NOT NULL,
CONSTRAINT PKFACT_TRANSFER_MATRIX_D2D PRIMARY KEY(TRANSFER_MATRIX_ID,FROM_STORE_ID,TO_STORE_ID)
);

ALTER TABLE FACT_TRANSFER_MATRIX_DOOR_DOOR ADD CONSTRAINT FKFACT_TRANSFER_MATRIX_D2D_M
FOREIGN KEY(TRANSFER_MATRIX_ID) REFERENCES DIM_TRANSFER_MATRIX(TRANSFER_MATRIX_ID);

ALTER TABLE FACT_TRANSFER_MATRIX_DOOR_DOOR ADD CONSTRAINT FKFACT_TRANSFER_MATRIX_D2D_F 
FOREIGN KEY(FROM_STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID);

ALTER TABLE FACT_TRANSFER_MATRIX_DOOR_DOOR ADD CONSTRAINT FKFACT_TRANSFER_MATRIX_D2D_T
FOREIGN KEY(TO_STORE_ID) REFERENCES DIM_STORE_STORE(STORE_ID);

CREATE INDEX XIE1FACT_TRANSFER_MATRIX_D2D ON FACT_TRANSFER_MATRIX_DOOR_DOOR(FROM_STORE_ID);
CREATE INDEX XIE2FACT_TRANSFER_MATRIX_D2D ON FACT_TRANSFER_MATRIX_DOOR_DOOR(TO_STORE_ID);
CREATE INDEX XIE3FACT_TRANSFER_MATRIX_D2D ON FACT_TRANSFER_MATRIX_DOOR_DOOR(TRANSFER_MATRIX_ID);



--this is a factless fact, the grain is per style color +per year season +per loc
--each row represent the box settting for each style color in each year season each loc
--sourced from box_style
CREATE TABLE DIM_BOXSTYLE(
BOXSTYLE_ID                  NUMBER(7)   NOT NULL
CONSTRAINT PKDIM_BOXSTYLE PRIMARY KEY,
SOURCE_BUSKEY                VARCHAR2(30)NOT NULL,
PROD_CRITERIA_GROUP_ID       NUMBER(7)   NOT NULL,
LOC_CRITERIA_GROUP_ID        NUMBER(7)   NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID NUMBER(7)   NOT NULL,
BASE_UNITS_BK                NUMBER(7)   NOT NULL,
CONSTRAINT UN1DIM_BOXSTYLE UNIQUE(SOURCE_BUSKEY)
);

ALTER TABLE DIM_BOXSTYLE ADD CONSTRAINT FKDIM_BOXSTYLE_P 
FOREIGN KEY(PROD_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

ALTER TABLE DIM_BOXSTYLE ADD CONSTRAINT FKDIM_BOXSTYLE_L
FOREIGN KEY(LOC_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

ALTER TABLE DIM_BOXSTYLE ADD CONSTRAINT FKDIM_BOXSTYLE_YS 
FOREIGN KEY(YEARSEASON_CRITERIA_GROUP_ID) REFERENCES DIM_CRITERIA_GROUP(CRITERIA_GROUP_ID);

CREATE INDEX XIE1DIM_BOXSTYLE ON DIM_BOXSTYLE(PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE2DIM_BOXSTYLE ON DIM_BOXSTYLE(LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_BOXSTYLE ON DIM_BOXSTYLE(YEARSEASON_CRITERIA_GROUP_ID);

CREATE SEQUENCE SEQ_BOXSTYLE
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

--DROP TABLE FACT_BOXSTYLE_SC_LOC PURGE;
CREATE TABLE FACT_BOXSTYLE_SC_LOC(
BOXSTYLE_ID           NUMBER(7)   NOT NULL,
STYLE_COLOR_ID        NUMBER(7)   NOT NULL,
YEAR_SEASON_ID        NUMBER(7)   NOT NULL,
STORE_LOC_ID          NUMBER(7)   NOT NULL,
BOX_GROUP_CODE        VARCHAR2(60)NOT NULL,
BOX_GROUP_NAME        VARCHAR2(60)NOT NULL,
BOX_CODE              VARCHAR2(60)NOT NULL,
BOX_NAME              VARCHAR2(60)NOT NULL,
CORE_STYLE_INDICATOR  VARCHAR2(1) NOT NULL,
CONSTRAINT PKFACT_BOXSTYLE_SC_LOC PRIMARY KEY(BOXSTYLE_ID,STYLE_COLOR_ID,YEAR_SEASON_ID,STORE_LOC_ID)
);

ALTER TABLE FACT_BOXSTYLE_SC_LOC ADD CONSTRAINT FKFACT_BOXSTYLE_SC_LOC_BS
FOREIGN KEY(BOXSTYLE_ID) REFERENCES DIM_BOXSTYLE(BOXSTYLE_ID);

ALTER TABLE FACT_BOXSTYLE_SC_LOC ADD CONSTRAINT FKFACT_BOXSTYLE_SC_LOC_S
FOREIGN KEY(STYLE_COLOR_ID) REFERENCES DIM_STYLE_COLOR(STYLE_COLOR_ID);

ALTER TABLE FACT_BOXSTYLE_SC_LOC ADD CONSTRAINT FKFACT_BOXSTYLE_SC_LOC_YS
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_BOXSTYLE_SC_LOC ADD CONSTRAINT FKFACT_BOXSTYLE_SC_LOC_L
FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

CREATE INDEX XIE1FACT_BOXSTYLE_SC_LOC ON FACT_BOXSTYLE_SC_LOC(STYLE_COLOR_ID);

CREATE INDEX XIE2FACT_BOXSTYLE_SC_LOC ON FACT_BOXSTYLE_SC_LOC(YEAR_SEASON_ID);

CREATE INDEX XIE3FACT_BOXSTYLE_SC_LOC ON FACT_BOXSTYLE_SC_LOC(STORE_LOC_ID);

CREATE INDEX XIE4FACT_BOXSTYLE_SC_LOC ON FACT_BOXSTYLE_SC_LOC(BOXSTYLE_ID);

--this is a factless fact, the grain is per PROD ATTR VALUE +per year season +per loc
--each row represent the box settting for each PROD ATTR VALUE in each year season each loc
--sourced from box_style
--DROP TABLE FACT_BOXSTYLE_PROD_LOC PURGE;
CREATE TABLE FACT_BOXSTYLE_PROD_LOC(
BOXSTYLE_ID           NUMBER(7)   NOT NULL,
PROD_ATTR_VALUE_ID    NUMBER(7)   NOT NULL,
YEAR_SEASON_ID        NUMBER(7)   NOT NULL,
STORE_LOC_ID          NUMBER(7)   NOT NULL,
BOX_GROUP_CODE        VARCHAR2(60)NOT NULL,
BOX_GROUP_NAME        VARCHAR2(60)NOT NULL,
BOX_CODE              VARCHAR2(60)NOT NULL,
BOX_NAME              VARCHAR2(60)NOT NULL,
CORE_STYLE_INDICATOR  VARCHAR2(1) NOT NULL,
CONSTRAINT PKFACT_BOXSTYLE_PROD_LOC PRIMARY KEY(BOXSTYLE_ID,PROD_ATTR_VALUE_ID,YEAR_SEASON_ID,STORE_LOC_ID)
);

ALTER TABLE FACT_BOXSTYLE_PROD_LOC ADD CONSTRAINT FKFACT_BOXSTYLE_PROD_LOC_BS
FOREIGN KEY(BOXSTYLE_ID) REFERENCES DIM_BOXSTYLE(BOXSTYLE_ID);

ALTER TABLE FACT_BOXSTYLE_PROD_LOC ADD CONSTRAINT FKFACT_BOXSTYLE_PROD_LOC_S
FOREIGN KEY(PROD_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);

ALTER TABLE FACT_BOXSTYLE_PROD_LOC ADD CONSTRAINT FKFACT_BOXSTYLE_PROD_LOC_YS
FOREIGN KEY(YEAR_SEASON_ID) REFERENCES DIM_YEAR_SEASON(YEAR_SEASON_ID);

ALTER TABLE FACT_BOXSTYLE_PROD_LOC ADD CONSTRAINT FKFACT_BOXSTYLE_PROD_LOC_L
FOREIGN KEY(STORE_LOC_ID) REFERENCES DIM_STORE_LOC(STORE_LOC_ID);

CREATE INDEX XIE1FACT_BOXSTYLE_PROD_LOC ON FACT_BOXSTYLE_PROD_LOC(PROD_ATTR_VALUE_ID);

CREATE INDEX XIE2FACT_BOXSTYLE_PROD_LOC ON FACT_BOXSTYLE_PROD_LOC(YEAR_SEASON_ID);

CREATE INDEX XIE3FACT_BOXSTYLE_PROD_LOC ON FACT_BOXSTYLE_PROD_LOC(STORE_LOC_ID);

CREATE INDEX XIE4FACT_BOXSTYLE_PROD_LOC ON FACT_BOXSTYLE_PROD_LOC(BOXSTYLE_ID);

--sequence for job ticket number
CREATE SEQUENCE SEQ_RELEASE_NUMBER 
MINVALUE 1 
MAXVALUE 99999 
START  WITH 1 
INCREMENT BY 1 
CYCLE 
CACHE 20;



--*******************************DIM_MIN_MAX*************************************
CREATE TABLE DIM_MIN_MAX(
MIN_MAX_ID                 NUMBER(7) NOT NULL
CONSTRAINT PKDIM_MIN_MAX PRIMARY KEY,
SOURCE_BUSKEY                VARCHAR2(30) NOT NULL,
PROD_CRITERIA_GROUP_ID       NUMBER(7) NOT NULL,
LOC_CRITERIA_GROUP_ID        NUMBER(7) NOT NULL,
YEARSEASON_CRITERIA_GROUP_ID NUMBER(7) NOT NULL,
BASE_UNITS_BK                NUMBER(7) NOT NULL
);



ALTER TABLE DIM_MIN_MAX
  ADD CONSTRAINT UN1DIM_MIN_MAX UNIQUE (SOURCE_BUSKEY);
  
ALTER TABLE DIM_MIN_MAX
  ADD CONSTRAINT FKDIM_MIN_MAX_L FOREIGN KEY (LOC_CRITERIA_GROUP_ID)
  REFERENCES DIM_CRITERIA_GROUP (CRITERIA_GROUP_ID);
  
ALTER TABLE DIM_MIN_MAX
  ADD CONSTRAINT FKDIM_MIN_MAX_P FOREIGN KEY (PROD_CRITERIA_GROUP_ID)
  REFERENCES DIM_CRITERIA_GROUP (CRITERIA_GROUP_ID);
  
ALTER TABLE DIM_MIN_MAX
  ADD CONSTRAINT FKDIM_MIN_MAX_YS FOREIGN KEY (YEARSEASON_CRITERIA_GROUP_ID)
  REFERENCES DIM_CRITERIA_GROUP (CRITERIA_GROUP_ID);

CREATE INDEX XIE1DIM_MIN_MAX ON DIM_MIN_MAX (PROD_CRITERIA_GROUP_ID);
CREATE INDEX XIE2DIM_MIN_MAX ON DIM_MIN_MAX (LOC_CRITERIA_GROUP_ID);
CREATE INDEX XIE3DIM_MIN_MAX ON DIM_MIN_MAX (YEARSEASON_CRITERIA_GROUP_ID);

CREATE SEQUENCE SEQ_MIN_MAX
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 20;

CREATE TABLE FACT_MIN_MAX_SC_LOC(
MIN_MAX_ID                   NUMBER(7)    NOT NULL,
STYLE_COLOR_ID               NUMBER(7)    NOT NULL,
LOC_ATTR_VALUE_ID            NUMBER(7)    NOT NULL,
MIN_QTY                      NUMBER(7)    NOT NULL,
MAX_QTY                      NUMBER(7)    NOT NULL,
CONSTRAINT PKFACT_MIN_MAX_SC_LOC PRIMARY KEY(MIN_MAX_ID,STYLE_COLOR_ID,LOC_ATTR_VALUE_ID)
);

ALTER TABLE FACT_MIN_MAX_SC_LOC ADD CONSTRAINT FKFACT_MIN_MAX_SC_LOC_M
FOREIGN KEY(MIN_MAX_ID) REFERENCES DIM_MIN_MAX(MIN_MAX_ID);

ALTER TABLE FACT_MIN_MAX_SC_LOC ADD CONSTRAINT FKFACT_MIN_MAX_SC_LOC_S
FOREIGN KEY(STYLE_COLOR_ID) REFERENCES DIM_STYLE_COLOR(STYLE_COLOR_ID);

ALTER TABLE FACT_MIN_MAX_SC_LOC ADD CONSTRAINT FKFACT_MIN_MAX_SC_LOC_L
FOREIGN KEY(LOC_ATTR_VALUE_ID) REFERENCES DIM_LOC_ATTR_VALUE(LOC_ATTR_VALUE_ID);

CREATE INDEX XIE1FACT_MIN_MAX_SC_LOC ON FACT_MIN_MAX_SC_LOC(MIN_MAX_ID);
CREATE INDEX XIE2FACT_MIN_MAX_SC_LOC ON FACT_MIN_MAX_SC_LOC(STYLE_COLOR_ID);
CREATE INDEX XIE3FACT_MIN_MAX_SC_LOC ON FACT_MIN_MAX_SC_LOC(LOC_ATTR_VALUE_ID);


CREATE TABLE FACT_MIN_MAX_PROD_LOC(
MIN_MAX_ID                   NUMBER(7)    NOT NULL,
PROD_ATTR_VALUE_ID           NUMBER(7)    NOT NULL,
LOC_ATTR_VALUE_ID            NUMBER(7)    NOT NULL,
MIN_QTY                      NUMBER(7)    NOT NULL,
MAX_QTY                      NUMBER(7)    NOT NULL,
CONSTRAINT PKFACT_MIN_MAX_PROD_LOC PRIMARY KEY(MIN_MAX_ID,PROD_ATTR_VALUE_ID,LOC_ATTR_VALUE_ID)
);

ALTER TABLE FACT_MIN_MAX_PROD_LOC ADD CONSTRAINT FKFACT_MIN_MAX_PROD_LOC_M
FOREIGN KEY(MIN_MAX_ID) REFERENCES DIM_MIN_MAX(MIN_MAX_ID);

ALTER TABLE FACT_MIN_MAX_PROD_LOC ADD CONSTRAINT FKFACT_MIN_MAX_PROD_LOC_S
FOREIGN KEY(PROD_ATTR_VALUE_ID) REFERENCES DIM_PROD_ATTR_VALUE(PROD_ATTR_VALUE_ID);

ALTER TABLE FACT_MIN_MAX_PROD_LOC ADD CONSTRAINT FKFACT_MIN_MAX_PROD_LOC_L
FOREIGN KEY(LOC_ATTR_VALUE_ID) REFERENCES DIM_LOC_ATTR_VALUE(LOC_ATTR_VALUE_ID);

CREATE INDEX XIE1FACT_MIN_MAX_PROD_LOC ON FACT_MIN_MAX_PROD_LOC(MIN_MAX_ID);
CREATE INDEX XIE2FACT_MIN_MAX_PROD_LOC ON FACT_MIN_MAX_PROD_LOC(PROD_ATTR_VALUE_ID);
CREATE INDEX XIE3FACT_MIN_MAX_PROD_LOC ON FACT_MIN_MAX_PROD_LOC(LOC_ATTR_VALUE_ID);


INSERT INTO DIM_MIN_MAX
  (MIN_MAX_ID,
   SOURCE_BUSKEY,
   PROD_CRITERIA_GROUP_ID,
   LOC_CRITERIA_GROUP_ID,
   YEARSEASON_CRITERIA_GROUP_ID,
   BASE_UNITS_BK)
VALUES
  (0,
   'DUMMY',
   0,
   0,
   0,
   0);
COMMIT;





--**************************************************************************************
--**************************************************************************************
--*******************************meta data tables*********************************
--**************************************************************************************
--**************************************************************************************

CREATE TABLE META_DIMS(
DIM_NAME                 VARCHAR2(30)   NOT NULL
CONSTRAINT PKMETA_DIMS PRIMARY KEY,
BUSINESS_DESC            VARCHAR2(60)   NOT NULL
);


CREATE TABLE META_DIM_LEVELS(
DIM_NAME                 VARCHAR2(30)   NOT NULL,
LEVEL_NAME               VARCHAR2(30)   NOT NULL,
DB_TAB_NAME              VARCHAR2(30)   NOT NULL,
DB_KEY_COL_NAME          VARCHAR2(30)   NOT NULL,
BUSINESS_DESC            VARCHAR2(60)   NOT NULL,
ETL_SOURCE               VARCHAR2(30)   NOT NULL,
CONSTRAINT PKMETA_DIM_LEVELS PRIMARY KEY(DIM_NAME,LEVEL_NAME)
);

CREATE TABLE META_DIM_LEVEL_ATTRS(
DIM_NAME                 VARCHAR2(30)   NOT NULL,
LEVEL_NAME               VARCHAR2(30)   NOT NULL,
ATTR_NAME                VARCHAR2(30)   NOT NULL,
DB_COL_NAME              VARCHAR2(30)   NOT NULL,
BUSINESS_DESC            VARCHAR2(60)   NOT NULL,
VISABLE                  CHAR           NOT NULL,
CONSTRAINT PKMETA_DIM_LEVEL_ATTRS PRIMARY KEY(DIM_NAME,LEVEL_NAME,ATTR_NAME)
);

CREATE TABLE META_DIM_HIERARCHIES(
DIM_NAME                 VARCHAR2(30)   NOT NULL,
HIERARCHY_NAME           VARCHAR2(30)   NOT NULL,
DB_TAB_NAME              VARCHAR2(30)   NOT NULL,
BUSINESS_DESC            VARCHAR2(60)   NOT NULL,
CONSTRAINT PKMETA_DIM_HIERARCHIES PRIMARY KEY(DIM_NAME,HIERARCHY_NAME)
);

CREATE TABLE META_DIM_HIER_LEVELS(
DIM_NAME                 VARCHAR2(30)   NOT NULL,
HIERARCHY_NAME           VARCHAR2(30)   NOT NULL,
LEVEL_NAME               VARCHAR2(30)   NOT NULL,
LEVEL_ID                 NUMBER(2)      NOT NULL,
TOP                      CHAR           NOT NULL,
BOTTOM                   CHAR           NOT NULL,
PARENT_LEVEL_NAME        VARCHAR2(30)   NOT NULL,
DB_TAB_NAME              VARCHAR2(30)   NOT NULL,
DB_KEY_COL_NAME          VARCHAR2(30)   NOT NULL,
DB_JOIN_COL_NAME         VARCHAR2(30)   NOT NULL,
DB_PARENT_TAB_NAME       VARCHAR2(30)   NOT NULL,
DB_PARENT_KEY_COL_NAME   VARCHAR2(30)   NOT NULL,
CONSTRAINT PKMETA_DIM_HIER_LEVELS PRIMARY KEY(DIM_NAME,HIERARCHY_NAME,LEVEL_NAME)
);

CREATE TABLE META_DIM_HIER_LEVEL_ATTRS(
DIM_NAME                 VARCHAR2(30)   NOT NULL,
HIERARCHY_NAME           VARCHAR2(30)   NOT NULL,
ATTR_NAME                VARCHAR2(30)   NOT NULL,
LEVEL_NAME               VARCHAR2(30)   NOT NULL,
BUSINESS_DESC            VARCHAR2(60)   NOT NULL,
DB_TAB_NAME              VARCHAR2(30)   NOT NULL,
DB_COL_NAME              VARCHAR2(30)   NOT NULL,
VISABLE                  CHAR           NOT NULL,
CONSTRAINT PKMETA_DIM_HIER_LEVEL_ATTRS PRIMARY KEY(DIM_NAME,HIERARCHY_NAME,ATTR_NAME)
);

CREATE TABLE META_FACTS(
FACT_NAME                VARCHAR2(30)   NOT NULL,
DB_TAB_NAME              VARCHAR2(30)   NOT NULL,
BUSINESS_DESC            VARCHAR2(60)   NOT NULL,
CONSTRAINT PKMETA_FACTS PRIMARY KEY(FACT_NAME)
);

CREATE TABLE META_FACT_MEASUREMENTS(
FACT_NAME               VARCHAR2(30)    NOT NULL,
FACT_MEASUREMENT_NAME   VARCHAR2(30)    NOT NULL,
DB_COL_NAME             VARCHAR2(30)    NOT NULL,
BUSINESS_DESC           VARCHAR2(60)    NOT NULL,
AGGREGATE_FUNCTION      VARCHAR2(30)    NOT NULL,
MEASURE_EXPRESSION      VARCHAR2(60)    NOT NULL,
VISABLE                 CHAR            NOT NULL,
CONSTRAINT PKMETA_FACT_MEASUREMENTS PRIMARY KEY(FACT_NAME,FACT_MEASUREMENT_NAME)
);


CREATE TABLE META_FACT_DIM_RELATIONS(
FACT_NAME                           VARCHAR2(30)   NOT NULL,
DIM_NAME                            VARCHAR2(30)   NOT NULL,
LEVEL_NAME                          VARCHAR2(30)   NOT NULL,
DB_FACT_TAB_NAME                    VARCHAR2(30)   NOT NULL,
DB_FACT_KEY_COL_NAME                VARCHAR2(30)   NOT NULL, --FOREIGN KEY COLUMN IN FACT
DB_DIM_LEVEL_KEY_COL_NAME           VARCHAR2(30)   NOT NULL,
CONSTRAINT PKMETA_FACT_DIM_RELATIONS PRIMARY KEY(DB_FACT_TAB_NAME,DIM_NAME,DB_FACT_KEY_COL_NAME)
);


CREATE TABLE META_DIM_LEVEL_ATTR_MAPPING(
DIM_NAME                VARCHAR2(30)     NOT NULL,
LEVEL_NAME              VARCHAR2(30)     NOT NULL,
ATTR_NAME               VARCHAR2(30)     NOT NULL,
SOURCE_FIELD            VARCHAR2(30)     NOT NULL,
FIELD_SEQ               NUMBER(3)        NOT NULL,
CONSTRAINT PKMETA_DIM_LEVEL_ATTR_MAPPING PRIMARY KEY(DIM_NAME,LEVEL_NAME,ATTR_NAME,SOURCE_FIELD)
);








--**************************************************************************************
--**************************************************************************************
--*******************************constraints disable*********************************
--**************************************************************************************
--**************************************************************************************
/*
--MODIFY ALL PRIMARY KEY RELY
DECLARE
  MYSQL VARCHAR2(200);
BEGIN
  EXECUTE IMMEDIATE 'PURGE RECYCLEBIN';
  
  FOR ITEM IN (SELECT TABLE_NAME, CONSTRAINT_NAME
                 FROM USER_CONSTRAINTS
                WHERE CONSTRAINT_TYPE IN ('P','U')) LOOP
    MYSQL := 'ALTER TABLE ' || ITEM.TABLE_NAME || ' MODIFY CONSTRAINT ' ||
             ITEM.CONSTRAINT_NAME || ' RELY ENABLE NOVALIDATE';
    DBMS_OUTPUT.PUT_LINE(MYSQL);
    EXECUTE IMMEDIATE MYSQL;
  END LOOP;
  
  FOR ITEM IN (SELECT TABLE_NAME, CONSTRAINT_NAME
                 FROM USER_CONSTRAINTS
                WHERE CONSTRAINT_TYPE = 'R') LOOP
    MYSQL := 'ALTER TABLE ' || ITEM.TABLE_NAME || ' MODIFY CONSTRAINT ' ||
             ITEM.CONSTRAINT_NAME || ' RELY ENABLE NOVALIDATE';
    DBMS_OUTPUT.PUT_LINE(MYSQL);
    EXECUTE IMMEDIATE MYSQL;
  END LOOP;
    
  

END;
/
*/

